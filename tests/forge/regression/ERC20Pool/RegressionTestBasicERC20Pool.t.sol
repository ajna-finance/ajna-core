// SPDX-License-Identifier: UNLICENSED

pragma solidity 0.8.18;

import { BasicERC20PoolInvariants } from "../../invariants/ERC20Pool/BasicERC20PoolInvariants.t.sol";

contract RegressionTestBasicERC20Pool is BasicERC20PoolInvariants { 

    function setUp() public override {
        // failures reproduced with 3 active buckets
        vm.setEnv("NO_OF_BUCKETS", "3");
        super.setUp();
    }

    function test_regression_Underflow_1() external {
        _basicERC20PoolHandler.addQuoteToken(14227, 5211, 3600000000000000000000, 0);

        // check invariants hold true
        invariant_quote();
    }

    function test_regression_exchange_rate_1() external {
        _basicERC20PoolHandler.addQuoteToken(999999999844396154169639088436193915956854451, 6879, 2809, 0);
        _basicERC20PoolHandler.addCollateral(2, 36429077592820139327392187131, 202214962129783771592, 0);
        _basicERC20PoolHandler.removeCollateral(1, 2296695924278944779257290397234298756, 10180568736759156593834642286260647915348262280903719122483474452532722106636, 0);

        invariant_exchange_rate(); 
    }

    function test_regression_exchange_rate_2() external {
        _basicERC20PoolHandler.addQuoteToken(211670885988646987334214990781526025942, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 6894274025938223490357894120267612065037086600750070030707794233, 0);
        _basicERC20PoolHandler.addCollateral(117281, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 0);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 12612911637698029036253737442696522, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _basicERC20PoolHandler.removeCollateral(1, 1e36, 2570, 0);
        _basicERC20PoolHandler.removeQuoteToken(1, 1e36, 2570, 0);
        _basicERC20PoolHandler.removeCollateral(2, 1e36, 2570, 0);
        _basicERC20PoolHandler.removeQuoteToken(2, 1e36, 2570, 0);

        invariant_exchange_rate();
    }

    function test_regression_exchange_rate_3() external {
        _basicERC20PoolHandler.addQuoteToken(2842, 304, 2468594405605444095992, 0);
        _basicERC20PoolHandler.addCollateral(0, 1, 3, 0);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _basicERC20PoolHandler.removeCollateral(0, 1, 3, 0);

        invariant_exchange_rate();
    }

    function test_regression_exchange_rate_4() external {
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 587135207579305083672251579076072787077, 0);
        _basicERC20PoolHandler.removeCollateral(712291886391993882782748602346033231793324080118979183300958, 673221151277569661050873992210938589, 999999997387885196930781163353866909746906615, 0);
        _basicERC20PoolHandler.removeCollateral(4434852123445331038838, 92373980881732279172264, 16357203, 0);
        _basicERC20PoolHandler.addQuoteToken(6532756, 16338, 2488340072929715905208495398161339232954907500634, 0);
        _basicERC20PoolHandler.removeCollateral(934473801621702106582064701468475360, 999999998588451849650292641565069384488310108, 2726105246641027837873401505120164058057757115396, 0);
        _basicERC20PoolHandler.addQuoteToken(0, 3272, 688437777000000000, 0);
        _basicERC20PoolHandler.removeQuoteToken(36653992905059663682442427, 3272, 688437777000000000, 0);

        invariant_exchange_rate();
    }

    function test_regression_exchange_rate_5() external {
        _basicERC20PoolHandler.drawDebt(1156, 1686, 0);
        
        invariant_exchange_rate();
        _basicERC20PoolHandler.addQuoteToken(711, 2161, 2012, 0); 

        invariant_exchange_rate();   
    }

    function test_regression_exchange_rate_6() external {
        _basicERC20PoolHandler.addCollateral(999999999000000000000000081002632733724231666, 999999999243662968633890481597751057821356823, 1827379824097500721086759239664926559, 0);
        _basicERC20PoolHandler.addQuoteToken(108018811574020559, 3, 617501271956497833026154369680502407518122199901237699791086943, 0);
        _basicERC20PoolHandler.addCollateral(95036573736725249741129171676163161793295193492729984020, 5009341426566798172861627799, 2, 0);
        _basicERC20PoolHandler.removeCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 5814100241, 0);

        invariant_exchange_rate();
    }

    // test was failing when actors = 10, buckets = [2570], maxAmount = 1e36
    // Fixed with commit -> https://github.com/ajna-finance/contracts/pull/613/commits/f106f0f7c96c1662325bdb5151fd745544e6dce0 
    function test_regression_exchange_rate_7() external {
        _basicERC20PoolHandler.addCollateral(999999999249784004703856120761629301735818638, 15200, 2324618456838396048595845067026807532884041462750983926777912015561, 0);
        _basicERC20PoolHandler.addQuoteToken(0, 2, 60971449684543878, 0);
        _basicERC20PoolHandler.addCollateral(0, 648001392760875820320327007315181208349883976901103343226563974622543668416, 38134304133913510899173609232567613, 0);
        _basicERC20PoolHandler.removeCollateral(0, 1290407354289435191451647900348688457414638662069174249777953, 125945131546441554612275631955778759442752893948134984981883798, 0);

        invariant_exchange_rate();
    }

    // test was failing when actors = 10, buckets = [2570], maxAmount = 1e36
    function test_regression_exchange_rate_8() external {
        _basicERC20PoolHandler.drawDebt(0, 10430, 0);

        invariant_exchange_rate();
        _basicERC20PoolHandler.addCollateral(86808428701435509359888008280539191473421, 35, 89260656586096811497271673595050, 0);

        invariant_exchange_rate();
    }

    function test_regression_exchange_rate_9() external {
        _basicERC20PoolHandler.addQuoteToken(179828875014111774829603408358905079754763388655646874, 39999923045226513122629818514849844245682430, 12649859691422584279364490330583846883, 0);

        invariant_exchange_rate();
        _basicERC20PoolHandler.addCollateral(472, 2100, 11836, 0);
        
        invariant_exchange_rate();
        _basicERC20PoolHandler.pledgeCollateral(7289, 8216, 0);

        invariant_exchange_rate();
    }

    function test_regression_fenwick_deposit_1() external {
        _basicERC20PoolHandler.addQuoteToken(60321923115154876306287876901335341390357684483818363750, 2, 0, 0);
        _basicERC20PoolHandler.repayDebt(58055409653178, 2, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_deposit_2() external {
        _basicERC20PoolHandler.addQuoteToken(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2146593659305556796718319988088528090847459411703413796483450011160, 0);
        _basicERC20PoolHandler.addCollateral(16885296866566559818671993560820380984757301691657405859955072474117, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 7764878663795446754367, 0);
        _basicERC20PoolHandler.removeCollateral(999999997000000000000000000000000000000756426, 7366, 4723, 0);
        _basicERC20PoolHandler.addQuoteToken(5673, 8294, 11316, 0);
        _basicERC20PoolHandler.moveQuoteToken(919997327910338711763724656061931477, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3933155006830995444792575696, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_deposit_3() external {
        _basicERC20PoolHandler.pullCollateral(64217420783566726909348297066823202824683000164554083, 651944294303386510182040138076901697073, 0);
        _basicERC20PoolHandler.removeQuoteToken(172614182, 2999, 725, 0);
        _basicERC20PoolHandler.addQuoteToken(52646814442098488638488433580148374391481084017027388775686120188766352301, 5021, 16410, 0);
        _basicERC20PoolHandler.moveQuoteToken(2, 1, 3, 11769823729834119405789456482320067049929344685247053661486, 0);
        _basicERC20PoolHandler.moveQuoteToken(1, 2833727997543655292227288672285470, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 7962018528962356191057551420322350, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_deposit_4() external {
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 2, 1267, 0);
        _basicERC20PoolHandler.pledgeCollateral(1700127358962530, 0, 0);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_deposit_5() external {
        _basicERC20PoolHandler.repayDebt(281, 1502, 0);
        _basicERC20PoolHandler.addCollateral(5529, 1090, 5431, 0);
        _basicERC20PoolHandler.pullCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_deposit_6() external {
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 0);
        _basicERC20PoolHandler.addQuoteToken(1000000000000000, 19319, 308, 0);
        _basicERC20PoolHandler.pullCollateral(4218, 4175, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_prefixSum_1() external {
        _basicERC20PoolHandler.addQuoteToken(5851, 999999999999999999999999999999000087, 1938, 0);
        _basicERC20PoolHandler.addCollateral(135454721201807374404103595951250949, 172411742705067521609848985260337891060745418778973, 3, 0);
        _basicERC20PoolHandler.pledgeCollateral(2, 185978674898652363737734333012844452989790885966093618883814734917759475, 0);
        _basicERC20PoolHandler.moveQuoteToken(976453319, 2825105681459470134743617749102858205411027017903767825282483319, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 145056082857394229503325854914710239303685607721150607568547620026, 0);

        invariant_fenwick();
    }

    function test_regression_fenwick_index_1() external {
        _basicERC20PoolHandler.addQuoteToken(3056, 915, 1594, 0);
        _basicERC20PoolHandler.pullCollateral(274694202801760577094218807, 1, 0);
        _basicERC20PoolHandler.addQuoteToken(1088, 3407, 3555, 0);
        _basicERC20PoolHandler.addCollateral(1557, 13472, 15303, 0);
        _basicERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 40692552539277917058910464963, 0);
        _basicERC20PoolHandler.pullCollateral(1131485716992204156645660898919702, 30971207810832254868222941038507448, 0);
        _basicERC20PoolHandler.removeCollateral(27428712668923640148402320299830959263828759458932482391338247903954077260349, 1136, 3944, 0);
        _basicERC20PoolHandler.moveQuoteToken(9746204317995874651524496302383356801834068305156642323380998069579800880, 1723109236200550802774859945265636287, 3213180193920898024510373220802133410941904907229061207617048152428481, 0, 0);

        invariant_fenwick();
    }

    function test_regression_transferLps_1() external {
        _basicERC20PoolHandler.transferLps(0, 1, 200, 2570, 0);

        invariant_bucket();
    }

    function test_regression_transferLps_2() external {
        _basicERC20PoolHandler.transferLps(37233021465377552730514154972012012669272, 45957263314208417069590941186697869465410494677646946058359554, 405, 89727160292150007024940, 0);

        invariant_fenwick();
    }

    function test_regression_transferLps_3() external {
        _basicERC20PoolHandler.transferLps(1795, 6198, 3110, 11449, 0);

        invariant_bucket();
        invariant_exchange_rate();
    }

    function test_regression_pull_collateral_when_encumbered_greater_than_pledged() external {
        _basicERC20PoolHandler.drawDebt(1535776046383997344779595, 5191646246012456798576386242824793107669233, 0);
        _basicERC20PoolHandler.transferLps(17293, 19210, 227780, 999999999999999999999999999999999999999999997, 0);
        _basicERC20PoolHandler.removeQuoteToken(0, 0, 2, 0);
        _basicERC20PoolHandler.pullCollateral(115, 149220, 0);
    }

    function test_regression_incorrect_zero_deposit_buckets_1() external {
        _basicERC20PoolHandler.repayDebt(15119, 6786, 0);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1578322581132549441186648538841, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        invariant_fenwick();
    }

    function test_regression_fenwick_index_2() external {
        uint256 depositAt2570 = 570036521745120847917211;
        uint256 depositAt2571 = _basicERC20PoolHandler.constrictToRange(2578324552477056269186646552413, 1e6, 1e28);
        uint256 depositAt2572 = _basicERC20PoolHandler.constrictToRange(1212, 1e6, 1e28);
        _basicERC20PoolHandler.addQuoteToken(1, depositAt2570, 2570, 0);
        _basicERC20PoolHandler.addQuoteToken(1, depositAt2571, 2571, 0);
        _basicERC20PoolHandler.addQuoteToken(1, depositAt2572, 2572, 0);
        assertEq(_pool.depositIndex(depositAt2570), 2570);
        assertEq(_pool.depositIndex(depositAt2570 + depositAt2571), 2571);
        assertEq(_pool.depositIndex(depositAt2570 + depositAt2571 + depositAt2572), 2572);
    }

    function test_regression_collateralBalance_CT1_CT7() external {
        _basicERC20PoolHandler.pullCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _basicERC20PoolHandler.repayDebt(2712912126128356234217, 251720382485531952743041849848, 0);
        _basicERC20PoolHandler.addQuoteToken(253022590763482364356576159, 999999999999999273028438503236995092261608400, 712808213364422679443324012750, 0);
        _basicERC20PoolHandler.removeQuoteToken(121890555084215923472733925382, 0, 3, 0);

        invariant_collateral_CT1_CT7();
    }

    function test_regression_invariant_quote() external {
        _basicERC20PoolHandler.pledgeCollateral(47134563260349377955683144555119028889734284095914219439962386869, 2323610696462098, 0);
        _basicERC20PoolHandler.repayDebt(1, 2, 0);
        _basicERC20PoolHandler.removeCollateral(200953640940463935290718680397023889633667961549, 2481, 3, 0);
        _basicERC20PoolHandler.moveQuoteToken(695230664226651211376892782958299806602599384639648126900062519785408512, 1000115588871659705, 22812, 1955101796782211288928817909562, 0);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 103, 0);

        invariant_quote();
    }

    function test_regression_fenwick_deposit_8() external {
        _basicERC20PoolHandler.drawDebt(226719918559509764892175185709, 228676957600917178383525685311331, 0);

        invariant_fenwick();
    }

    /*
        Test was failing due to paralel fenwick-like structure rounding issues when removing quote token (pool zeroed out deposit, invariant didn't).
        Fixed by always updating fenwick-like structure deposit before _removeFenwick with pool value of deposit before action.
    */
    function test_regression_removeQuote_F1_F2() external {
        _basicERC20PoolHandler.drawDebt(1000015842906285642, 3025860345093137767157722073974970, 1672579009);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 37350737096356631749868658766446035802507688889, 3);
        _basicERC20PoolHandler.pullCollateral(1339025589888540701846672565416819, 1183378320242304355226217089860, 2819684456210673680471842519329612269717114425950956824633610867);
        _basicERC20PoolHandler.drawDebt(1675397941, 2080415307674929935089938650133, 847585073183503135184199206179);
        _basicERC20PoolHandler.removeQuoteToken(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1655863997176315188863510439876677338937555872044147015301945, 130646460818);
        _basicERC20PoolHandler.addQuoteToken(3, 159910559897732110834294450390998113542066344214, 693859041495743005167828576510678370114547542712821651478979861149724, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.repayDebt(625581645905633082032893062740, 2725046641108356153623398492984047, 2255219883038810127965464888694355);
        _basicERC20PoolHandler.removeQuoteToken(1000000905589942863, 58990072763305399289367199366, 923788618229907811082240816581, 1000495950425598387);
        _basicERC20PoolHandler.removeQuoteToken(1000142773576820584, 688076943001126469299127368281324660985333148061425170456167973348260210, 1000477901104615870, 4102539298994246948557383554220941);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 58723896542, 1);
        _basicERC20PoolHandler.pledgeCollateral(48301739701121795424890239903547, 3, 1324680083965641189506583054831958046966);
        _basicERC20PoolHandler.moveQuoteToken(3426269639726768233918196638236, 1000211552600857667, 5685060712659462532718722585403826, 2792178365459745443619626179409076, 1426463916295788240829761693142813153335606622714154151);
        _basicERC20PoolHandler.drawDebt(1675845589, 2250075795681149832645315047529352966150920489023882737068264887430, 1874793830451667442216647666);
        _basicERC20PoolHandler.removeQuoteToken(2724859996648816227289710015353665, 1390991014546251119747341814610, 218948663391604015591297550517, 2539235686535710401520960977679);
        _basicERC20PoolHandler.removeCollateral(31352472016259312240697112201650738620289868213389321043778, 3134900229522813154679985060039980, 107, 60051311522860524551173770709758822540903524);
        _basicERC20PoolHandler.removeCollateral(2531436685989521387110557039659278081045704440673059845141681786228450255542, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 9794596782419650685386956056211712555152081175635316977567188779967260798, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addCollateral(2266260600185984418754485132, 7324720411794446825398360654973, 576574478079656391612100683, 1674425576);
        _basicERC20PoolHandler.removeQuoteToken(40743146231596996553946362499, 1000217577936384416, 9434697404733431344495466234349364, 1000022296421718800);
        _basicERC20PoolHandler.pledgeCollateral(1673388362, 1255031423241829518578475157835, 1523773071159963043);
        _basicERC20PoolHandler.transferLps(4034401368985456464882679572223864289378810567697, 81652242414390102183801448266756157323151608634669327038615887558, 24740306543212756820262332217300728040, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.transferLps(4495787, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 147086922704227907905118942315866593, 54737);
        _basicERC20PoolHandler.moveQuoteToken(474980413008325149341966443575545671819998168600255, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 70, 1113832091799835307);
        _basicERC20PoolHandler.addCollateral(188050718044765422696838279498755220148332129109203942249845704311, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 346011456129608788132194365321197, 441);
        _basicERC20PoolHandler.transferLps(5080949979479159164174260135879, 3471313089256649147043990966762, 3577613940211944321385119245030, 2638375712381213697694391111978, 1000080461883002399);
        _basicERC20PoolHandler.drawDebt(1354503559178321571, 1000304971444839895, 999999999999999967588142846479439157680058501);
        _basicERC20PoolHandler.pledgeCollateral(8576431004957223069174121487463, 978494819882708200561056462237, 936854891036552091003084);
        _basicERC20PoolHandler.pledgeCollateral(3, 3, 3028035929838919741732787237);
        _basicERC20PoolHandler.addQuoteToken(11460673144393961829630519848597906, 1442520032722081788192223127751471, 3348011182322008809621454756788, 2000125990203969564606281941576);
        _basicERC20PoolHandler.moveQuoteToken(4297449451578893941161320879546434, 2712969274693577552070, 2730448071256681602025639939798518, 3427811744873070004193423338400, 23360);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639932, 258478163207917, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 42859325144530938385330793634625932568274198052665103043091136354, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 6292417211010384270261130544608442839047244830, 1641951090342790424051404204860104821855830761498357810286270, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeCollateral(13779450658675671982760604652, 689052320352616146813931342190450782529875553448303105413508080522051734, 788151799776458826759410795283, 1000126756434716682397388);
        _basicERC20PoolHandler.removeCollateral(1283235964548610178080671680029, 6243437121190289325501914157239, 2089119602715976701960815485980, 1673298601);
        _basicERC20PoolHandler.addCollateral(4267105210518626985539574, 1, 28664277169404984418780329020002445783985631994239934152836875808532090654366, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.pledgeCollateral(175213099448262185950098697987994, 11405870109131830270938242, 596778938571738970749024097943683093900241802300951);
        _basicERC20PoolHandler.pullCollateral(1675373528, 1000643193057265125, 851515825605428609864032636);
        _basicERC20PoolHandler.addCollateral(1000842547065757957, 1229498646011360052230106757967935, 884554933107357871431160708688362, 10906075423212449089453170567425599998163241130742492718419782121361707);
        _basicERC20PoolHandler.removeQuoteToken(1000438325294591924, 3582795110651102560026236555318, 8665091894100610806039181174059, 246314140342906321626131758080816);
        _basicERC20PoolHandler.moveQuoteToken(3, 1025481480085320059204662854, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 371305751270977601367562503751);
        _basicERC20PoolHandler.pullCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 6946638055104596203629012810357409865808562690004754842595629672415209263);
        _basicERC20PoolHandler.addCollateral(1002873997273952492851504, 2385643760429624075847487294213310, 2490767567338070980047347237144, 333957999640872228540656713280354);
        _basicERC20PoolHandler.transferLps(1637629916243, 10417426262, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1988449019663501439965118138231426045376, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.pledgeCollateral(857212141121873485584263527487519, 7674477408232134928658984923592, 787980176546695109273776259971);
        _basicERC20PoolHandler.addCollateral(713801469281338696586614702364913293893160869, 0, 18080511835644090989, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(1000371012982238982, 1002409928637823858, 238058853766351065, 137587133116990005892644308);
        _basicERC20PoolHandler.removeQuoteToken(93248165328, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 13155892587552843036592082640560683541082937613429066256638, 111358472563932965209322901361175289443134);
        _basicERC20PoolHandler.drawDebt(1327861028789336135096064693246, 800871846833446413968021157289, 3317423511422177200707956428749);
        _basicERC20PoolHandler.pledgeCollateral(2682017609095556511622, 5556520063677865508187579952868, 1000000028214733769);
        _basicERC20PoolHandler.addCollateral(134911182544886496485676, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 26164644739224690259952183454);
        _basicERC20PoolHandler.addQuoteToken(0, 31050797470978541429891547263060, 57074598730088502317475702631679744093433386981422137, 822481412380084455191882241184106286198835081035492479743769360185712);
        _basicERC20PoolHandler.drawDebt(1675030096, 7706394381985344917459187161880, 1000017177972882151);
        _basicERC20PoolHandler.removeCollateral(2456818873105471961911772787, 1001440041141746185288759, 3000424147352546277098658253583, 432773833504460);
        _basicERC20PoolHandler.removeQuoteToken(1471263305301696626176, 2435881105068041950392319046045, 1000000007348008219, 999999999999999144967774987089662894676005576);
        _basicERC20PoolHandler.moveQuoteToken(102030598360846849321306416093340647568905401223531345036095935, 2364859774704771817, 2075258113061, 0, 0);
        _basicERC20PoolHandler.addQuoteToken(3728461598084869758383, 7707264601395910711647785890664941538958957616950303047136388112, 3, 18680203764077861657588263992104251745159180970777695534619138974096574);
        _basicERC20PoolHandler.repayDebt(2, 722249219365013579691268, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.moveQuoteToken(980769234693041870485054699244, 1970988111392301049311821556405490226232593598043135198982826388509, 383821809833879542970855447995, 6766725109469402021972726993647, 9021319146842901668448861113286);
        _basicERC20PoolHandler.pledgeCollateral(1696102854909895122057327133768, 814308106147626392548961465108306, 75777074020720139048286873345);
        _basicERC20PoolHandler.moveQuoteToken(1000002753364534949, 7613360930324894103638362138205474, 1673423154, 1000095697465428287, 3081229597731649318700002357589452);
        _basicERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 3663078937159, 878852633793063524);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 50199796429304219, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.removeQuoteToken(54952481677113727684785865172239237207389554174800588163114107355108498411, 49521351703439422140488134804268608481883222138549038690280691426, 1, 2);
        _basicERC20PoolHandler.pullCollateral(1674801100, 688457829586514166182911021152980393464072006914979240821230092238474296, 191459120967260738890684);
        _basicERC20PoolHandler.removeQuoteToken(1000000000000000226275645567255865851052308968, 1000033995284293618, 1673523428, 205679958867810410961091789);
        _basicERC20PoolHandler.repayDebt(4283770176908571600780888289937, 3878801933482034411823652362701, 6397354869802509622840628836744);
        _basicERC20PoolHandler.removeCollateral(5, 2, 3, 1);
        _basicERC20PoolHandler.removeQuoteToken(1481218076834943080930743418348884607278626092957285426, 4944624679196338188027773190, 302213701184203129511700286555824220787165073271463205578917, 11598724614654186194135964033552800569100655);
        _basicERC20PoolHandler.drawDebt(3175, 376537109871115643414854480, 7045500779068980260852831480795);
        _basicERC20PoolHandler.repayDebt(39672830182321736175837, 1197001277357796117816307860477585809, 1276146741755657434550801492102585923);
        _basicERC20PoolHandler.removeCollateral(2, 3, 149720885657, 4481904462987774222638773175857655439883276713);
        _basicERC20PoolHandler.transferLps(3, 2, 3, 92697654460289264975012691299736198312035163822654217310697740435413049, 107613895494373421311268449752330);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 261, 4401564682114406193562877932070957164878886601249285706596727702229506, 3080523217971253852);
        _basicERC20PoolHandler.pledgeCollateral(882302277218841710922942058583861947472479522728846415389137525832817, 1122, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.pullCollateral(2276702435456921800137116720705939408780087138052348, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2);
        _basicERC20PoolHandler.moveQuoteToken(69478512381062333, 26018993921432954032706306348, 3972, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.pullCollateral(555221921173742694714, 3, 4290216928066323203007906558975436091131586796);
        _basicERC20PoolHandler.drawDebt(1000001755546083949, 4152023560094690172177358655923, 776590240941700179123128112651947);
        _basicERC20PoolHandler.addQuoteToken(10911643530470, 11571512411400883492970753272389218201362653263376690028965772507793764535, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 433646946410789123186196737932199367502396042059149665043277612077742789);
        _basicERC20PoolHandler.removeQuoteToken(1014170807017615452972515392, 688902077970386073426553893267979679281355730995775397815873676452908639, 805107887347601724928444946, 4525185621542521411470683258470);
        _basicERC20PoolHandler.moveQuoteToken(3745834598333182492912258260374413, 688255790011828735871738618110580749936356337902873119393264231395094242, 569198639876296340303271420533, 1000319071122041164, 135192106979847526512828998297);
        _basicERC20PoolHandler.addQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 529753993999390054394486713090179228954416870337090505, 1136341150615122739427713817422473634220079895919156654404240);
        _basicERC20PoolHandler.removeQuoteToken(999999999912894033768372883742, 999999999999999999504047943293631522569691684, 688447880865960602171180152209302651722918881293935619220696025762456064, 5242473368138304085708695872797);

        invariant_fenwick();
    }

    function test_regression_no_LP_on_remove_quote() external {
        vm.setEnv("QUOTE_PRECISION", "12");
        super.setUp();
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 21301506904137025678, 2);
        _basicERC20PoolHandler.drawDebt(3113594730498081967626732580815715041136, 80477440056595338652394034532720707, 1629103681429080141429902583796629444390345533658);
        _basicERC20PoolHandler.pullCollateral(80971119364652613288528890753630400505402891191345876238644064519478371635555, 613023803989253543303681985611422219128065442948859376011994400396, 70630968035528998923451178264359);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.removeCollateral(18446744121342263227, 10343, 10718, 1584);
        _basicERC20PoolHandler.moveQuoteToken(6727, 1670, 3625, 6846, 8977);
        _basicERC20PoolHandler.addCollateral(255660578852971, 2707, 10605, 6240);
        _basicERC20PoolHandler.transferLps(39770824717966450577403984099027230651590596354753451, 110196468889211344788237137729753052337259399844499670601, 791373455, 286888477198921971336421055248818459653848892272862019791291708522096335138, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.removeQuoteToken(16539, 849, 4183, 3654);
        _basicERC20PoolHandler.transferLps(0, 231721612610995347269444530139919228024957364865779244666407080, 4794, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2393963802041534052680824498183);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _basicERC20PoolHandler.removeCollateral(53, 246, 10960, 349862589541);
        _basicERC20PoolHandler.drawDebt(1478,3080, 7691);
        _basicERC20PoolHandler.drawDebt(2605,7549, 695);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 938657598529153312558550293408527955690427754981926333818300781429629, 3);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.removeQuoteToken(7770, 6011, 9016, 258);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 2335090198565709662059293854, 712717023986, 3);
        _basicERC20PoolHandler.addCollateral(3136, 1363882257, 95, 10000000000000000000000000000000000000000000000);
        _basicERC20PoolHandler.transferLps(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 13715229545702433012291230563878099218863282810259481425393174710971712785);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.moveQuoteToken(1, 15465987, 0, 727881530902743346146211643722166235127357858050164982344259, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.repayDebt(0, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addCollateral(3587, 1507, 3709, 2202654398);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 71353554542511499288031498857245628545083183911704, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 9266, 29822756335928881365955885003131297976103);
        _basicERC20PoolHandler.moveQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 427490373, 0, 2);
        _basicERC20PoolHandler.moveQuoteToken(15946, 8224, 37904, 10719, 6431);
        _basicERC20PoolHandler.moveQuoteToken(5209, 2559, 267, 22010, 1124);
        _basicERC20PoolHandler.pledgeCollateral(1560275422, 5664, 615);
        _basicERC20PoolHandler.repayDebt(843,19783, 2319);
        _basicERC20PoolHandler.pledgeCollateral(47670601452294692829969261558187945, 0, 85156819749408383319049410354);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.addQuoteToken(9739, 11264, 30366981136777812418611175058, 9064);
        _basicERC20PoolHandler.repayDebt(5497, 3546, 6167);
        _basicERC20PoolHandler.pledgeCollateral(10475, 9492, 38563662178380998846027553303678307422644286056268047356605934509250899345408);
        _basicERC20PoolHandler.removeQuoteToken(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 95423117699148416952018405033222622105782443444738280);
        _basicERC20PoolHandler.drawDebt(11206, 1426, 6248);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 8788124134869901850295874353438558867392764682597931, 0);
        _basicERC20PoolHandler.pullCollateral(12854, 2146, 8151);
        _basicERC20PoolHandler.pledgeCollateral(2839, 29969932493659093579519920003174532321574847349413477474170341246533839618048, 5796);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.drawDebt(14989958369421102388335172247459751877787212, 21862705576, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeQuoteToken(2, 2, 2, 4142645485845561527335341889839117689693);
        _basicERC20PoolHandler.removeQuoteToken(111805043895826488886480863100, 11765, 21788, 727881530902743346146211643722166235127357858050164982344259);
        _basicERC20PoolHandler.moveQuoteToken(531707326547676289107941, 215495, 2, 2683196030160028724787004357495134006312809522374207033376, 1677458363064960922826783);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 539751760481215767, 118822203799778002136, 3, 1);
        _basicERC20PoolHandler.transferLps(995000000000000000, 2482, 12809, 1812, 811680264765698944396479178993);
        _basicERC20PoolHandler.addCollateral(1147, 2805, 2520, 76876699529364196847806544444508040664462721441447668877111153141084241089631);
        _basicERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 754369339485602608231535452844762957245952811484904409682134372011147, 90655833348315767703, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 82920038770960379924898829, 585789243426828016689519910950913663323834833546853232, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.transferLps(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 2);
        _basicERC20PoolHandler.removeQuoteToken(1372, 23433, 6878, 7654);
        _basicERC20PoolHandler.pullCollateral(2, 2, 1);
        _basicERC20PoolHandler.addQuoteToken(8291, 8290, 1055712152538152708419638138217, 15983);
        _basicERC20PoolHandler.moveQuoteToken(688139553215404123198126833242494081254034862424060628945165937332976374, 23798, 1175, 30447600420829968275313533, 13574);
        _basicERC20PoolHandler.repayDebt(1000000009657080804, 10455, 119976781030095520858224948620);
        _basicERC20PoolHandler.addCollateral(349761991217256439351133488173955013978420919767938543, 0, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.repayDebt(4674, 8970, 19838);
        _basicERC20PoolHandler.removeQuoteToken(2453, 9986, 2313, 2688464379803803823822);
        _basicERC20PoolHandler.pullCollateral(1864, 1491, 8078);
        _basicERC20PoolHandler.drawDebt(24173, 3006, 6226);
        _basicERC20PoolHandler.removeQuoteToken(6475, 1914, 500187518239804032900641, 9129);
        _basicERC20PoolHandler.addQuoteToken(2536082571842740939923768090551, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 162527070496019397656824549615422854338062535737450, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 672954115360091165463987237600383569196788, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.drawDebt(12262, 1000285187436492128, 9836);
        _basicERC20PoolHandler.removeQuoteToken(5207, 1799, 1589, 644);
    }

    function test_regression_prototech_R1() external {
        _basicERC20PoolHandler.drawDebt(289417789361174372031056620741, 1000326246414552022, 1672427362);
        _basicERC20PoolHandler.addCollateral(3, 1363197669977567662485698544889893768624935214644, 176983931167823887652565227718535462076497, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(911338679565033631452753933741615870561500127200336515196, 100678485169218822286975041, 562157048161658889287796612, 396901311837079147383971976);
        _basicERC20PoolHandler.removeCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 43710635734924245562, 1);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }

    function test_regression_prototech_R2() external {
        _basicERC20PoolHandler.addQuoteToken(3, 1220382137948272011446728337739826893, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(1038320573183676909240324237485386031762797434733405183946263329789040728, 1130330236254, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3033887066257962770966405067568203133014825658008469487494673162404);
        _basicERC20PoolHandler.drawDebt(0, 31916080285492740679802985241918096165647794897794462450, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeQuoteToken(3, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1245491196095668653353385336965919096300160969748209210);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }

}

contract RegressionTestBasicWith10BucketsERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 10 active buckets
        vm.setEnv("NO_OF_BUCKETS", "10");
        super.setUp();
    }

    function test_regression_10_buckets_CT1_CT7() external {
        _basicERC20PoolHandler.transferLps(19078983173372942890417748018722377435183373748499322243247546781962442185, 1, 4391160926701505967325397265181132015972183318, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _basicERC20PoolHandler.transferLps(270997981512080867078682324706934707221242205867293069, 7864, 3651, 3166, 0);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 3635889843872116931397407365290249, 23021664368573277020436789355588670855277006870, 0);
        _basicERC20PoolHandler.drawDebt(268, 181582671641966396883195899256, 0);
        _basicERC20PoolHandler.pullCollateral(1227515749685864358137095510127654245525351748189001609, 3818828157139154512, 0);
        _basicERC20PoolHandler.repayDebt(3042268540744255610589705434124741203255613373849507141, 0, 0);
        _basicERC20PoolHandler.pullCollateral(6802, 6279, 0);
        _basicERC20PoolHandler.addQuoteToken(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 127935328935713960735227335223838560292175, 0);
        _basicERC20PoolHandler.pullCollateral(2930, 36104017659498278503100244564470932293, 0);
        _basicERC20PoolHandler.addQuoteToken(1681414255953633817920736095340458401, 2, 331564777626112378272493610241099454882166422929878794700, 0);
        _basicERC20PoolHandler.addCollateral(1834, 38146939, 39424949171633211915315804, 0);
        _basicERC20PoolHandler.addQuoteToken(8640216505061661298, 13070, 10696, 0);
        _basicERC20PoolHandler.pullCollateral(962704044, 8898752, 0);
        _basicERC20PoolHandler.moveQuoteToken(34331296, 236168072844073492133156025194, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 19256400511825415508859240250358, 0);
        _basicERC20PoolHandler.transferLps(2, 1183061996845258949, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 0 );
        _basicERC20PoolHandler.drawDebt(2169832191680919598423992113933409675947, 459159100237615494082512466719091280519979494228, 0 );
        _basicERC20PoolHandler.pledgeCollateral(363165343283932793766391798512, 14747, 0 );
        _basicERC20PoolHandler.removeCollateral(3985, 1824, 6960, 0);
        _basicERC20PoolHandler.addCollateral(1650938994639952252010012965502, 7253, 7574, 0);
        _basicERC20PoolHandler.transferLps(190195262656118760688724739, 999999999999999999999999999999999999999997115, 1248306590932896398273554030427, 6130, 0);
        _basicERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 8113004849018889317737081296151463737388429, 0);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0 );
        _basicERC20PoolHandler.moveQuoteToken(3, 2, 10960996744849996375050327179144415056797335841576787, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _basicERC20PoolHandler.transferLps(1, 743324445647492969999445842202717517856825, 1214649867011363567867599949068071550706, 239704513237, 0);
        _basicERC20PoolHandler.moveQuoteToken(78781837290735535753552291770891423860043710162602546000110480894858317836924, 993620562130177991745562150, 50000000000000000, 7110950, 0);
        _basicERC20PoolHandler.removeQuoteToken(3201781718151524032696177608091, 2788940717158963266260644637275, 1001719209787209063137009778273, 0);
        _basicERC20PoolHandler.removeCollateral(1481112300711317586348171215820373858161462484006514, 168870288186037165317237437722657252078900747583218061139236575915, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);

        invariant_collateral_CT1_CT7();
    }

    function test_regression_10_buckets_exchange_rate() external {
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 26963870279491362, 3601254755561650650360315550225832165809937215074736, 3);
        _basicERC20PoolHandler.pledgeCollateral(1, 40937702662375620098041553673274794675563238421444364181, 1806299292781392482814941608217714);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 26);
        _basicERC20PoolHandler.addQuoteToken(9086412395094638972007390189682, 8017988708875371050349109733764, 266534290007540556135436437121220, 787972529567086468575527683806);
        _basicERC20PoolHandler.drawDebt(3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.repayDebt(607418644361740467859860, 3596613749317836791599288999578, 126973386001551158);
        _basicERC20PoolHandler.addCollateral(17961069541001395512, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 81216080311786972267543281713646, 36083189127252982075046);
        _basicERC20PoolHandler.repayDebt(879265086388357000017570476021613397720047, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addQuoteToken(2074760358537425509206115888966642, 1000052509226306402, 1000216183594279728, 3626850572378510482520934156110);
        _basicERC20PoolHandler.addQuoteToken(7237766368913837526279800803850926, 2318473227034367386476981536426, 3397753274562712559962219817121, 3497677980587);
        _basicERC20PoolHandler.removeCollateral(2, 1, 22225753124285528776218150577139424248166623103654, 2);

        invariant_exchange_rate();
    }

    function test_regression_10_buckets_exchange_rate_2() external {
        _basicERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 17818855137382186474378203925478798087362081064669755109660);
        _basicERC20PoolHandler.addCollateral(964764110637273391149124793103, 936928192160217426868916642063, 12955560945978902771121849, 2701606087371011725063830630393);
        _basicERC20PoolHandler.removeCollateral(1000233017073419014, 493168574173516667837628028479, 1000343878875971862, 1000456862367981607271282879183);
        _basicERC20PoolHandler.removeCollateral(688160553555940795759938325497944173800517078344861811099552611334630134, 5520300724063246494671071725488, 3164757341640618278, 2566067341560472579524138938086);
        _basicERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 41316723850064749855432968190893852, 1704156508, 1);
        _basicERC20PoolHandler.moveQuoteToken(2338402619729444670366505962819150530378316367411261236887124071421, 1002224041809029153, 2834327347641428773029188, 1000413425240358656, 746591544249884746466149963933);
        _basicERC20PoolHandler.removeCollateral(1388044745591696560869746190501689966701146364533, 1444911079603055211427832649212708779095906518345500, 146224647513095394826, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeQuoteToken(3, 0, 14682057797145934596306613629765202023028155589188791234994295689059743703775, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.addCollateral(1573875203397848960670186019073248854602426094673, 2504217569840181286227620309719896586961536673187089015258250231162, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 25673965657298153291575883442400894202624273572440854514727495, 1606415152236964885598131062907211614020217776051558);

        invariant_exchange_rate();
    }

    function test_regression_10_buckets_F4() external {
        _basicERC20PoolHandler.moveQuoteToken(13234449535566095703531866953212457366696209938115942596093570715251, 60374778675415672380560, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 171308252132017301932164837198243853648547295794439243930145939017);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 6335515217046864691, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.addCollateral(6296421660734538372623618614208786496541, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 1);
        _basicERC20PoolHandler.addCollateral(4518678283152371114, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 102774731127178500371069294026531481660623908768344624881339468320844617);
        _basicERC20PoolHandler.pledgeCollateral(787973584684501059282315698711, 2920151741518916367111665950222, 123224745043874830703997919895);
        _basicERC20PoolHandler.pullCollateral(1573681034138562592148446961981, 5395039744831658857563353458119, 999999999999999999976489190096550336802923519);
        _basicERC20PoolHandler.drawDebt(6394102097403381167740208256634, 1000018554440804369, 8672057495977214373296863722573852739162441602919679032972630);
        _basicERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 140881254558364192728545623, 613322747455025846625942820);
        _basicERC20PoolHandler.drawDebt(714318606031963959460439666, 3840097364686600160570735710605, 1619253008376079830967680273);
        _basicERC20PoolHandler.repayDebt(1673798751, 5694842710945459528642451559494, 283670364632203665819796449);
        _basicERC20PoolHandler.pullCollateral(6440809887369074468946703546240400837213546534, 2703097808456042804242921317, 1280483304446323279875015625413976687208364448);
        _basicERC20PoolHandler.moveQuoteToken(2645907677966809348905615900887, 1000290596345984668, 8911595135731625941490882255952, 1000114004480165314, 999999999999999492047613175637745184412049525);
        _basicERC20PoolHandler.moveQuoteToken(17910056905799029767578947, 1864370690112038787667315417001207317411, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 749884739185720130);
        _basicERC20PoolHandler.pledgeCollateral(0, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2);
        _basicERC20PoolHandler.removeCollateral(29916223351185949468184326014674437876671, 4589, 52359455270961644929860673030618666251977951329658, 107072856710625989514364630708);
        _basicERC20PoolHandler.addQuoteToken(4993846574496845238683822200553772267301, 183, 29385267992611576362491572129746482837, 565);
        _basicERC20PoolHandler.addQuoteToken(1000000587241149501, 4116061719989634076062029107625, 6527585355223355420736028299386, 1000911055401543919);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1470588913202219277134099465404333890924499099636114330, 573574378967188764061305709654269675491379293416, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addQuoteToken(6140956152846499655446977014073860862591380590488851, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 51907021185997214374267034487848418094701660362324021482169247216619633872456);
        _basicERC20PoolHandler.transferLps(261107, 7446853454023879126467395434433, 506895469181496737976330135, 7619952985071068405252281695334, 6154220663342048290252790511294);
        _basicERC20PoolHandler.drawDebt(688145878123546326583851366405289536070038389815044157043873133851063296, 7068007098627274874879419480, 7572765270442657913100320178565);
        _basicERC20PoolHandler.addCollateral(132849244362624672017210770, 160220481144050675301217580027770099132176677062347807, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 4635788663783749582745368569664957810107889387318368328644395925, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 118711021541658804984564302878252);
        _basicERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 0, 8445096883336947366831914851854070736188169226787134562965608120754828249, 31702553921285986);
        _basicERC20PoolHandler.addCollateral(580611839910456831033498928563420669329295299872174796, 365592807736295354208641933456297478927564166157028915669712361006111378, 28139754781488792473550239412555, 16783034798732718173574507487472772049042281150918117690);
        _basicERC20PoolHandler.removeQuoteToken(3894404124500698217057152848884, 27478283841917457404525494988, 3021754851825746291696621607292, 1000001004962305311928772643717);
        _basicERC20PoolHandler.addQuoteToken(468, 2, 43724, 1152399744924008194743423951);
        _basicERC20PoolHandler.repayDebt(796770899347121193810335509368635, 788797746707273155957044869328, 325418985476243884442958426017);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 7422932955149615012023501180176513465114, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.moveQuoteToken(11029268151348809599542295670992, 1674842588, 8836271060776756896119326907222, 688281732625303322675897722815970653485080269470846731021832930365693760, 535384403053933584684655656);
        _basicERC20PoolHandler.pledgeCollateral(1574478871504291917188801399286, 4544847225095148439060231333417, 130666618043756744430885952105154);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 342447337001, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.transferLps(2, 0, 855521114601779757043497214366146208917380641227576, 6763612574518268953226767616, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.removeQuoteToken(4611889325915228483301526481319615, 38084, 42580832955904510762171045873877, 2636152856526958443712217183212702);
        _basicERC20PoolHandler.removeQuoteToken(29970599961641859108393123641560445894663409577582723877517332108011544504464, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 135, 13893178818345121509111186504303183497844);
        _basicERC20PoolHandler.pullCollateral(5769192817483987112721415532428, 16259463482118041401855347103, 1543735509442123611738770410327);
        _basicERC20PoolHandler.removeQuoteToken(1628467737203148079868996591494, 447404570018145143444980749, 4762130513423858141603250586289, 1885022364152755698804721861718);
        _basicERC20PoolHandler.addQuoteToken(0, 1, 69913830042719777813687647207537411321915157217229742561136685684500709, 3);
        _basicERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _basicERC20PoolHandler.pledgeCollateral(536503026894930742915592263726, 5958204048624414206720153263482, 981672851175865744292519803023);

        invariant_fenwick();
    }
}

contract RegressionTestBasicWith50BucketsERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        super.setUp();
    }

    function test_regression_prototech_R13() external {
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.moveQuoteToken(34182676062, 970158087771364439539778133424113234, 1, 50017338003875636400341733247242921922496740278556121448487335793831930540, 3067532913292792342692150086977398352312578700620413579318);
        _basicERC20PoolHandler.drawDebt(5820082102171667022399950811436, 3242640055857068520668315784493, 670710516457);
        _basicERC20PoolHandler.moveQuoteToken(18145807299774538093937063302654, 1000052996020447694427851, 999989257700734373607181, 4396684808555526263271298132905, 2040535202705094120750690683233);
        _basicERC20PoolHandler.pullCollateral(999994871987446319721815, 1771329963446586802365734, 3269844105608643793722252149332);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0, 31699623829);
        _basicERC20PoolHandler.pledgeCollateral(100521140450422249462631192163, 688711965012732107216775029442215211430100176853223388571240788410003740, 1000000038832137544);
        _basicERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 28259776562747879);
        _basicERC20PoolHandler.moveQuoteToken(13227714780918418725924618016471, 1000146889692929679, 181096, 12598590786881105095850906999362, 19547576362155410255197798970);
        _basicERC20PoolHandler.drawDebt(2445750000640898853895126377044012123625962211732271243639090268644970, 1226525778761671239062908923649185239656, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeQuoteToken(352216804030123402021476683379469812418976779508, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 220361129521238981038610009680920044527620204581081624098826, 4342705436174701075);
        _basicERC20PoolHandler.transferLps(15469132485381641406, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 3, 10478733579022428786263005561292836351);
        _basicERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1450472351063547097553538654575, 4360285342926014934612718913145244103756206329784014643152);
        _basicERC20PoolHandler.addCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1174);
        _basicERC20PoolHandler.addQuoteToken(30220971133366294501, 243003300871099990949027014890592935041180747299780466704988276, 113235329182260719232995, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.transferLps(16642157611467936440569657737277, 1000000564971977347, 779955687682199966516445294, 1841174764418171586902213447971, 17109525202894744223411871130636);
        _basicERC20PoolHandler.addQuoteToken(4628384247688151425960544334498, 1758, 1000001001818547780833711878284, 1000865946948674394);
        _basicERC20PoolHandler.pullCollateral(1000001549840829808, 6979389713326688733594586551375, 4159551138396654646110244116807);
        _basicERC20PoolHandler.addCollateral(2848598129910512528776540017, 2602419939490867698246836676, 109073038504450877860386096, 1000000479725015747);
        _basicERC20PoolHandler.pledgeCollateral(0, 1476900985911136504704276797056466511450983313463939089209026327, 67595003238650535);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.moveQuoteToken(9670419769248949774800707926208, 60823513514244421877066315413, 6955353851318930798747740600082, 2297996183579663219653985824192, 5944723110224316486837885781149);
        _basicERC20PoolHandler.removeQuoteToken(3, 28456151173306127960, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 5111020854338401000450129316971226786719635576935235061677566665);
        _basicERC20PoolHandler.drawDebt(164864961660056213136949045650818218259364943982438645, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2808415713057137184);
        _basicERC20PoolHandler.drawDebt(371182083582924222, 1213375982307012570761066659911, 12305028137790809861836936374898);
        _basicERC20PoolHandler.addQuoteToken(5383995493679536971408170876304, 7951413802159919618251860204, 816672615588694807138518414763, 1000000651245620735);
        _basicERC20PoolHandler.drawDebt(2170933527641554808432382958442, 1000000215429981916, 131549605740758997979114);
        _basicERC20PoolHandler.transferLps(3, 918634844508, 3, 39891819650340625376565560528019860193625293493949445392378264398084, 2253607610782397438736724710089998662244917416809926042768);
        _basicERC20PoolHandler.removeQuoteToken(21322176756892, 1000000213488331991, 1566233042159894090237861894903, 16400660656922335382876703038);
        _basicERC20PoolHandler.removeCollateral(96190203153722691908494290138138525821290763886274385, 3, 924960416667555308752565715119267014114460, 82572182916673747619796921052573954549989552210038073082085);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 1951109388690811936097463166849145488, 421481079897247115942816911681545106515673173, 1837649641068518025495752648868694759231878699127623631469758858);
        _basicERC20PoolHandler.repayDebt(370993871622948567674, 8803249075720986523963443459001, 892262914386273471823938221);
        _basicERC20PoolHandler.repayDebt(1000000313939407996, 810371183977029455607295701312, 8956201731365026391592268154203);
        _basicERC20PoolHandler.moveQuoteToken(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 149178867143);
        _basicERC20PoolHandler.pullCollateral(46922780519814871870648929833, 1394294415673464291858604382753, 1001981804814325054);
        _basicERC20PoolHandler.pullCollateral(3, 742665369587500954226, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.pledgeCollateral(14115264187845706996338756671094, 4243081351457659367880406525817, 1375352289744147236012812151379);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.removeQuoteToken(6016843246592103049412676106117, 1000000009006415793, 20967964041879472799, 999987932743761792167896685610);
        _basicERC20PoolHandler.transferLps(2, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1154606772447034032354398494953, 0);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 161243354823191951247460113103779636030986165035459547);
        _basicERC20PoolHandler.addCollateral(1000003691272481734376617742701, 8608919335388172166347599924299, 4927136669678064201439860291727, 780795723222220925849345098);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.drawDebt(3503800829570632267366382856602, 1000002534521444810, 3814431522930428690554509537);
        _basicERC20PoolHandler.repayDebt(0, 3, 4904518825344111961288104089044319);
        _basicERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 15717841331141925937847780875499980360430316510053, 2, 121038187619052413);
        _basicERC20PoolHandler.moveQuoteToken(1000000008076584618, 5848473612237151881205558739064, 16737200700400270965457876048, 12909756433240243654774318756355, 689636489280006190849750735644981284975298969525225815988428057446939637);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1776239217836263630273227850499853262728452447501079199654229550312166, 18958693491382425313784050802);
        _basicERC20PoolHandler.removeQuoteToken(6321400534613396948884872067838, 1518841243531096, 999997412112133608812341745998, 10593051961274112956526086648677);
        _basicERC20PoolHandler.transferLps(1864492503439917513276430185205322227504844595833265979727172078052219, 2289427242241238318584841332309776577784727569708975882267244, 14807865, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2730707600860794794182625456252919176240757);
        _basicERC20PoolHandler.transferLps(22665728832597595555842398342358091060, 3586064999759931378417, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 2746657);
        _basicERC20PoolHandler.repayDebt(3, 0, 1);
        _basicERC20PoolHandler.addQuoteToken(3952677405859396231243898748794, 1000000000000009077, 12390108199112777329521961839757, 1133435712117577842092762150604);
        _basicERC20PoolHandler.removeQuoteToken(12189652672028427613127767117, 8335094658810698638489294500404, 1012998195122322954429741707667, 5249371392796101794093236537531);
        _basicERC20PoolHandler.pledgeCollateral(12498829903090800316241132513242, 4185636787667213755609790093964, 4737680543264837093962806837543);
        _basicERC20PoolHandler.pledgeCollateral(40435468535850044013638377183811390714835838251366683963791296541459631182848, 2948832383984762819926392130776195389832433020044048887, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 212785604240372785056038204462164218237303810082422344934946404516707584, 38852096081423364867136, 57055017697057773477432240343786106803836878017413586718672007437185669130497);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 167, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 57111957065967803818328222647995239792299726723495816518651167923118496);
        _basicERC20PoolHandler.pullCollateral(768050145529224110062949895269, 4755641899219745401173943879575370735, 787874331566309775038256692273);
        _basicERC20PoolHandler.transferLps(4303624829255551207045973198, 7110582288270656432486703809487, 8232718412259171875949879648181, 14282796296304386992646004987, 26131769629372394412954298591469624218);
        _basicERC20PoolHandler.addQuoteToken(1278839501218636457, 5656224067017713672205841751393131163945177132650831508064773814423077619, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _basicERC20PoolHandler.removeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1461847506878979628291816951183841970946275, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.addQuoteToken(14258127157546991695282170542158, 837138141666261854451366298631, 25653, 364428639066466789269042042986);
        _basicERC20PoolHandler.removeCollateral(1921692115640573313101402738641, 689886279340064385908758923199347264617981106303732792840948669549183427, 2031088078793900122413848513112153220, 7138170918334767277916486396643);
        _basicERC20PoolHandler.pledgeCollateral(1511353038936459134502580364878, 2043244881870722399788508519770, 26653102029042634786875641102);
        _basicERC20PoolHandler.pullCollateral(62276, 1000000068833961250, 1000000286846249238);
        _basicERC20PoolHandler.addCollateral(13580791985062569414787422942, 999999999999999999981250576485242675207594068, 830381646401724020117576571967, 4715948711718905117365009);
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2674847475107919674613160046754229363688358737171513424588627867114, 867109411835157619, 1291588174268998263142035221308);
        _basicERC20PoolHandler.removeQuoteToken(688856767768271816027278624575311075717188152626663277965609186781089580, 10069909736302378753441306081789, 866965658436353434972092230696, 1817875723060286662483706081716);
        _basicERC20PoolHandler.pullCollateral(157602042593879091886344073, 2030619065581629836457288503232, 1000003568990023384);
        _basicERC20PoolHandler.removeCollateral(3767612674406241380377242769722, 976095192206253656600786703, 1003944374632095261975019259907, 3665460639048944854902466666809546285);
        _basicERC20PoolHandler.moveQuoteToken(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 78655967765677870982872666273855466508430720542091345, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.addCollateral(24823885281544015638993198742571509593400853639305703712982316110243, 23433291684564865928324855, 186990142917149, 196464933555953772514942038852666087283878235427470);
        _basicERC20PoolHandler.addQuoteToken(914615192243660269178196561226, 3264916079688089910712842280737, 15099541215479868329375770832495, 16106966662265309271896997391412);
        _basicERC20PoolHandler.drawDebt(8654068440603694010473536924776, 542849309957011288320562573377, 13815448423648449677576886336926);
        _basicERC20PoolHandler.moveQuoteToken(1000001047420103858706177912990, 688711520726501630491143647600535920945463831514539666507710456194059178, 7943866912446475257, 787978275380069954857407747099, 19542985318092056031923417687380406410);
        _basicERC20PoolHandler.repayDebt(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _basicERC20PoolHandler.pullCollateral(142506589264250689125620329918129386078292305990372876791272, 792018812521466583012060658532097173421905728409338239087115, 778958633583197084611360132555488597141816616783347060197193756112763);
        _basicERC20PoolHandler.moveQuoteToken(1, 32756108603327786636688571964074895176, 2, 2, 3);
        _basicERC20PoolHandler.transferLps(0, 11115726873345345610543832099664320098982701867258553090356878022288048684, 382381577216, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1052666780622375078788026794671691863376129);
        _basicERC20PoolHandler.removeCollateral(2029055755780415275396907741399, 4019803831193014523556208246224, 1513852721012395704665449510550, 8258463717540407168463041113581);
        _basicERC20PoolHandler.drawDebt(1362710248000, 3, 118);
        _basicERC20PoolHandler.transferLps(5694979460976308736849238011715, 167987481489083223837961783846, 2049652644973835441541466385140, 1000001446772934858, 166475089333512454377295226218);
        _basicERC20PoolHandler.removeCollateral(689803447108905672378405905283151101429586032854360596881580649156448645, 9979851052523547534061513730271, 6313020450165589039984210098583, 627213088713399867246918082);
        _basicERC20PoolHandler.addQuoteToken(1999991459229058123295302, 3514606977856790899185240338673, 5817606439554584156630424188939, 2985052539206461887948651048760);
        _basicERC20PoolHandler.moveQuoteToken(318508679946408, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 24435201506425761445689317859169);
        _basicERC20PoolHandler.pledgeCollateral(1664724, 113655680583891580800407288357237136768, 47877492598459766182049934352663221628937507353710925495422);
        _basicERC20PoolHandler.drawDebt(10363521532033957916836719200970, 4134301431609115339827687813469882693, 401950858153446921587198974);
        _basicERC20PoolHandler.drawDebt(41193067028073771300319060281311291690073227384391, 311405431062242676888570909675743064068291219858226726775, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.repayDebt(439329704426936210385611193, 3495404292170272792573718008310, 787900489350008246419924933447);
        _basicERC20PoolHandler.transferLps(3, 231308143841887834474860344, 0, 1, 32317);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0, 39317366240620493086814317208);
        _basicERC20PoolHandler.drawDebt(15033620233709468536040400036471, 4371806179501691912902094292012, 1829458267153534443419428770942);
        _basicERC20PoolHandler.drawDebt(2802397417581221556077471418929, 1000000130303688234, 1770814287895931020186227484105);
        _basicERC20PoolHandler.removeQuoteToken(1, 843499327028574795657740238801801820843115887452931987426816152455910605634, 3, 3306921663970944303501116638790069224076371271312111422712306896102623);
        _basicERC20PoolHandler.addCollateral(999997425020157000840529, 787976025626386380219429245062, 787934480261659729454180168871, 7996922132153285840642367949337);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 4553767367766, 75612072153481239189746174128787401338352179750923);
        _basicERC20PoolHandler.addQuoteToken(4944799575657565807539570, 2, 1880692182446467268621612580813509324116968258735857911702814878, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.transferLps(11793206468696045209650051357308, 15771382973377845625507732906438, 12280085661987828376847131723964, 86966966660282772566197527208069279, 13860703128300828489000048381049);
        _basicERC20PoolHandler.removeCollateral(4553222405570054494656155910392, 928585425127793252005108621, 999997375923835377804922, 1000000505095340149);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 45442370797512183704053209, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1);
        _basicERC20PoolHandler.repayDebt(3, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.pledgeCollateral(1000000001692916428, 1636667790499253211485483959980, 6211176347631734764269560778483);
        _basicERC20PoolHandler.moveQuoteToken(27571292828755508, 2204117331749706325081561466372, 12204383037718011175247418867396, 11054130208935028107610300106157, 8155809803846312112751701590099);
        _basicERC20PoolHandler.repayDebt(79045204198949795420201380180540395372768527609204317615800469543755965, 8528493885709873602052381, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.pledgeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2);
        _basicERC20PoolHandler.addCollateral(668375853357549364344056913017418361056, 1046871752362931010392086957451, 594330259435544309632822650588, 1000001243935780341888730865639);
        _basicERC20PoolHandler.removeQuoteToken(4693665025378, 440810499353370202, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.transferLps(2, 1, 847205150922176, 436708, 511579442783773064516955879630);
        _basicERC20PoolHandler.addCollateral(13560267846422118775249872430545, 1999882654503269369069508, 1000010146973850428, 1000008482465432493640764877929);
        _basicERC20PoolHandler.repayDebt(336197300923494585554796632167, 10155900671545374603174699141017513816, 36084762525716605830429161072512730292986926669475210696482198144838317073999);
        _basicERC20PoolHandler.addCollateral(1000000161041243310, 2575960022281475175982579524828, 223263738353014583975759724, 8700);
        _basicERC20PoolHandler.repayDebt(2774031588075072969324472221787054155743, 11832110369641083745008510601647, 3208141661742968816520687471971);
        _basicERC20PoolHandler.repayDebt(4238125953327187143851272602362177766036095116704636491139273473, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.transferLps(4271962157284283007454279163904093786245775611, 202792388122062917340740, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 19775904609742339560618359582341954247630, 3);
        _basicERC20PoolHandler.pullCollateral(9624327937688671426063332896781, 11309367046694359349137945137404, 9659332590899017806788972960905);
        _basicERC20PoolHandler.pledgeCollateral(15, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.removeQuoteToken(3439263013327512135655010954711, 1290450362564154915504532084768, 212087356835500867124390920, 1000449269301454476);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 40279612661425308613413822546811247623384534225372328480542312815858079891, 0);
        _basicERC20PoolHandler.removeQuoteToken(16218674510859937728693485425261, 787978903125484366274407648561, 688609312267804320429342744383472849315534960104665668737408918887369129, 1000000068704764762);
        _basicERC20PoolHandler.pullCollateral(13010477148891715695361425035987857837961057377674873363, 2, 101774073669224520235539709250931963723360531284754782900522021389);
        _basicERC20PoolHandler.transferLps(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 6693884092424998197247908018222155215907184615, 16056913, 3);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.repayDebt(496396272, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2);
        _basicERC20PoolHandler.pullCollateral(659144238942009179054853811485973835077558547879514, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.removeQuoteToken(6281313659141, 11884600926566596018596478401728, 1219087170786459469437673368220, 2025986271801134642134767147638);
        _basicERC20PoolHandler.removeQuoteToken(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 326112127925564999331094045378376475949212737440980971941446411943479, 6434500791985149496307106);
        _basicERC20PoolHandler.pledgeCollateral(0, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.addQuoteToken(3050848821909768682548083885285, 657285911950424895960167051152, 1000000345383959543, 3551890758024576379487654379038);
        _basicERC20PoolHandler.failed();
        _basicERC20PoolHandler.transferLps(790000389142176500354676968467, 390957163211204477939790150, 999997226614847188977575294777, 819833956051706757616758943, 4702808693545516525059706965683);
        _basicERC20PoolHandler.removeCollateral(0, 81507328931651368522732704547, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 44641732331038083710146152, 3);
        _basicERC20PoolHandler.moveQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 36995998982918705004305838922559087019775570527569699337708391043056694164110, 0, 32648679133944744925452901857755038220487237950);
        _basicERC20PoolHandler.pledgeCollateral(517810995908884773027406481753381341891787678755315856013335539380597328, 3, 1);
        _basicERC20PoolHandler.moveQuoteToken(1000001256591839641, 3858261878126232107618622969749, 6699896036225213357561556468740, 5428305498675686790270631743555200284, 1000008666990508201);
        _basicERC20PoolHandler.removeQuoteToken(16531139506126214667308130500593945395567974, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.drawDebt(45610128979952496045855015702, 2101995276247489019573071744224814217240474714592266458, 0);
        _basicERC20PoolHandler.pledgeCollateral(16046200698497380185688514323448, 787947709349614574234544822738, 1999955393517448374456517);
        _basicERC20PoolHandler.pullCollateral(2301056252919105944332393152113, 1676370555, 688952062228195401711591903150611336999632712826113848843443138966099153);
        _basicERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 7, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 5692944822977849548454191257061399739102011277539921908328258669878, 161281995902);
        _basicERC20PoolHandler.pledgeCollateral(8040895546020147179462673209969, 930614716073010374174302672489, 5794941217569108778312997123478);
        _basicERC20PoolHandler.removeQuoteToken(2, 77377643242386754458231666851486392635592, 1, 8897597992366348148003297039128815811278334269180);
        _basicERC20PoolHandler.removeCollateral(1000176460561907671, 824341507961999036588320651433, 14124187503256689898855077718204685, 1759767984295968367711509234947);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 936, 276468659489867952101577774339005907, 194994617060293408);
        _basicERC20PoolHandler.addQuoteToken(14918286105829437940827061931884, 1000000005572987789, 809414650642727705886104932220, 1000000176025067676);
        _basicERC20PoolHandler.drawDebt(2515277558514612949179880208389, 10830688000723917443509040203965, 4080691289040392958393941806641);
        _basicERC20PoolHandler.moveQuoteToken(13959223451345792911680537756287, 1114120938876567787055889625443, 1000000024526944150, 3757235766550055725705624, 9554347516069769924900997398605);
        _basicERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.removeQuoteToken(3, 342730, 907485979751436669189383329785018303435983, 3);
    }

    function test_regression_prototech_R18() external {
        vm.setEnv("QUOTE_PRECISION", "6");
        vm.setEnv("COLLATERAL_PRECISION", "6");

        setUp();

        _basicERC20PoolHandler.drawDebt(8610950656866698149703667322, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2957072626826143835923340786513923311);
        _basicERC20PoolHandler.pullCollateral(12221672537733006607770, 55196022227499777, 329580468254324473134);
        _basicERC20PoolHandler.addCollateral(11738798130952868, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1076083879369, 4356154);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 9045265070224768078933056779354580670983060687111863442959, 442755543045705050213456416813716348808036095386767949505304, 1071304108983398616053476277402079455339204883793822017);
        _basicERC20PoolHandler.repayDebt(13412794478054627999906810689932, 823633941646465634075408025682, 714246153571865300760303572146);
        _basicERC20PoolHandler.addQuoteToken(7486986084195651716458434897639, 1000000664010591218, 999914887205083282385961, 999985349735554704748005);
        _basicERC20PoolHandler.transferLps(487648, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3868565841888539883563965410106, 2374507191547192227724457270596843019313139981943688698822712);
        _basicERC20PoolHandler.transferLps(689398924496056613691032738434157115168193601982832565776589432118434001, 9145175593727453394097749794255, 14787629956578272478, 20733937950822055339911461111987, 2000004548842457416230943);
        _basicERC20PoolHandler.addQuoteToken(1, 1, 19970066149439701117472862136, 5736394984046250309200325076914005570040);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 24935051074824334928071690968307380, 325483530522);
        _basicERC20PoolHandler.addCollateral(769734662906903542025005387356111556688784492093856706807262335, 285182884945322520945210733747532522143075882604792030406497, 11476809992691040954671027345377461996648243631519456563, 1100195040152269636516334608609215598296068687791874552932280382029749);
        _basicERC20PoolHandler.moveQuoteToken(5695564060379210077844338, 345695996057729595665245433223659963133359129113904107539355, 2, 0, 264902151750310089643307);
        _basicERC20PoolHandler.addQuoteToken(584290825868243852358036, 205602919042137110288106678, 35447041625849908005193683530596, 1000000000040745749);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 228550014);
        _basicERC20PoolHandler.moveQuoteToken(632745769610149887932357980527, 3753578404012007965145014740, 2909170827804392931243507251897, 21857135740246108574701114069379, 1000000000005342227);
        _basicERC20PoolHandler.addQuoteToken(3, 3, 0, 3);
        _basicERC20PoolHandler.transferLps(89127314388534690433761377515895533917773773732325115881593636557663315814474, 1, 34341289433952255917813315526469051462562409760, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.pledgeCollateral(9376769682553370399581822893243, 777261192856506080090875212654, 11266164282434237130682702614353);
        _basicERC20PoolHandler.addCollateral(3, 0, 26616765982773322256439597140652, 215339150857146737);
        _basicERC20PoolHandler.removeCollateral(1000003952445366322, 2009130552584451600000000000000, 4264063035757426951000000000000, 9630012716190359756807170320761);
        _basicERC20PoolHandler.pledgeCollateral(0, 15609258654503368, 2073541312975615497698);
        _basicERC20PoolHandler.moveQuoteToken(16455725644507200635075951786, 12745610022219460676935783182256, 331417736077068136476907449015927662756410290874565252660769459, 8615368476648199680000000000000, 5907889703849609229965754883086);
        _basicERC20PoolHandler.addCollateral(1494155660179479635021255697058, 4876300464539913368300168937377, 1000001376523017421, 2000000117034496909604523);
        _basicERC20PoolHandler.pullCollateral(3761287161370000000000000, 866535061383111992000000000000, 14259601191223676791963893966128);
        _basicERC20PoolHandler.moveQuoteToken(2000015874494446566431630, 347881045069010781270695144905, 8490607480371992463, 774771695091328741059450156647, 7101274555459050508402816);
        _basicERC20PoolHandler.addCollateral(1, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3);
        _basicERC20PoolHandler.repayDebt(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 35184409811768);
        _basicERC20PoolHandler.removeQuoteToken(710965066212411763415542778140, 1134410221369583, 1000000182878688276, 23603606016898269855379283663418);
        _basicERC20PoolHandler.addQuoteToken(378392735311298488736926645577047, 2, 624001358380741582157712635859553145965105843255, 549153487321800511338877383597987623815306029025);
        _basicERC20PoolHandler.pledgeCollateral(759777067783342925963720213699, 105858314493208551929743587, 2069001278169244466419);
        _basicERC20PoolHandler.repayDebt(6663, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(412312006929191, 2232700348781204894652609231950, 929967212873753935348640950692, 2930106927206943005518098596512);
        _basicERC20PoolHandler.removeCollateral(3170228021293353111528417808377, 4359858948799370183937144152116, 1042949223261126759990106840865, 2508659655056078568187550126344);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 14260106444473657978717944622556904140595776596, 17811095678730745411673157595760376, 2);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 130701502066868037935841408563398868399565889922428, 1, 47139846906334973640625557568749815753942535994419);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 108237482200245656555431115741541924211787191778279992620923909669358, 836727670924962740296317914298160620869376611497954724, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 239645398748203918394378963183725601225680588427380377);
        _basicERC20PoolHandler.moveQuoteToken(6836689636704157927615581974553, 662444129140363218769516800761, 9934438604392253724266745186361, 12337601713236770234092099436769, 13802010996130259168549321573778);
        _basicERC20PoolHandler.pullCollateral(488806873552836977119875720658576413267447187, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.pledgeCollateral(2, 4427457646367660527726711929407213622225, 0);
        _basicERC20PoolHandler.pledgeCollateral(91571647272549443994839235883943541130185605861950643216853, 0, 9764372746114538896908141035026025570008644754688394770981400001628);
        _basicERC20PoolHandler.moveQuoteToken(8650729477265957135526746, 10465352225960142538155118210642, 309762490667623715700389746771, 10626216672954330611762488735894, 2179353863188761820762300389820);
        _basicERC20PoolHandler.addQuoteToken(1000000525247835785708896, 8048389194820429704232257172673, 999622979586719714397, 799149065053565683419177);
        _basicERC20PoolHandler.moveQuoteToken(2, 31603355378740650724968506296841678012951645216607945286, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 244506867455973073970853910500074117583819, 49376142919106304462042114);
        _basicERC20PoolHandler.repayDebt(5574355003382296028143020515978, 7044573207597829770190274292235, 2956686194891288);
        _basicERC20PoolHandler.moveQuoteToken(2833576484131924009885513156905944623189, 13806887408248354127932221349155598372430, 901519481314065, 7, 76606);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 5753025402025816828735460102460470817153737668705871620970966, 767454369187102894829236024300788364532897203638488263889910, 3578877792994885231119001989635157027204546495729256344);
        _basicERC20PoolHandler.pullCollateral(1000000059103663918, 14519918341147206813148532091059, 384091302923626057719282923);
        _basicERC20PoolHandler.drawDebt(17850248286715690192008180615423, 1704101778991800029778978452501, 1000018501570415662);
        _basicERC20PoolHandler.transferLps(1206658042181513171262049436167233118598028968465465521, 284476046937780528651371129, 1715560165987886328285441562733323478423003432933042, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeQuoteToken(14172105761662118261681284413839729644202784646868976722154038514, 3, 2804251439030950389256959390835637945198, 14875389964642);
        _basicERC20PoolHandler.addCollateral(39543756085918795476056663554519944676038620820628397002281798, 4217614779006745092567056923508953372398254101384554720907408061, 3003209123163739059044386468076054645728521231259864437244750, 273507747462378673905);
        _basicERC20PoolHandler.pledgeCollateral(7740017442266093962688716082595, 2234430355345000000000000, 7140474430549016734000000000000);
        _basicERC20PoolHandler.moveQuoteToken(1, 52177248948567192184494220122634162382317029219280351118, 3, 1, 1);
        _basicERC20PoolHandler.repayDebt(1, 14035293867, 747891235436551);
        _basicERC20PoolHandler.addQuoteToken(36645717695490850481029502763970540095237599713408936504056597, 3, 1, 7994805400408563987902421454);
        _basicERC20PoolHandler.addQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 610086277501157880684796787387724900311737671358462595791, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.moveQuoteToken(1, 2235962185351637708632975123940277608970005320941693648847125493216390, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.removeQuoteToken(16688702675254346275462706262912076270881025881882465450, 414345276736171, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 365714925548120884844907954501748744987890114060015816951766380147495);
        _basicERC20PoolHandler.pullCollateral(617159095793287210038279142364, 2150848617803, 261241087997724837914455911013956130188638745874314233791);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 122257892088991717138947643548296334771932226858376868301251676105, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.moveQuoteToken(1, 5102571212561874496875732, 400044393115889421709632, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 222149028339436374480);
        _basicERC20PoolHandler.removeCollateral(786570662425115383171823382962, 715376604759265683761007447819, 1000000325796230281, 33588737318749466815043588854742);
        _basicERC20PoolHandler.addCollateral(505722, 12242574676285136021265601248818510753020289019257520995929385689505765, 2, 525880689973883);
        _basicERC20PoolHandler.addQuoteToken(10573174300240611, 6533166142938008061514668085599, 6641521052794384986716994908006, 1000057175288732094);
        _basicERC20PoolHandler.transferLps(24495191220467426815376214680354715318620115341898882186851930878237, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3580273083272368012319376153679, 3, 139472833439292252552777284750309249598390885616377173335359);
        _basicERC20PoolHandler.moveQuoteToken(3137120365091873707121671, 3770305792242247571057047021222, 688073744140267036874581419021233769495951461622902378777029232481467137, 2727549361961145420040936341265, 912967853890579112467883629158);
        _basicERC20PoolHandler.removeCollateral(1, 702962994960136423450962369774954940760416938573495301567315355168, 3, 76147649129026008);

        invariant_exchange_rate();
    }
}

contract RegressionTestBasicWith10BucketsIndex6500ERC20Pool is BasicERC20PoolInvariants { 

    function setUp() public override {
        // failures reproduced with 10 active buckets
        vm.setEnv("NO_OF_BUCKETS", "10");
        vm.setEnv("BUCKET_INDEX_ERC20", "6500");
        super.setUp();
    }

    function test_regression_prototech_R7() external {
        _basicERC20PoolHandler.addCollateral(
            2,                               // actor index
            787978178697424804260644669040,  // amount to add, 787978178697.42480426064466904 * 10^18
            6502,                            // bucket index
            13838                            // skipped time
        );
        _basicERC20PoolHandler.transferLps(
            7,           // from actor index
            5,           // to actor index
            1672524930,  // lps to transfer
            6502,        // bucket index
            83798        // skipped time
        );
        _basicERC20PoolHandler.removeCollateral(
            5,      // actor index
            37232,  // amount to remove
            6502,   // bucket index
            46650   // skipped time
        );

        invariant_bucket();
    }
}


contract RegressionTestBasicWith50BucketsIndex500ERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "500");
        super.setUp();
    }

    function test_regression_prototech_R9() external {
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 311855305968157744570601481773144);
        _basicERC20PoolHandler.addCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeCollateral(169050319556909991808, 3, 0, 1);
        _basicERC20PoolHandler.addCollateral(1004201281585420667067519110248, 7102026478996272106877444035857, 1000005176609260307609491, 3305068122278678061826709665672);
        _basicERC20PoolHandler.removeCollateral(5126250508003894776370908264788, 491360638543797591635259813352, 787983051556723253156194660814, 3320088216653581211669326645577);
        _basicERC20PoolHandler.repayDebt(12396923902833375051988245672959, 7853833558731273234852069656215, 4854998063651887910481309782641);
        _basicERC20PoolHandler.addQuoteToken(22492324757351622016450338305141639519921418025875019955286375595978, 7375145817336195198480525641381057, 4038098431544972508850862464533, 590641590);
        _basicERC20PoolHandler.moveQuoteToken(2, 18642700475706059316512354602605761623058115872316, 0, 389852391755003176683454195550428602558533101523111398325617912, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeCollateral(183508, 4655513824786435541548325526158, 6727168359250653708446790113706, 689384358901091345705449093185695413140861121050633943735045187092801409);
        _basicERC20PoolHandler.removeCollateral(887908587686943510167377721632, 459811254525365132505830027215, 4833907401013214004421139781796, 353362243998154774896346551976);
        _basicERC20PoolHandler.removeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 12898304536022767664608434174578363454046958904043510776692055820203777739, 115792089237316195423570985008687907853269984665640564039457584007913129639932);

        invariant_exchange_rate();
    }
}
