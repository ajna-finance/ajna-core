// SPDX-License-Identifier: UNLICENSED

pragma solidity 0.8.18;

import { BasicERC20PoolInvariants }       from "../../../invariants/ERC20Pool/BasicERC20PoolInvariants.t.sol";
import { LiquidationERC20PoolInvariants } from "../../../invariants/ERC20Pool/LiquidationERC20PoolInvariants.t.sol";
import { ReserveERC20PoolInvariants }     from "../../../invariants/ERC20Pool/ReserveERC20PoolInvariants.t.sol";

/***********************************/
/*** Basic ERC20 Pool Regression ***/
/***********************************/

contract PrototechRegressionTestBasicWith10BucketsIndex6500Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 10 active buckets
        vm.setEnv("NO_OF_BUCKETS", "10");
        vm.setEnv("BUCKET_INDEX_ERC20", "6500");
        super.setUp();
    }

    function test_regression_prototech_R7() external {
        _basicERC20PoolHandler.addCollateral(
            2,                               // actor index
            787978178697424804260644669040,  // amount to add, 787978178697.42480426064466904 * 10^18
            6502,                            // bucket index
            13838                            // skipped time
        );
        _basicERC20PoolHandler.transferLps(
            7,           // from actor index
            5,           // to actor index
            1672524930,  // lps to transfer
            6502,        // bucket index
            83798        // skipped time
        );
        _basicERC20PoolHandler.removeCollateral(
            5,      // actor index
            37232,  // amount to remove
            6502,   // bucket index
            46650   // skipped time
        );

        invariant_bucket();
    }
}

contract PrototechRegressionTestBasicWith10BucketsERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 10 active buckets
        vm.setEnv("NO_OF_BUCKETS", "10");
        super.setUp();
    }

    function test_regression_prototech_R1() external {
        _basicERC20PoolHandler.drawDebt(289417789361174372031056620741, 1000326246414552022, 1672427362);
        _basicERC20PoolHandler.addCollateral(3, 1363197669977567662485698544889893768624935214644, 176983931167823887652565227718535462076497, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(911338679565033631452753933741615870561500127200336515196, 100678485169218822286975041, 562157048161658889287796612, 396901311837079147383971976);
        _basicERC20PoolHandler.removeCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 43710635734924245562, 1);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }

    function test_regression_prototech_R2() external {
        _basicERC20PoolHandler.addQuoteToken(3, 1220382137948272011446728337739826893, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(1038320573183676909240324237485386031762797434733405183946263329789040728, 1130330236254, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3033887066257962770966405067568203133014825658008469487494673162404);
        _basicERC20PoolHandler.drawDebt(0, 31916080285492740679802985241918096165647794897794462450, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeQuoteToken(3, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1245491196095668653353385336965919096300160969748209210);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }
}

contract PrototechRegressionTestBasicWith50BucketsERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        super.setUp();
    }

    function test_regression_prototech_R18() external {
        vm.setEnv("QUOTE_PRECISION", "6");
        vm.setEnv("COLLATERAL_PRECISION", "6");

        setUp();

        _basicERC20PoolHandler.drawDebt(8610950656866698149703667322, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2957072626826143835923340786513923311);
        _basicERC20PoolHandler.pullCollateral(12221672537733006607770, 55196022227499777, 329580468254324473134);
        _basicERC20PoolHandler.addCollateral(11738798130952868, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1076083879369, 4356154);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 9045265070224768078933056779354580670983060687111863442959, 442755543045705050213456416813716348808036095386767949505304, 1071304108983398616053476277402079455339204883793822017);
        _basicERC20PoolHandler.repayDebt(13412794478054627999906810689932, 823633941646465634075408025682, 714246153571865300760303572146);
        _basicERC20PoolHandler.addQuoteToken(7486986084195651716458434897639, 1000000664010591218, 999914887205083282385961, 999985349735554704748005);
        _basicERC20PoolHandler.transferLps(487648, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3868565841888539883563965410106, 2374507191547192227724457270596843019313139981943688698822712);
        _basicERC20PoolHandler.transferLps(689398924496056613691032738434157115168193601982832565776589432118434001, 9145175593727453394097749794255, 14787629956578272478, 20733937950822055339911461111987, 2000004548842457416230943);
        _basicERC20PoolHandler.addQuoteToken(1, 1, 19970066149439701117472862136, 5736394984046250309200325076914005570040);
        _basicERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 24935051074824334928071690968307380, 325483530522);
        _basicERC20PoolHandler.addCollateral(769734662906903542025005387356111556688784492093856706807262335, 285182884945322520945210733747532522143075882604792030406497, 11476809992691040954671027345377461996648243631519456563, 1100195040152269636516334608609215598296068687791874552932280382029749);
        _basicERC20PoolHandler.moveQuoteToken(5695564060379210077844338, 345695996057729595665245433223659963133359129113904107539355, 2, 0, 264902151750310089643307);
        _basicERC20PoolHandler.addQuoteToken(584290825868243852358036, 205602919042137110288106678, 35447041625849908005193683530596, 1000000000040745749);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 228550014);
        _basicERC20PoolHandler.moveQuoteToken(632745769610149887932357980527, 3753578404012007965145014740, 2909170827804392931243507251897, 21857135740246108574701114069379, 1000000000005342227);
        _basicERC20PoolHandler.addQuoteToken(3, 3, 0, 3);
        _basicERC20PoolHandler.transferLps(89127314388534690433761377515895533917773773732325115881593636557663315814474, 1, 34341289433952255917813315526469051462562409760, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.pledgeCollateral(9376769682553370399581822893243, 777261192856506080090875212654, 11266164282434237130682702614353);
        _basicERC20PoolHandler.addCollateral(3, 0, 26616765982773322256439597140652, 215339150857146737);
        _basicERC20PoolHandler.removeCollateral(1000003952445366322, 2009130552584451600000000000000, 4264063035757426951000000000000, 9630012716190359756807170320761);
        _basicERC20PoolHandler.pledgeCollateral(0, 15609258654503368, 2073541312975615497698);
        _basicERC20PoolHandler.moveQuoteToken(16455725644507200635075951786, 12745610022219460676935783182256, 331417736077068136476907449015927662756410290874565252660769459, 8615368476648199680000000000000, 5907889703849609229965754883086);
        _basicERC20PoolHandler.addCollateral(1494155660179479635021255697058, 4876300464539913368300168937377, 1000001376523017421, 2000000117034496909604523);
        _basicERC20PoolHandler.pullCollateral(3761287161370000000000000, 866535061383111992000000000000, 14259601191223676791963893966128);
        _basicERC20PoolHandler.moveQuoteToken(2000015874494446566431630, 347881045069010781270695144905, 8490607480371992463, 774771695091328741059450156647, 7101274555459050508402816);
        _basicERC20PoolHandler.addCollateral(1, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3);
        _basicERC20PoolHandler.repayDebt(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 35184409811768);
        _basicERC20PoolHandler.removeQuoteToken(710965066212411763415542778140, 1134410221369583, 1000000182878688276, 23603606016898269855379283663418);
        _basicERC20PoolHandler.addQuoteToken(378392735311298488736926645577047, 2, 624001358380741582157712635859553145965105843255, 549153487321800511338877383597987623815306029025);
        _basicERC20PoolHandler.pledgeCollateral(759777067783342925963720213699, 105858314493208551929743587, 2069001278169244466419);
        _basicERC20PoolHandler.repayDebt(6663, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.addCollateral(412312006929191, 2232700348781204894652609231950, 929967212873753935348640950692, 2930106927206943005518098596512);
        _basicERC20PoolHandler.removeCollateral(3170228021293353111528417808377, 4359858948799370183937144152116, 1042949223261126759990106840865, 2508659655056078568187550126344);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 14260106444473657978717944622556904140595776596, 17811095678730745411673157595760376, 2);
        _basicERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 130701502066868037935841408563398868399565889922428, 1, 47139846906334973640625557568749815753942535994419);
        _basicERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 108237482200245656555431115741541924211787191778279992620923909669358, 836727670924962740296317914298160620869376611497954724, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 239645398748203918394378963183725601225680588427380377);
        _basicERC20PoolHandler.moveQuoteToken(6836689636704157927615581974553, 662444129140363218769516800761, 9934438604392253724266745186361, 12337601713236770234092099436769, 13802010996130259168549321573778);
        _basicERC20PoolHandler.pullCollateral(488806873552836977119875720658576413267447187, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _basicERC20PoolHandler.pledgeCollateral(2, 4427457646367660527726711929407213622225, 0);
        _basicERC20PoolHandler.pledgeCollateral(91571647272549443994839235883943541130185605861950643216853, 0, 9764372746114538896908141035026025570008644754688394770981400001628);
        _basicERC20PoolHandler.moveQuoteToken(8650729477265957135526746, 10465352225960142538155118210642, 309762490667623715700389746771, 10626216672954330611762488735894, 2179353863188761820762300389820);
        _basicERC20PoolHandler.addQuoteToken(1000000525247835785708896, 8048389194820429704232257172673, 999622979586719714397, 799149065053565683419177);
        _basicERC20PoolHandler.moveQuoteToken(2, 31603355378740650724968506296841678012951645216607945286, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 244506867455973073970853910500074117583819, 49376142919106304462042114);
        _basicERC20PoolHandler.repayDebt(5574355003382296028143020515978, 7044573207597829770190274292235, 2956686194891288);
        _basicERC20PoolHandler.moveQuoteToken(2833576484131924009885513156905944623189, 13806887408248354127932221349155598372430, 901519481314065, 7, 76606);
        _basicERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 5753025402025816828735460102460470817153737668705871620970966, 767454369187102894829236024300788364532897203638488263889910, 3578877792994885231119001989635157027204546495729256344);
        _basicERC20PoolHandler.pullCollateral(1000000059103663918, 14519918341147206813148532091059, 384091302923626057719282923);
        _basicERC20PoolHandler.drawDebt(17850248286715690192008180615423, 1704101778991800029778978452501, 1000018501570415662);
        _basicERC20PoolHandler.transferLps(1206658042181513171262049436167233118598028968465465521, 284476046937780528651371129, 1715560165987886328285441562733323478423003432933042, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeQuoteToken(14172105761662118261681284413839729644202784646868976722154038514, 3, 2804251439030950389256959390835637945198, 14875389964642);
        _basicERC20PoolHandler.addCollateral(39543756085918795476056663554519944676038620820628397002281798, 4217614779006745092567056923508953372398254101384554720907408061, 3003209123163739059044386468076054645728521231259864437244750, 273507747462378673905);
        _basicERC20PoolHandler.pledgeCollateral(7740017442266093962688716082595, 2234430355345000000000000, 7140474430549016734000000000000);
        _basicERC20PoolHandler.moveQuoteToken(1, 52177248948567192184494220122634162382317029219280351118, 3, 1, 1);
        _basicERC20PoolHandler.repayDebt(1, 14035293867, 747891235436551);
        _basicERC20PoolHandler.addQuoteToken(36645717695490850481029502763970540095237599713408936504056597, 3, 1, 7994805400408563987902421454);
        _basicERC20PoolHandler.addQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 610086277501157880684796787387724900311737671358462595791, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.moveQuoteToken(1, 2235962185351637708632975123940277608970005320941693648847125493216390, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _basicERC20PoolHandler.removeQuoteToken(16688702675254346275462706262912076270881025881882465450, 414345276736171, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 365714925548120884844907954501748744987890114060015816951766380147495);
        _basicERC20PoolHandler.pullCollateral(617159095793287210038279142364, 2150848617803, 261241087997724837914455911013956130188638745874314233791);
        _basicERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 122257892088991717138947643548296334771932226858376868301251676105, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.moveQuoteToken(1, 5102571212561874496875732, 400044393115889421709632, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 222149028339436374480);
        _basicERC20PoolHandler.removeCollateral(786570662425115383171823382962, 715376604759265683761007447819, 1000000325796230281, 33588737318749466815043588854742);
        _basicERC20PoolHandler.addCollateral(505722, 12242574676285136021265601248818510753020289019257520995929385689505765, 2, 525880689973883);
        _basicERC20PoolHandler.addQuoteToken(10573174300240611, 6533166142938008061514668085599, 6641521052794384986716994908006, 1000057175288732094);
        _basicERC20PoolHandler.transferLps(24495191220467426815376214680354715318620115341898882186851930878237, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3580273083272368012319376153679, 3, 139472833439292252552777284750309249598390885616377173335359);
        _basicERC20PoolHandler.moveQuoteToken(3137120365091873707121671, 3770305792242247571057047021222, 688073744140267036874581419021233769495951461622902378777029232481467137, 2727549361961145420040936341265, 912967853890579112467883629158);
        _basicERC20PoolHandler.removeCollateral(1, 702962994960136423450962369774954940760416938573495301567315355168, 3, 76147649129026008);

        invariant_exchange_rate();
    }
}

contract PrototechRegressionTestBasicWith50BucketsIndex500ERC20Pool is BasicERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "500");
        super.setUp();
    }

    function test_regression_prototech_R9() external {
        _basicERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 311855305968157744570601481773144);
        _basicERC20PoolHandler.addCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _basicERC20PoolHandler.removeCollateral(169050319556909991808, 3, 0, 1);
        _basicERC20PoolHandler.addCollateral(1004201281585420667067519110248, 7102026478996272106877444035857, 1000005176609260307609491, 3305068122278678061826709665672);
        _basicERC20PoolHandler.removeCollateral(5126250508003894776370908264788, 491360638543797591635259813352, 787983051556723253156194660814, 3320088216653581211669326645577);
        _basicERC20PoolHandler.repayDebt(12396923902833375051988245672959, 7853833558731273234852069656215, 4854998063651887910481309782641);
        _basicERC20PoolHandler.addQuoteToken(22492324757351622016450338305141639519921418025875019955286375595978, 7375145817336195198480525641381057, 4038098431544972508850862464533, 590641590);
        _basicERC20PoolHandler.moveQuoteToken(2, 18642700475706059316512354602605761623058115872316, 0, 389852391755003176683454195550428602558533101523111398325617912, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _basicERC20PoolHandler.removeCollateral(183508, 4655513824786435541548325526158, 6727168359250653708446790113706, 689384358901091345705449093185695413140861121050633943735045187092801409);
        _basicERC20PoolHandler.removeCollateral(887908587686943510167377721632, 459811254525365132505830027215, 4833907401013214004421139781796, 353362243998154774896346551976);
        _basicERC20PoolHandler.removeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 12898304536022767664608434174578363454046958904043510776692055820203777739, 115792089237316195423570985008687907853269984665640564039457584007913129639932);

        invariant_exchange_rate();
    }
}

/*****************************************/
/*** Liquidation ERC20 Pool Regression ***/
/*****************************************/

contract PrototechRegressionTestLiquidationWith50BucketsERC20Pool is LiquidationERC20PoolInvariants {

    function setUp() public override {
        vm.setEnv("NO_OF_BUCKETS", "50");
        super.setUp();
    }

    function test_regression_prototech_R5() external {
        vm.setEnv("QUOTE_PRECISION", "6");
        vm.setEnv("COLLATERAL_PRECISION", "6");

        setUp();

        _liquidationERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _liquidationERC20PoolHandler.bucketTake(1, 44461073860243257956329708045865382381622555748477789302722, false, 0, 79347249036400230858899360483216604358272416528);
        _liquidationERC20PoolHandler.moveQuoteToken(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 3468248190431594592925185332382922, 3);
        _liquidationERC20PoolHandler.removeQuoteToken(2571, 29969932493659093579519920003174531009094912319404669505414364044045886423040, 10590, 5151534821115945192353164396480956473511573634899664160920884112447096424265);
        _liquidationERC20PoolHandler.addQuoteToken(76329009890, 2, 2, 1674344150413686970531450343526);
        _liquidationERC20PoolHandler.takeAuction(2, 2, 179117141720001013602245162251826270509403099827771, 706945742363711658875079945979959946928029538714449846316257823749420726580);
        _liquidationERC20PoolHandler.removeQuoteToken(1181282925764360404276943162707598106995676, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 391477748674803396321030233163086423661214769);
        _liquidationERC20PoolHandler.pledgeCollateral(55400, 2984075702, 2839);
        _liquidationERC20PoolHandler.kickAuction(3285505261586, 2390890078691961684256746925213816912737812482917, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _liquidationERC20PoolHandler.withdrawBonds(69064799185578049928162507577850320714069641703745944312650055827195794732674, 20761, 11569);
        _liquidationERC20PoolHandler.repayDebt(1, 1507729902546837970557030645551705998292433406008323392687486, 255139);
        _liquidationERC20PoolHandler.failed();
        _liquidationERC20PoolHandler.removeQuoteToken(847108075881, 42162244106064982390, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _liquidationERC20PoolHandler.pledgeCollateral(1139872047305319828329319702900629531630147801503024602238950376239270491, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 661230912199721);
        _liquidationERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 372744813196399714519399926917647299094014976270437803, 2820097493008818092337602368055496904404410450846957902300803247165784, 173467464882758185083557, 11482305045332324833614739919808727240718678);
        _liquidationERC20PoolHandler.kickWithDeposit(0, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.removeQuoteToken(44196108561, 959859487311170472139557427, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.drawDebt(1312093315543461913781047720589269967180454, 221271430054517801486904020700382587418626242738, 14016013892798531558012100646932474885842079882403824111180458899503053382);
    }

    function test_regression_prototech_R19() external {
        _liquidationERC20PoolHandler.bucketTake(3, 146429783616384180849592991936019650523314, false, 53139180002, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _liquidationERC20PoolHandler.removeQuoteToken(3, 59725457124377207483, 910945517205681107614835808699209805953219515717967553, 16387895106486345806715656347485125396892333604619688726755178430335);
        _liquidationERC20PoolHandler.removeQuoteToken(1000561672232527661686486, 87873523925062603086237824606930, 202413146459819720155430314143, 1123542634173226255528132406942);
        _liquidationERC20PoolHandler.drawDebt(409283853852391483985288776289, 4194592198347684180157520303517, 999967850134954057303732);
        _liquidationERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1124393109);
        _liquidationERC20PoolHandler.moveQuoteToken(1000020339815077618920000000000, 8097325768103315778599144912870, 1032792963286422367947261, 8665401249122512093765629687, 36601418513795);
        _liquidationERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 2519054241350621417746359966858813, 44562767757099250587166607855848);
        _liquidationERC20PoolHandler.bucketTake(3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, false, 1, 4568712686826639834090501);
        _liquidationERC20PoolHandler.moveQuoteToken(789063145184450559739706996021388133680023330229784336740638454680268959, 450594962923948238540000000000, 1999999999999999999999999999999794644453611705, 8465193686110166937589557539901, 10339587912398321821943572821449);
        _liquidationERC20PoolHandler.bucketTake(37441200799886, 32888100569498, true, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _liquidationERC20PoolHandler.pullCollateral(522219313872608839, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.addCollateral(0, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 15968194698742);
        _liquidationERC20PoolHandler.kickAuction(1000057132268475867127974, 7204555709397916016183356689085, 1419376713890394934526032027353, 6632757565220436491095858059742);
        _liquidationERC20PoolHandler.addCollateral(2329891825399834443530000000000, 1003265591359947213, 9336120550484473, 1021215461314647625940397847086);
        _liquidationERC20PoolHandler.takeAuction(8184428443828266349213692016358, 2048797100914327299264373216830, 989515595429036610692955614559, 250424601044133382354442);
        _liquidationERC20PoolHandler.settleAuction(2, 33481369021589, 149148710039007591636845895037427260230281645143162979, 3);
        _liquidationERC20PoolHandler.bucketTake(1218715631377785649651184211362367434156064694629796763664, 689, false, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 134330043710534800159375285894422663336139057491);
        _liquidationERC20PoolHandler.pledgeCollateral(19599062340875527676405566865, 91195259341996654004892, 5353044051101867084751811959365943968156246697209055040627196888717406153503);
        _liquidationERC20PoolHandler.kickAuction(2, 0, 3, 1);
        _liquidationERC20PoolHandler.pledgeCollateral(40770172449844004547001578055579347601994086493351, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 52122230885206760929105461807278);
        _liquidationERC20PoolHandler.removeQuoteToken(195507411380126215099113528092083546010733792798227219281, 1, 144759743046128481044536244556095243362045460899921494302000436956240, 1);
        _liquidationERC20PoolHandler.repayDebt(0, 2473861788278577456552751246563684239979014885018476787001, 1);
        _liquidationERC20PoolHandler.takeAuction(275653185531903385984289007, 974005867492267922112333498, 39422625832217285748680294398, 632493824590115665210000000000);
        _liquidationERC20PoolHandler.takeAuction(1000000000006003053, 2156019376206333175397003792224, 13525679699098751385619866801462, 5883059969726926208070021166571);
        _liquidationERC20PoolHandler.addCollateral(38106769140065340496445941148921, 914446861396065494494774492712, 132105158784728224915354076868436, 26484264067426313892760182056);
        _liquidationERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1532903294790092742021906905570144870578284156105342441629016165274228947, 3, 2);
        _liquidationERC20PoolHandler.kickWithDeposit(2117094175447831677576620378161, 8452721478740162, 10302392823801389709309931842264);
        _liquidationERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 2, 9681449122811687478019129425564610008133337660494);
        _liquidationERC20PoolHandler.settleAuction(1, 3, 13084269823973179053980426994278720150378474483498343876526136951, 1098273546995278229442622620282361570906);
        _liquidationERC20PoolHandler.takeAuction(1969381645399570394974017447775, 4744897916139589403209196971356, 1000021968166020712, 5185393015585021259329084663473);
        _liquidationERC20PoolHandler.drawDebt(76676614927238608144749396067, 207908075327053809457875609120, 5312104895695434926933369270489);
        _liquidationERC20PoolHandler.kickAuction(7806675018592113033000000000000, 999997831669241209869280131288, 12822190641844681496401516853821145256035067398014485773459521943310607070009, 1000021840331763877);
        _liquidationERC20PoolHandler.settleAuction(32893479572441619603910, 3667163205960758751258550446232, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 112677600365768362356667964427635034961901414781);
        _liquidationERC20PoolHandler.bucketTake(271326550775423829066412371, 125977291045448523722777513534, false, 5331386135933959240490915718072, 806795195469399158646250180);
        _liquidationERC20PoolHandler.drawDebt(20527553681289916947572802276, 4664834305984031275914089502221584833255872145935283437982449118557609, 319172407835010863181101104823);
        _liquidationERC20PoolHandler.transferLps(2, 2, 441790021479867017440282018578944757817783, 40299500021407765792227609483690, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.drawDebt(545696220248709416145202921679168578733470634910168, 3, 9090433724610200571679232754233638373205942356292885722961721968173115);
        _liquidationERC20PoolHandler.removeQuoteToken(2, 2773914119445664388816637807739037, 705969983610056301460550338712787128086897813740796386934289, 1913665014180278309727171088862194829498208604);
        _liquidationERC20PoolHandler.removeCollateral(2, 1, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);

        invariant_exchange_rate();
    }
}

contract PrototechRegressionTestLiquidationWith50BucketsIndex1ERC20Pool is LiquidationERC20PoolInvariants {

    function setUp() public override {
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "1");
        super.setUp();
    }

    function test_regression_prototech_R15() external {
        _liquidationERC20PoolHandler.bucketTake(1385052599556021215003977673406, 990917882033313106213081300998, false, 3058865338667682331615618172106, 6457836522988788837151813736424);
        _liquidationERC20PoolHandler.takeAuction(0, 383, 20247295629524574940066032483251481926306576215340523651308, 10099470924035142355288374);
        _liquidationERC20PoolHandler.kickAuction(25882820578115540341160135353646809801338805855958363098678418646245833410, 354497598826560417181664483819212548533864578180468, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 17630718222372807828715462032887247);
        _liquidationERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, false, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _liquidationERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 6409836001091911315999904045133712);
        _liquidationERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 22533775154711735056881906809804476232953914203441931257415993903218632803, 3, 0);
        _liquidationERC20PoolHandler.settleAuction(1788967492023312321936125553065828045965563466653, 1668386941953668372731559, 187664265608882673953569512699, 20401978651528095526014704549956935022725369089);
        _liquidationERC20PoolHandler.addQuoteToken(394301716671595233798119361773279689852008758009031969401337575, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 6580558083566173);
        _liquidationERC20PoolHandler.settleAuction(1000026360230184623608201, 3445033123318933827907509914363, 8341568484289776315188972577996, 97743170805643825076665511);
        _liquidationERC20PoolHandler.transferLps(22608024113365095905584131452586028419270976193494306118281696290898985, 4461392298422715704774948, 2, 7846121570888180, 331392658758838563647203297249878207);
        _liquidationERC20PoolHandler.repayDebt(11698528811210192396351422646626, 2280035964984916837444558076982, 946922613349713677617598738003);
        _liquidationERC20PoolHandler.settleAuction(721541049170869524534845911477519041194899408936855489382846493028286662695, 92565402695990540562562919637, 1004806469796271346446984441011, 412399875357809146503163133);
        _liquidationERC20PoolHandler.kickWithDeposit(115792089237316195423570985008687907853269984665640564039457584007913129639933, 656300418695953408530813878943170659, 1);
        _liquidationERC20PoolHandler.takeAuction(23167766422813360944322594861698583030, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 18371215130007, 154042139961746405);
        _liquidationERC20PoolHandler.removeQuoteToken(16581130443054062792053099565786, 82006613552073764251704758982666586639757573675137319445886509306574244670174, 399503514902688198786683762902, 1584974834931813176157302188001);
        _liquidationERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 756289706172057271129663005793149327528967350131125151435120252, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3034979985391077148518907493258006498774414125002734091810702534231056276);
        _liquidationERC20PoolHandler.repayDebt(6654960686622131769183103900894, 155283068073448285181394986660, 6086045371597712528227318934402);
        _liquidationERC20PoolHandler.pledgeCollateral(3743769722231122165591523578230, 4500045263587737169171865251275, 5072070803320573920497012264481);
        _liquidationERC20PoolHandler.kickAuction(1000201037552821841, 8220654264447126154453009315190, 999999794183687144539960, 1000113972004784141);
        _liquidationERC20PoolHandler.drawDebt(281386195115693375966709207, 3901581716893502478060756691606, 35384);
        _liquidationERC20PoolHandler.removeQuoteToken(3, 0, 1243430, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _liquidationERC20PoolHandler.bucketTake(97345306443579698471872863296731644454017981112310798743, 5097744324262305618803451333516871213204886788557904266905027885950348, false, 15976607071872348505532550924741413111663206793776080940491903785, 0);
        _liquidationERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 36117836052233398260956981148387392517, 158089829806239236878783692384690887729226316917813242, 3);
        _liquidationERC20PoolHandler.bucketTake(439745608561618692346292483450499249047450803078311, 10547674864087612574890602963119232697, true, 306357957930947756827036148861840, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.kickWithDeposit(10495414043, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _liquidationERC20PoolHandler.removeCollateral(2028613, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 577661336610046132410646096489019863);
        _liquidationERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 514110685473872, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2);
        _liquidationERC20PoolHandler.takeAuction(20673646728439025426136023323770124885, 675549037640195962340401361, 4219316359517260616958832563315, 5361358460803438);
        _liquidationERC20PoolHandler.pledgeCollateral(836154626029672691412606981, 999995397459114661347661, 17738258297094895528175599087533);
        _liquidationERC20PoolHandler.kickAuction(2820798244021991794430513123516028345, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1103681980234531514393212784, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 49688976461470241);

        invariant_exchange_rate();
    }
}

contract PrototechRegressionTestLiquidationWith50BucketsIndex500ERC20Pool is LiquidationERC20PoolInvariants {

    function setUp() public override {
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "500");
        super.setUp();
    }

    function test_regression_prototech_R16() external {
        _liquidationERC20PoolHandler.addQuoteToken(222824056091539352103099518518, 6908422496652948227271391533841565559925821938589013282380131207858790559, 854363592005599904841121550660184017, 867721758570404399564681631750325440612);
        _liquidationERC20PoolHandler.addQuoteToken(113304447994612032591102229246041934562130844266200097729476379895250320001, 250727017149033100, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 17887);
        _liquidationERC20PoolHandler.repayDebt(839990245840537306736956875050236745206700673547262961260674089976522358, 10279420159251068418574458724579, 5179038749702114880438683177665);
        _liquidationERC20PoolHandler.drawDebt(105463852237945978654413587679529447907143160831989290368397, 217830913061103073772894479062250419406379446492696510304742234, 16823017451486653335804037);
        _liquidationERC20PoolHandler.drawDebt(65560352226836288671650433936821869080009956276359574, 2, 272341973229250323501602040);
        _liquidationERC20PoolHandler.bucketTake(185388, 787993503357722422751175746777, false, 49356, 15219683800512975283599883588);
        _liquidationERC20PoolHandler.addCollateral(4895930161, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3);
        _liquidationERC20PoolHandler.repayDebt(1, 48310169647183411507622994540615605142770642706008658126323, 22218436100678269593421894808879360074309501666766667591023753168667);
        _liquidationERC20PoolHandler.settleAuction(1661455008298629960728171342, 1000028070523539295416133, 1000000000000189887, 6885245340527986);
        _liquidationERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 3);
        _liquidationERC20PoolHandler.removeCollateral(4490144, 0, 10485928828330580113025711005901987478167458321501231987, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _liquidationERC20PoolHandler.pledgeCollateral(26392580796650444495425293968335184940157814424160135907639723660, 106988274798026976977279836536472418138643809749820666803121429977606092, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _liquidationERC20PoolHandler.addCollateral(4010451895, 0, 0, 8698070588399420446006298133437);
        _liquidationERC20PoolHandler.drawDebt(787997390534979763658015747527, 75158412324705347529304172780, 34126655123631865258985660589);
        _liquidationERC20PoolHandler.bucketTake(0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, true, 58325228541798219, 46879470386212548896463084421868545681838);
        _liquidationERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 0, 2);
        _liquidationERC20PoolHandler.addQuoteToken(15670251649456336657418538321892911066554499791729214493, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _liquidationERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 141304, 116421204516200424467471207929650287);
        _liquidationERC20PoolHandler.transferLps(145190921232816023182892286, 1485941539225043538397320587314507326067352452158533353618, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _liquidationERC20PoolHandler.settleAuction(59187491596573159249736785, 1000037597434362742415953, 1000030080817004171716578, 8033135760671800090451265694419);
        _liquidationERC20PoolHandler.removeCollateral(13541, 161558818314562805641082490823, 25451037223374894068393097185, 11821924003532119629408154513630);
        _liquidationERC20PoolHandler.addQuoteToken(7631483691962568244522447172661, 7394757119628189112940101463722, 1000005918459929031, 170496);
        _liquidationERC20PoolHandler.removeCollateral(10138714927350544265475002383399, 5800502327830269972549365931395, 7186916090471575266361529622290, 936554436414113970624847531);
        _liquidationERC20PoolHandler.removeCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 127);

        invariant_exchange_rate();
    }
}

/**************************************/
/*** Reserves ERC20 Pool Regression ***/
/**************************************/

contract PrototechRegressionTestReserveWith30BucketsERC20Pool is ReserveERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 30 active buckets
        vm.setEnv("NO_OF_BUCKETS", "30");
        super.setUp();
    }

    function test_regression_prototech_R3() external {
        _reserveERC20PoolHandler.drawDebt(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 126768300275249757890745);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 995386543778, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _reserveERC20PoolHandler.kickAuction(3, 2, 812654262134658424, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeQuoteToken(999999999999999426444582247143509387950866739, 1148181505672158329590024, 1367070079813696596859779764, 1040389191213838886625616);
        _reserveERC20PoolHandler.bucketTake(577389696155710288147167555978498172752201411440998018353873, 1227885260722585562430938444424231, false, 953332261, 1);
        _reserveERC20PoolHandler.removeCollateral(1, 3, 129, 3);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }

}

contract PrototechRegressionTestReserveWith50BucketsERC20Pool is ReserveERC20PoolInvariants {

    function setUp() public override {
        vm.setEnv("NO_OF_BUCKETS", "50");
        super.setUp();
    }

    function test_regression_prototech_R4() external {
        vm.setEnv("QUOTE_PRECISION", "6");
        vm.setEnv("COLLATERAL_PRECISION", "18");

        setUp();

        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, false, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 629389231693603343090420846355692908992011);
        _reserveERC20PoolHandler.pledgeCollateral(3, 53169853533896920, 341072661804913043023705374260770467140993540280348);
        _reserveERC20PoolHandler.removeCollateral(111973960360662516013930094, 3352552064337538907813442926490670944060159242614645572852038340224210574, 1, 545333624399376476084257391749349);
        _reserveERC20PoolHandler.settleAuction(1489509608, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 69993407487415616534494782505433645691029338146149);
        _reserveERC20PoolHandler.pledgeCollateral(14144538895041942971455453361, 0, 440773331);
        _reserveERC20PoolHandler.moveQuoteToken(256683046249064075981530998512598309494759277454035029, 1, 1837621038310109860665949216782647, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.bucketTake(26584930879530192359355498830460972646562227504808988, 115792089237316195423570985008687907853269984665640564039457584007913129639935, false, 2, 8);
        _reserveERC20PoolHandler.withdrawBonds(115792089237316195423570985008687907853269984665640564039457584007913129639932, 706, 0);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 448988615907480764066289447553363364964061893704000862417584487, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3772119655156180605021002310588120706323486627177059, 351386226004590561001892712);
        _reserveERC20PoolHandler.takeReserves(2043306618522797815951284992753538703750711536592125564582, 490216404997999752194488565616055219608572826689336877699923643244785948, 8584693741458);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.pullCollateral(1778135265157395582031101925675, 20196, 1751190732327615354151450454);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.takeAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 247429948148584627149392386958522289920829622687852166342, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.takeReserves(361466280750769417526873054117455902300441173869322632522537, 776804005938781782558157697775153837076826088268880722908914, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.drawDebt(139839408536053689189893101355857, 1, 10528164681253760395808876505656603171974);
        _reserveERC20PoolHandler.kickAuction(3589583182297393115565481914547, 41668, 1380496931690591613721258081, 14181);
        _reserveERC20PoolHandler.drawDebt(9014812045836651946560288041872, 38936, 6000187733701002610517000054944);

        _invariant_B5_B6_B7();
    }

    function test_regression_prototech_R8() external {
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 78557303174308041778734334615587644696479966881076338654);
        _reserveERC20PoolHandler.takeAuction(3560826864064087890210355804405, 8284292134486334601283507356930, 8612466460181935917307640627212, 94540045629841522013535523);
        _reserveERC20PoolHandler.removeQuoteToken(3999696461585769999000000000000, 1000000341374338853, 1000005152162662430, 7806521369086789769619195765190);
        _reserveERC20PoolHandler.removeCollateral(1000000079710727920, 2442291669205387233489175410142, 3630990179810676200398910095887, 847460621439623237056681561553);
        _reserveERC20PoolHandler.drawDebt(0, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 135985618209023651363845897971107238825);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 208597913807247634776894828238887885811037126101064385679456085, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.bucketTake(2, 1260909788762840671758358338778353199817, true, 3, 36549019614253940332754096371716271132897522941003029875258656912);
        _reserveERC20PoolHandler.repayDebt(35713489707331852153713815703838, 54675432681904709533746720, 2393187281228813015650954835646777267961935332);
        _reserveERC20PoolHandler.takeAuction(26816616829814130052736205610, 840476540156857885437388890937788736444087716494897787526447368488481475, 3590891534464757143840616040497, 787976028865965176613015993688);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 6295930042333642635851406625482065259820298425180628, 5387548394542878692610948494821428577678571736563564372);
        _reserveERC20PoolHandler.drawDebt(232497233829821736118798889764531, 91783648873318007460774349557, 11367075991493289229595783043268);
        _reserveERC20PoolHandler.takeAuction(1068151859416301823588386646701, 52236647465285774440884114254, 16256848650468538085656571831723, 4709147646615738633196664188794);
        _reserveERC20PoolHandler.repayDebt(3098187355648893864949440625884, 1000000170419254742, 4131129972162903);
        _reserveERC20PoolHandler.addCollateral(0, 2, 1232641734641, 31343380291915790650373266756963988847);
        _reserveERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, false, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickWithDeposit(788004982292849387186182063285, 1940790819808691432528086343550, 731272264496848181811731492195469346809758718359079122899716176283941283);
        _reserveERC20PoolHandler.addQuoteToken(2, 14624, 617249058149064089429428, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.moveQuoteToken(1088872909900745236189950617, 15890612102926550116, 4582399149352835659555995253711, 13387122748009058461180259144937, 861762172514412847328248827402360937406130776600887962454677836216335656);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 26346071745620654135109826889565369349143698978199503472136502685355, false, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 153558817743023308082175787142765072463488294348201227240);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 353564705687242420491849365893149102127161943841371651, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeCollateral(0, 3, 240545812974653436443342144824960084537421810224363734800497, 0);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }

    function test_regression_prototech_R12() external {
        _reserveERC20PoolHandler.takeAuction(111503320743527282123336088690786562111577764908, 2, 0, 3);
        _reserveERC20PoolHandler.transferLps(3884277863890184536548790232, 1000226692427973497, 362994476962284067579436395, 2066937044638233220791038649593, 1000718160321343602459955);
        _reserveERC20PoolHandler.kickWithDeposit(3, 9667900678314907513590203324738, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 12902846031691147340, 164594771213835727638288874641553370090658299, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3);
        _reserveERC20PoolHandler.kickAuction(3843665, 25230739321792218739005704, 119030224870754091764872, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.bucketTake(11315247177110042886106595681008, 8983849823197858095975364450901, false, 2323824412855204507962581562067, 975533577556622775069616347005);
        _reserveERC20PoolHandler.removeCollateral(7233355785594062028431763095593, 6947671390716664781800259361797, 2364108272954507730086190160032, 10301490866825499872294480287093);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 4112196091939398247421478780, 295698663029349239584995560914499258798038249597687970011386);
        _reserveERC20PoolHandler.removeQuoteToken(471372357907081018126604252647929671966768923565, 9963734961594743791443895502790126625, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 7252780479954101);
        _reserveERC20PoolHandler.repayDebt(108897184340694126196795139755, 36700898877627830213326302979660, 1613376882108016651757155525162);
        _reserveERC20PoolHandler.repayDebt(3, 3802720423467490806103013386144, 7488771414153241121201212980506206179168581345544971233380361604150);
        _reserveERC20PoolHandler.bucketTake(3315852578453946052473353232357091, 1605043837665630743663925097180341306382557697767101130429, false, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.settleAuction(1000000001926677445, 1000013674615990447, 1000000027239572773, 4384567114608797998762814534076);
        _reserveERC20PoolHandler.pledgeCollateral(616089959610804892994591411, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3);
        _reserveERC20PoolHandler.addCollateral(7303157612488996292910680158533, 8683517032286817059918980008996, 6571126578955056670521252031880, 3374003485826167929533770956637);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 12001122478625899122741648191675138298539480304584223230591082185546865005);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0, 17484854529092657540121272054521, 4530198359262192);
        _reserveERC20PoolHandler.settleAuction(258036253576581410588367888874421089641813783163293463885972312089019, 115281501134680248099727350508114429794815738194211762269479998, 1, 3);
        _reserveERC20PoolHandler.removeCollateral(3, 3, 1324087175420087721900611665792906291, 11623313758043884894768017094890080965387351740069);

        invariant_exchange_rate();
    }
}

contract PrototechRegressionTestReserveWith50BucketsIndex1ERC20Pool is ReserveERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "1");
        super.setUp();
    }

    function test_regression_prototech_R10() external {
        _reserveERC20PoolHandler.kickWithDeposit(9433627986933283125646888807064008232, 221118523365400131, 2465980960817735242955065701468);
        _reserveERC20PoolHandler.settleAuction(2, 1465566755990294261551, 5446397116094743378510145168778507713319320588457, 1528994712721440933750048600830501692959831074023837696043986057926859);
        _reserveERC20PoolHandler.removeQuoteToken(2000454123866580850167634, 18691527695339216532215675622, 2279, 816);
        _reserveERC20PoolHandler.repayDebt(2016357865827986953341016567272966202336117189931, 1, 2849421575152156960123738830798059105666358364513420127963486);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 50295);
        _reserveERC20PoolHandler.repayDebt(0, 109490491610, 12885272574892044);
        _reserveERC20PoolHandler.bucketTake(5735945213, 21744658176442223517969005828038137972068113864460088, false, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _reserveERC20PoolHandler.kickWithDeposit(115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 405985353121972162110815290234023925555);
        _reserveERC20PoolHandler.takeAuction(5603471022574005901436218588047, 1095565616863252189, 3772604393288482751689957579532, 846289097042058312098640953448);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 187660066730418, 14515486327980056496462485304382041505225);
        _reserveERC20PoolHandler.pullCollateral(4045826300537223, 10970319889760213101329999562, 3107111484864040608557343630211);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 315913732638663056606786571747783579711294, 6878401216970078973504823110738235644526779251414339496339530375349478, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.repayDebt(399, 1107280160027881571797791241, 1067654314009615425);
        _reserveERC20PoolHandler.withdrawBonds(92677283704171672413890014768704922691759547486188, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.transferLps(1142320492736, 1039354567763026656227225353183096392431845, 1133565, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeCollateral(620295643990884064052682317994, 3479548635847919216642404792314, 31139391358677713536624267456, 997927134274017863451504696108);
        _reserveERC20PoolHandler.takeAuction(18952705199, 2, 3, 1);
        _reserveERC20PoolHandler.transferLps(16757043981847286919233728140768163175951732998670253725179139479010351816393, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.addCollateral(312365256502133030922762, 135841143703135003392052964, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 36605945297419456309);
        _reserveERC20PoolHandler.repayDebt(4414047393740330390612480465443, 1083481167464155738, 1000253506048277279);
        _reserveERC20PoolHandler.drawDebt(1120375840534728020787202533497600702079163901298843803557, 30151730334351818850625545607965363703836, 2);
        _reserveERC20PoolHandler.takeAuction(3908244488342148120639586075591, 80927671013312664913023315, 32204941362272668083664757400, 999999999999999675499740883457183941621439839);
        _reserveERC20PoolHandler.removeCollateral(23991626766082576672358660417241244, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935);

        invariant_exchange_rate();
    }
}


contract PrototechRegressionTestReserveWith50BucketsIndex500ERC20Pool is ReserveERC20PoolInvariants {

    function setUp() public override {
        // failures reproduced with 50 active buckets
        vm.setEnv("NO_OF_BUCKETS", "50");
        vm.setEnv("BUCKET_INDEX_ERC20", "500");
        super.setUp();
    }

    function test_regression_prototech_R17() external {
        _reserveERC20PoolHandler.addCollateral(197678, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.takeAuction(51562145830707312640686297651, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 836165679880232494128200621992);
        _reserveERC20PoolHandler.removeQuoteToken(190683739613859309621231179406196668, 11139, 788162131744413660713224679988, 811448245683171905935421896931081471102890553799751606214695987508871465);
        _reserveERC20PoolHandler.addQuoteToken(0, 18914767341883593082145991155549904829, 44258677495029480263163797136568828413100712785, 3);
        _reserveERC20PoolHandler.drawDebt(45100, 1178144011699920740241872509281, 2999999999999999359435960332122772167231077319);
        _reserveERC20PoolHandler.addCollateral(0, 158437481802859724160827237656305132689895025369622199686715, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.repayDebt(3069152107793872958060141423551, 808812483634812698230213408693559672, 10910887199223584157198);
        _reserveERC20PoolHandler.drawDebt(1034197756, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.addCollateral(1775015685034573028466471437290, 846386576856622138464602082177, 7208210957564807715107064935860, 1778286732641917607131040964834);
        _reserveERC20PoolHandler.removeCollateral(2805908331646119448797126753653, 1000000005961440909, 1000573584314734880, 2946971324400346613629861406187);
        _reserveERC20PoolHandler.withdrawBonds(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.moveQuoteToken(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 9712643765034225050915962, 46682769043988);
        _reserveERC20PoolHandler.removeCollateral(4643573428474119083863905049096, 1900756136, 1049514370472598628, 1000042388080949436211182);
        _reserveERC20PoolHandler.takeAuction(4604772779040364692966482996, 1018719297903985859204238589365, 6435463, 12936658684489119113561977309306);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 3137717894415033604438675247628414126129278320964911519270210382962);
        _reserveERC20PoolHandler.repayDebt(4377929121944, 4074033843091774413737392892238607292609159924582735309689579134, 73373299140376457406029691325274109293508305634464);
        _reserveERC20PoolHandler.kickWithDeposit(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 78381888898559226074023822312301457536253423426);
        _reserveERC20PoolHandler.repayDebt(1, 63177319003775515959478, 8930233654559205122776043352670093340626596133);
        _reserveERC20PoolHandler.transferLps(1813082927800051699848948074492, 6673145729685370939756153985086, 1013414194637543961, 1982, 66809);
        _reserveERC20PoolHandler.moveQuoteToken(781486194288092748029626811087512234868929543911, 676294221029944352850660106242863124963677, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1930099314341338319533334639898281050509992652025001782461, 1508452516839, 623568502028602696617478894480401587727361178155298253716);
        _reserveERC20PoolHandler.kickReserveAuction(149570407593092340494, 82282948842130275597800083);
        _reserveERC20PoolHandler.kickReserveAuction(125251217, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickReserveAuction(1682818450569631049120796210058, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.addQuoteToken(2844281832676776567928814185739, 1707126801, 5559324577395800135374848021550, 185015888831);
        _reserveERC20PoolHandler.takeReserves(2212572974349486725959816823549, 65001278015320540873390513, 7920602444691416);
        _reserveERC20PoolHandler.bucketTake(87236, 735493735087325306267032990, false, 2112687961, 10884986766744965142824643750827);
        _reserveERC20PoolHandler.removeQuoteToken(4372815925963057165071745490838, 847354478932336986685504238167190226510095108998880221051004591110148400, 37636, 270250573331891);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.moveQuoteToken(2, 5481605097243201612389058622203, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 0);
        _reserveERC20PoolHandler.takeAuction(1000098604066905223000000, 6137465804594685816191305015318, 298823001874298443546, 166082751517351907638663608563);
        _reserveERC20PoolHandler.takeAuction(3269103232793410157099157909026, 847924878688967506199464389378343384685830455787763277241025249039272831, 173, 189660);
        _reserveERC20PoolHandler.kickAuction(26973937893669191604374405808089687043064646451749217910, 1802399752779696, 2, 22835734832020186931842502710079521034686056014480913252043884080019);
        _reserveERC20PoolHandler.drawDebt(1788949561482813948527353928988, 11588320437893175935193248232, 887589095264450171687408509);
        _reserveERC20PoolHandler.removeCollateral(750038135256018104414375339875187123783051180216746391545514087578, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 2);

        invariant_exchange_rate();
    }
}