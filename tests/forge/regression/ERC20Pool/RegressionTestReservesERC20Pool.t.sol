// SPDX-License-Identifier: UNLICENSED

pragma solidity 0.8.18;

import { ReserveERC20PoolInvariants } from "../../invariants/ERC20Pool/ReserveERC20PoolInvariants.t.sol";

contract RegressionTestReserveERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override {
        // failures reproduced with 3 active buckets
        vm.setEnv("NO_OF_BUCKETS", "3");
        super.setUp();
    }   

    function test_regression_reserve_1() external {
        _reserveERC20PoolHandler.kickAuction(3833, 15167, 15812, 0);
        _reserveERC20PoolHandler.removeQuoteToken(3841, 5339, 3672, 0);

        invariant_reserves();
    }

    // test was failing due to error in local fenwickAccureInterest method
    function test_regression_reserve_2() external {
        _reserveERC20PoolHandler.bucketTake(19730, 10740, false, 15745, 0);

        invariant_reserves();
        _reserveERC20PoolHandler.addCollateral(14982, 18415, 2079, 0);

        invariant_reserves();
    }

    function test_regression_reserve_3() external {
        _reserveERC20PoolHandler.repayDebt(404759030515771436961484, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);

        invariant_reserves();
        _reserveERC20PoolHandler.removeQuoteToken(1, 48462143332689486187207611220503504, 3016379223696706064676286307759709760607418884028758142005949880337746, 0);

        invariant_reserves();
    }

    function test_regression_reserve_4() external {
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 0);  

        invariant_reserves();
    }

    function test_regression_reserve_5() external {
        _reserveERC20PoolHandler.addQuoteToken(16175599156223678030374425049208907710, 7790130564765920091364739351727, 3, 0);
        _reserveERC20PoolHandler.takeReserves(5189, 15843, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, false, 32141946615464, 0);

        invariant_reserves();
    }

    function test_regression_reserve_6() external {
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.removeQuoteToken(3, 76598848420614737624527356706527, 0, 0);

        invariant_reserves();
    }

    function test_regression_reserve_7() external {
        _reserveERC20PoolHandler.addQuoteToken(3457, 669447918254181815570046125126321316, 999999999837564549363536522206516458546098684, 0);
        _reserveERC20PoolHandler.takeReserves(0, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.takeAuction(1340780, 50855928079819281347583122859151761721081932621621575848930363902528865907253, 1955849966715168052511460257792969975295827229642304100359774335664, 0);

        invariant_reserves();
    }

    function test_regression_reserve_8() external {
        _reserveERC20PoolHandler.addQuoteToken(0, 16517235514828622102184417372650002297563613398679232953, 3, 0);
        _reserveERC20PoolHandler.takeReserves(1, 824651, 0);
        _reserveERC20PoolHandler.kickAuction(353274873012743605831170677893, 0, 297442424590491337560428021161844134441441035247561757, 0);

        invariant_reserves();
    }

    function test_regression_reserve_9() external {
        _reserveERC20PoolHandler.addQuoteToken(8167, 13910, 6572, 0);
        _reserveERC20PoolHandler.removeQuoteToken(450224344766393467188006446127940623592343232978, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 0);
        _reserveERC20PoolHandler.addQuoteToken(1338758958425242459263005073411197235389119160018038412507867175716953081924, 0, 3, 0);
        _reserveERC20PoolHandler.removeQuoteToken(13684, 7152374202712184607581797, 37874588407625287908455929174, 0);

        invariant_reserves();
    }

    function test_regression_reserve_10() external {
        _reserveERC20PoolHandler.drawDebt(3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.takeAuction(57952503477150200455919212210202824, 59396836510148646246120666527, 253313800651499290076173012431766464943796699909751081638812681630219, 0);

        invariant_reserves();
    }

    function test_regression_reserve_11() external {
        _reserveERC20PoolHandler.drawDebt(121976811044722028186086534321386307, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.removeQuoteToken(22099, 75368688232971077945057, 1089607217901154741924938851595, 0);

        invariant_reserves();
    }

    function test_regression_reserve_12() external {
        _reserveERC20PoolHandler.drawDebt(7201, 13634, 0);
        _reserveERC20PoolHandler.kickReserveAuction(4584, 0);

        invariant_reserves();
    }

    function test_regression_reserve_13() external {
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 540213858694280098848655811354140073005, 0);
        _reserveERC20PoolHandler.takeAuction(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 16744276840254269931315148200783781329474, 0);
        _reserveERC20PoolHandler.settleAuction(1052055081946638635908683442568, 2, 3, 0);

        invariant_reserves();
    }

    function test_regression_reserve_14() external {
        _reserveERC20PoolHandler.settleAuction(437841947740231831335707997666789355668988087441752683415964733126988332082, 147808166723925302409649247274, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);

        invariant_reserves();
    }

    /*
        Test was reverting when kicker and taker are same and kicker is penalized while taker is getting lps.
        Fixed by separating kicker and taker condition in 'bucketTake' handler
    */
    function test_regression_reserve_15() external {
        _reserveERC20PoolHandler.settleAuction(412239579320, 197270, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.bucketTake(2751494394076294863634, 102579647081354295527475262786, false, 20636732314060673687564, 0);

        invariant_reserves();
    }

    function test_regression_reserve_16() external {
        _reserveERC20PoolHandler.lenderKickAuction(24364934041550678417946191455, 52607039466540426076659653665991, 0);
        _reserveERC20PoolHandler.moveQuoteToken(12701858085177571414571267592, 42692775850651681314985098497603, 999999999999999997089137720115121650200233243, 110756792431977317946585133, 0);
        _reserveERC20PoolHandler.takeReserves(1000000005297961791, 4169814726576748738687746199368099036929520400874217254297794929654231, 0);
        _reserveERC20PoolHandler.takeReserves(3052809529665022333893308239466671666604242469878272137069, 2, 0);
        _reserveERC20PoolHandler.settleAuction(56829802927206056542134152487104, 1, 16551256, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 4559892907266199616760, true, 92132592320410512639572628067656882480659844625060229234412683145, 0);
        _reserveERC20PoolHandler.addQuoteToken(26659, 27252796304289191617124780530313880584663397025838797405583704016009646047240, 8174069071114126926049883726727, 0);
        _reserveERC20PoolHandler.settleAuction(7416752279321695807446009676282848840713503167567654621163487831711306738, 42429259698839522507819580090756, 4353185348715295869540288672, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, true, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.takeReserves(7414584624540108578389380660398591567646816233407392320795021351932076518, 119186585263660671065239170291646549528129172578, 0);
        _reserveERC20PoolHandler.takeReserves(14604452466686952199052773378, 15308, 0);
        _reserveERC20PoolHandler.moveQuoteToken(2, 7113439765, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 101839127799233627783, 0);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 0);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 175006273713916823228319530732179, 3, 0);
        _reserveERC20PoolHandler.kickAuction(999999999999999989948035804259829580593704779, 2999999999999999995605838724439103323477035837, 567178035339127142779327214, 0);
        _reserveERC20PoolHandler.lenderKickAuction(17028734043909648834002499445, 9578925065330517200577552073309, 0);
        _reserveERC20PoolHandler.addQuoteToken(6672165, 3776221923932077947607417775990788567, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);

        invariant_reserves();
    }

    function test_regression_fenwick_deposits_1() external {
        _reserveERC20PoolHandler.pledgeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.takeAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 22181751645253101881254616597347234807617, 0);

        invariant_fenwick();
    }

    function test_regression_incorrect_zero_deposit_buckets_1() external {
        _reserveERC20PoolHandler.addQuoteToken(26716, 792071517553389595371632366275, 1999999999999999449873579333598595527312558403, 0);

        invariant_fenwick();
        _reserveERC20PoolHandler.takeAuction(3383098792294835418337099631478603398072656037191240558595006969488860, 23280466048203500609787983860018797249195596837096487660362732305, 999999999999999999999999012359, 0);

        invariant_fenwick();
    }

    function test_regression_incorrect_zero_deposit_buckets_2() external {
        _reserveERC20PoolHandler.addCollateral(9093188371345232280759885514931620, 736370925, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.removeQuoteToken(2, 743823342719479363729966668312423206558602, 6003791801508574660825548152233943700089469549364090309, 0);
        _reserveERC20PoolHandler.removeQuoteToken(261467129238591107899210386032213509797152237956889, 1034, 48028560549472995, 0);
        _reserveERC20PoolHandler.addQuoteToken(261467129238591107899210386032213509797152237956889, 1034, 48028560549472995, 0);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.addQuoteToken(22558, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 26798251134, 0);
        _reserveERC20PoolHandler.moveQuoteToken(699684583201376669946795465695023954383, 871337618071093223322748209250657757655686665685488924893819949988, 6856667370119202181100844692321254723509125063768335, 2, 0);
        
        invariant_fenwick();

    }

    function test_regression_incorrect_bond() external {
        _reserveERC20PoolHandler.settleAuction(18129, 6125, 756, 0);

        invariant_auction();
        invariant_fenwick();
    }

    function test_regression_invariant_reserves_fenwick_depositAtIndex_F1() external {
        _reserveERC20PoolHandler.kickAuction(14062, 13380, 20332, 0);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 250713412144308447525906089113510093407014793436690623, 0);
        _reserveERC20PoolHandler.bucketTake(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, true, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);

        invariant_fenwick();
    }

    function test_regression_invariant_reserves_settle_1() external {
        _reserveERC20PoolHandler.settleAuction(2999999999999999543503680529282898884169444286, 999999999999999999999999, 6952, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 0, false, 228076556654255348886, 0);
        _reserveERC20PoolHandler.kickReserveAuction(18407833277983020451007887294192863287187933, 0);
        _reserveERC20PoolHandler.settleAuction(2720, 3319, 516, 0);

        invariant_reserves();
    }

    function test_regression_invariant_reserves_settle_2() external {
        _reserveERC20PoolHandler.takeAuction(3, 214198155653990209702223102757081411626927025, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.repayDebt(36, 19087, 0);
        _reserveERC20PoolHandler.drawDebt(2550145944163683156825587547113715005197220288637184, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);

        invariant_reserves();
    }

    function test_regression_invariant_reserves_invariant_quote_1() external {
        _reserveERC20PoolHandler.kickAuction(22771, 1111716442170237736883602263032, 7068, 0);
        _reserveERC20PoolHandler.addCollateral(450013003559446434159001584489461823249847174057443177111241841181931, 312804075096415570730723645176181753809227168111076176815108, 0, 0);
        _reserveERC20PoolHandler.pledgeCollateral(1985831902099838153679635097394320832859625435, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.transferLps(1, 11785568695658463091194696857966812287312218400594, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 0);
        _reserveERC20PoolHandler.takeAuction(159178586166894, 2, 2, 0);
        _reserveERC20PoolHandler.kickAuction(2, 2375789919282905103386504516485994899, 1289653, 0);
        _reserveERC20PoolHandler.kickReserveAuction(2162, 0);
        _reserveERC20PoolHandler.settleAuction(4612, 40708630701038224142448353799854069842509049093396550723073072047814079, 39027373949250548040512012762457247677933424051240699689883568078322057459524, 0);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 0);

        invariant_quote();
    }

    function test_regression_invariant_reserves_invariant_quote_2() external {
        _reserveERC20PoolHandler.drawDebt(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.pullCollateral(8213783947977569843117913236674123519747026, 26007879196259510050186964175498569516185804333067186877, 0);
        _reserveERC20PoolHandler.drawDebt(2301679051848045604, 2599238865, 0);
        _reserveERC20PoolHandler.addCollateral(4242066606167690018840733069974159, 2308657525655903223461843364795, 65478701235782653506998474972558, 0);
        _reserveERC20PoolHandler.kickAuction(69087967303211947138147234149237227681311399268590256122007, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 61509477439, 0);
        _reserveERC20PoolHandler.bucketTake(72107205250762587233492136850, 1244277915808615586782916545843, false, 39013151190969055659579687996, 0);
        _reserveERC20PoolHandler.transferLps(235427298074932216827475360756961, 2730975142229662626738653393718571, 1801094436838792863068211758488417, 879376648610435813515943108046, 0);
        _reserveERC20PoolHandler.bucketTake(740590071845914415309602438961, 903524249678397461462482055179, false, 999387178588229710810342952208, 0);
        _reserveERC20PoolHandler.settleAuction(1996, 648686406391068869253434465091, 1012371126513011680823527365765, 0);
        _reserveERC20PoolHandler.kickAuction(2758621226294910077454620848, 1587186203667651966808515455274, 999999999999999766114657929326397241693634383, 0);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.addCollateral(860262795452324500467615408841617417042130132486395050948571309437624254, 88294053979131610681224002926017918012056109605052596771915843, 2509079085932223405093441153560904865353589, 0);
        _reserveERC20PoolHandler.drawDebt(3, 2, 0);
        _reserveERC20PoolHandler.bucketTake(1112272948946288199596319174059, 651469309530642638235774421, false, 2631651594321033821284801688396855, 0);
        _reserveERC20PoolHandler.pullCollateral(1, 104099149887771887762252474591136544290691758, 0);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 3893316282729587584044696989905829964749218951828499823513945610388772348, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1079490131956486279124163833769398638737841713956621, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.kickReserveAuction(0, 0);
        _reserveERC20PoolHandler.settleAuction(1685708597792729438175883702650, 2952680495818774014078, 5097264761526793300787284458, 0);

        invariant_quote();
    }

    function test_regression_invariant_reserves_invariant_quote_3() external {
        _reserveERC20PoolHandler.addQuoteToken(2, 2, 306147942052277777154794038508061442, 0);
        _reserveERC20PoolHandler.takeReserves(999999997592778230040335721194842507878613188, 617767166532412476599141189, 0);
        _reserveERC20PoolHandler.kickReserveAuction(103210968180742388081044815736108888392928341723424194324988612249639, 0);
        _reserveERC20PoolHandler.lenderKickAuction(571331675273077569870268525690, 3000000000000000153070529032047742375224439804, 0);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 2345974107770202992, 596944268880651135381308885897365469741047535828013376978854456255492067, 0);
        _reserveERC20PoolHandler.kickAuction(249542131817080594576330466916380605939068941221926774088755, 1792443579171442237436215, 2, 0);
        _reserveERC20PoolHandler.settleAuction(2475430586786710276861336070835, 2600907908657087816392951766665339, 618867463233346276220185869, 0);
        _reserveERC20PoolHandler.bucketTake(288221154502730111886403777699180, 4013402100758707152779826705918182, false, 3000000000000000997154081605746206372402043417, 0);
        _reserveERC20PoolHandler.addQuoteToken(9798212016992127202141315997364967680599055895, 3, 1072606682991056733959287049686598376179068454808322552897362615, 0);
        _reserveERC20PoolHandler.pledgeCollateral(153445992298474361671974195535972272220394541157224893523804178985601, 53709221935782524388066885085801417, 0);
        _reserveERC20PoolHandler.kickReserveAuction(1, 0);
        _reserveERC20PoolHandler.bucketTake(3, 1, true, 2, 0);
        _reserveERC20PoolHandler.settleAuction(2518428390102925899809538437634001, 351638851502181329392182678513150532940060325784767627878107695205, 3071611172974674710789364893, 0);
        _reserveERC20PoolHandler.transferLps(28822226972612722036870301886639533933908463827921999334463168, 1, 314514798153750347019311, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.pullCollateral(2, 2, 0);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 60110048782249025340, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);

        invariant_quote();
    }

    function test_regression_invariant_reserves_invariant_quote_4() external {
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.repayDebt(123785744463475277851, 431477, 0);
        _reserveERC20PoolHandler.transferLps(8349868629210939854344368826901611192, 2050523511941068426657597285533, 482178822629563486190079445656644, 113294184847064316812952522804, 0);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 0);
        _reserveERC20PoolHandler.settleAuction(2, 60232917818899277216367937385395389606, 109871490879953029603376159938904259489696033217506136, 0);
        _reserveERC20PoolHandler.repayDebt(11000946587948121111587595267746251370302202324589596297423219199459160, 1640564753028103680512592653747, 0);
        _reserveERC20PoolHandler.kickAuction(3981871706795545560915874060150150667177950440617972926122855684987, 198277768150818655020367, 2892877132676919180494078569276042, 0);
        _reserveERC20PoolHandler.addCollateral(1263277608, 63278488014355910828533249093658068159654702008400, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.pullCollateral(2673207612857671157084473752324442, 2000121050152966887141053752381, 0);
        _reserveERC20PoolHandler.removeCollateral(17512256671104333742254942029, 940622488995047370832475, 17490, 0);
        _reserveERC20PoolHandler.takeReserves(4664936529054748613171449032640911546982046023628226142220220474, 12228144613454452340256380805978754348438442703119, 0);

        invariant_quote();
    }

    function test_regression_invariant_reserves_invariant_quote_5() external {
        _reserveERC20PoolHandler.settleAuction(841361270493647884419014561906636, 98291268956781519518581599501066994252857442823583923678216713962377882453983, 1406581758883, 0);
        _reserveERC20PoolHandler.takeAuction(1383411077269858329680139336144799098803584219410295488, 3, 0, 0);
        _reserveERC20PoolHandler.repayDebt(46968019084877, 3, 0);
        _reserveERC20PoolHandler.settleAuction(40124885934647691486197516987534429290957609634434455185985854549948025389553, 7413335529509918122196253760378, 3, 0);
        skip(2 hours);
        _pool.updateInterest();
        currentTimestamp = block.timestamp;
        invariant_quote();
    }

    function test_regression_invariant_reserves_settle_3() external {
        _reserveERC20PoolHandler.bucketTake(38522325070060518315904717784000000000, 74804166371079302281493396778, false, 243284095655821418741726406906, 0);
        _reserveERC20PoolHandler.removeQuoteToken(63300517263709739718213296806, 544282601310994378458621785271097, 93004761485750531023207874, 0);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 10850580031398165201080403693039642, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.takeAuction(1006654503300439100037731502194, 999999999999999820916638470184939411687495097, 2999999999999999849116243910762621146260836956, 0);
        _reserveERC20PoolHandler.settleAuction(513358560825207984200760701, 527826952804937875408570995575150, 3075, 0);

        invariant_reserves();
    }

    function test_regression_invariant_reserves_settle_4() external {
        _reserveERC20PoolHandler.kickAuction(999999999999999886611844846637902655009191722, 809319421722186623206028334686443, 33424777291596678039713, 0);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 2503088493515274266, 0);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 16755, 0);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.settleAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 0);

        invariant_reserves();
    }

    function test_regression_invariant_take_reserves_1() external {
        _reserveERC20PoolHandler.drawDebt(3, 2472487412192096145519673462983934503, 0);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639933, 50482403089838632034016548451617756782, 0);

        invariant_reserves();
    }

    function test_regression_invariant_take_reserves_2() external {
        _reserveERC20PoolHandler.kickAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.takeReserves(9990, 2, 0);
        _reserveERC20PoolHandler.takeAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 32167191465467724730024789812, 0);

        invariant_reserves();
    }

    function test_regression_invariant_take_reserves_3() external {
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 7863893832813740178393566165935290555711, 0);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 672940003103495713632014456312899612181893075117989217767500902, 0);

        invariant_reserves();
    }

    function test_regression_invariant_take_reserves_4() external {
        _reserveERC20PoolHandler.bucketTake(0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, true, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.takeReserves(2000008144440715646777241504589, 695559613732339828463793224249, 0);
        _reserveERC20PoolHandler.takeAuction(5260, 3000000000000000000000010654836333921317470662, 6571232818648673809695471386, 0);

        invariant_reserves();
    }
    
    function test_regression_invariant_repayDebt_F2_1() external {
        _reserveERC20PoolHandler.takeAuction(1, 955139331336232548042968484715961932654029262247576677099836, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.addQuoteToken(19874832899, 2, 19674101910639560463031669634628955697045, 0);
        _reserveERC20PoolHandler.kickAuction(1000000000372489032271805343253, 33527, 2999999999999998999627510967728193679786334003, 0);
        _reserveERC20PoolHandler.takeAuction(30442763437987671335943625876181535412080651070033770037765737902267600059, 0, 62793434148368637031717982910725, 0);
        _reserveERC20PoolHandler.drawDebt(1, 2, 0);
        _reserveERC20PoolHandler.takeAuction(28478785935025462058931686388528614452411453327852591879599088, 1426479312070353, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.drawDebt(10933, 2937, 0);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 6122968755523040, 0);
        _reserveERC20PoolHandler.repayDebt(10917282482493108186780095138347753666882231491750232316870663654516774564, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);

        invariant_fenwick();
    }

    function test_regression_invariant_takeAuction_F3() external {
        _reserveERC20PoolHandler.drawDebt(66012189296213, 3501011380219996136241089195497, 0);
        _reserveERC20PoolHandler.kickAuction(5022297903775350684886398975, 20526, 2902853749630275072725962069, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, true, 4391496802861267555764811220, 0);
        _reserveERC20PoolHandler.moveQuoteToken(26018560, 3192, 25995484456155391449642016017, 22537, 0);
        _reserveERC20PoolHandler.transferLps(10763986310328530217005920827655704540417291683469924162879658, 4634, 8842, 3, 0);
        _reserveERC20PoolHandler.settleAuction(2913861884801667469428509650, 17685440748964982730500143988068465999241920952718023027278539889735696458314, 744860398079104642573120377479575543713282684535849403581932752660396046, 0);
        _reserveERC20PoolHandler.takeReserves(9546428924610247071820016, 1, 0);
        _reserveERC20PoolHandler.kickAuction(1021712469506287128291988, 470273052888220, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.lenderKickAuction(21372131561480654576901520848, 583255095299263976575486908, 0);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 219682941, 6398456408984021365251851328837461998816613070677747503909692892499751257833, 0);
        _reserveERC20PoolHandler.moveQuoteToken(8413969458442105899430554342773, 42973831423907508485458560352, 14483994975746621772566970294, 27693669185946254354714892761, 0);
        _reserveERC20PoolHandler.bucketTake(0, 1, false, 1, 0);
        _reserveERC20PoolHandler.takeAuction(2760306433008897416497, 35178760526536102733112750779, 307455027758822287663945712, 0);

        invariant_fenwick();
    }

    function test_regression_kick_F1_F2() external {
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1513638311409397559820116, false, 1107177539379, 0);
        _reserveERC20PoolHandler.removeQuoteToken(11979868839631132246101, 1137392, 2, 0);
        _reserveERC20PoolHandler.takeReserves(3, 398628895133942030524702233785087782308780160336206641843430908, 0);
        _reserveERC20PoolHandler.takeAuction(296258719633565160185329, 490859840095298219320862, 16604700944401714968833692676, 0);
        _reserveERC20PoolHandler.kickAuction(1007024558278734662013991074770, 12316238, 8522190612260582802728723964891359810344750053801981528212387048, 0);
        _reserveERC20PoolHandler.takeAuction(999999999999999990212662818220103017885508577, 13644265990130681739980240101, 365402912996683431395427167362586262781607554542513822722975820380813222232, 0);
        _reserveERC20PoolHandler.takeAuction(999999999999999990000000000000000000000993018, 31506548945590221240114018464, 1016963456957222995035464545, 0);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, false, 30294494991681513847857232418933803770638682537, 0);
        _reserveERC20PoolHandler.kickAuction(2324631542950979206383056100280239271207523734887421, 1, 23494016960770235530146856844201861803189848725938507629, 0);

        invariant_fenwick();
    }

    function test_regression_remove_R1() external {
        _reserveERC20PoolHandler.takeAuction(1000000000147122258, 3919731510820678131056801, 158441107709132461742605107, 0);
        _reserveERC20PoolHandler.repayDebt(15097247704276523502490912, 5821681489746654725611665637, 0);
        _reserveERC20PoolHandler.addQuoteToken(409278183265946161107935122, 13459778251101474251175765782, 17131651646875762675637482511491680925564181440856864512, 0);
        _reserveERC20PoolHandler.lenderKickAuction(3000000000000000000003060052276861736589117902, 10971651541557993591476169, 0);
        _reserveERC20PoolHandler.drawDebt(99176811231448450752542388131222351, 4756085816094695387473840, 0);
        _reserveERC20PoolHandler.transferLps(345464481275697722, 1, 1571, 636770839146216364947817981246144824780203402016795537219680499840300283500, 0);
        _reserveERC20PoolHandler.takeReserves(1, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.removeQuoteToken(2921676640197348125883567882, 110429299813004951706741973, 5838113258459267571531065497, 0);

        invariant_exchange_rate();
    }

    function test_regression_exrate_accuracy_R1() external {
        _reserveERC20PoolHandler.moveQuoteToken(0, 1095007911, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 10069220832808935, 0);
        _reserveERC20PoolHandler.kickAuction(2235318869033878164575850860, 25288937613311342943333937133, 83682862171707962382757764951, 0);
        _reserveERC20PoolHandler.addQuoteToken(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2732924787785177969603119436532655486434403999080563574919756204077541, 0);
        _reserveERC20PoolHandler.kickAuction(2970471299408419676825342051, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 0);
        _reserveERC20PoolHandler.bucketTake(0, 11522913996, true, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        invariant_exchange_rate();
    }

    /* 
        Test was reverting when movedQuoteToken > amountPassed, this happens in case when buckets gets empty.
        Fixed by adding check in increaseInReserve calculation in 'moveQuoteToken' handler
    */
    function test_regression_evm_revert_1() external {
        _reserveERC20PoolHandler.takeAuction(2520000968586068692750846759781727871330432521653849554728884, 842011260485420553676704792240552622539346320776828594643332095169708168242, 8055807, 0);
        _reserveERC20PoolHandler.moveQuoteToken(1, 231772084031809103573597600784780758697344200147089918620804085, 2, 664746035165900383390596853874831864040676775434826512224949736661840288899, 0);
        _reserveERC20PoolHandler.removeCollateral(1208370290348562883186186, 1, 1, 0);
        _reserveERC20PoolHandler.takeAuction(5259923301902342744141092410691697923135981, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 0);
        _reserveERC20PoolHandler.moveQuoteToken(8974296309703512994561526975050221771958436087084360221, 0, 12487898, 0, 0);
    }

    /*  
        Test was reverting when redeemedLps = bucketLps but lenderlps < redeemedLps, this happens due to slight rounding error in deposit calculation from lps
        Fixed by updating redeemedLP calculations to `vars.redeemedLP = Maths.min(lender.lps, vars.redeemedLP)`
    */
    function test_regression_evm_revert_2() external {
        _reserveERC20PoolHandler.moveQuoteToken(1, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 158129467307529830729349478455, 0);
        _reserveERC20PoolHandler.removeQuoteToken(2999999999999999484865294266928579000517539849, 20462, 1576762402919713971836094859031, 0);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 54458727957125675340786496871311264885201, 3, 0);
        _reserveERC20PoolHandler.drawDebt(3, 105, 0);
        _reserveERC20PoolHandler.moveQuoteToken(6852481993231188391093194134731580567074964777826972502281, 329445, 0, 0, 0);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3, 7021699771963113994546981195098591531040470835170729980, 0);
        _reserveERC20PoolHandler.kickAuction(222097115856593934764213313250516314101951310591954099083410060419874648, 2249513945015671956, 607419547883141581230100154864, 0);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 900686135540961542876969152475416605137543635582763473, 0);
        _reserveERC20PoolHandler.kickReserveAuction(0, 0);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 0);
        _reserveERC20PoolHandler.addCollateral(942680573168415959, 1199548961510475789275654540025108262785374840317057516601691579134979, 2999999999999999999695465971169782999351812188, 0);
        _reserveERC20PoolHandler.takeReserves(1471, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.kickReserveAuction(32594801409066350134162972068, 0);
        _reserveERC20PoolHandler.lenderKickAuction(2999999999999999574088451549152362060347655934, 48090144344287028180951883593, 0);
    }

    /*
        Test was reverting with overflow in `(tu + mau102 - 1e18) ** 2)` calculation in _calculateInterestRate
        Fixed by updating `((tu + mau102 - 1e18) ** 2) / 1e18` to `(((tu + mau102 - 1e18) / 1e9) ** 2)`
    */
    function test_regression_evm_revert_3() external {
        _reserveERC20PoolHandler.drawDebt(1000011592650618236, 427626464706163901647666438633, 0);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 0);
        _reserveERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 222282777921247831223488066461, 0);
        _reserveERC20PoolHandler.pullCollateral(15340, 22233328162, 0);
        _reserveERC20PoolHandler.bucketTake(43296517, 189401876327916916281126992296, false, 5424, 0);
        _reserveERC20PoolHandler.addCollateral(2777407746290631507500, 333697625318607566355528255834, 1000018044967910249, 0);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.takeReserves(90818049107020612953852548512599042076744953, 1699960882759932026837663149104517717038509322264532007389148, 0);
        _reserveERC20PoolHandler.withdrawBonds(106568634815518113798129275, 2460874687943872413578450072374086568386094010814407501, 0);
        _reserveERC20PoolHandler.addCollateral(988315461147551209368455480062, 1604895841620880925866279541638, 947957157261063855554739172111710, 0);
        _reserveERC20PoolHandler.pullCollateral(1000000000000000000000200, 9090, 0);
        _reserveERC20PoolHandler.addQuoteToken(1, 29592092711738557487974299548920457245440815108037318587348855786852817187, 835462594306266473781056, 0);
        _reserveERC20PoolHandler.takeAuction(598847416317922228449817163835395963171238146640666936329941450597, 1609410932486951851606214282597, 95354512998795826382552523444, 0);
        _reserveERC20PoolHandler.addCollateral(833040298029642855894082982789, 1076477294087, 1797816964051823308646324438005, 0);
        _reserveERC20PoolHandler.pledgeCollateral(282614408102076551687763800227, 3, 0);
        _reserveERC20PoolHandler.pullCollateral(324581451894516867771201351665741275651124, 4, 0);
        _reserveERC20PoolHandler.pledgeCollateral(3990116583418393958345352592252524240487111685089080421377559185333257001186, 63643723788868280847, 0);
        _reserveERC20PoolHandler.drawDebt(2420222920583996676329196545, 1, 0);
        _reserveERC20PoolHandler.transferLps(2999999999999999866089865785362154170272346882, 1201303985144971, 3000000000000000000069282600099281847535823208, 2516, 0);
        _reserveERC20PoolHandler.kickAuction(11585421328272707882885111971840751049901594256465502255118203311426017450, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
    }

    // Test reverting with overflow error in updateInterestState, fixed with calculating t0Debt2ToCollateral only for loans not in auction
    function test_regression_evm_revert_dwatp_calculation() external {
        _reserveERC20PoolHandler.takeAuction(50273692421744377186963564518293270398423601950557187270240, 2548824763847568430445964332385997581867729, 2, 0);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 0);
        _reserveERC20PoolHandler.bucketTake(2, 178384181005, false, 6392753955405727164548240817297990606823468910265481812293128708, 0);
        _reserveERC20PoolHandler.removeQuoteToken(3782769546571580286491282490173426994, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 54687167, 0);
        _reserveERC20PoolHandler.settleAuction(39578, 1, 6177214753589, 0);
        _reserveERC20PoolHandler.repayDebt(1025386930210936368, 4259484542182884235320983165905627435543345198090251871456881749143615, 0);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 9515050199665708690603228437, 8324830839682368611784829482626590763014978434217970848520, 0);
        _reserveERC20PoolHandler.pledgeCollateral(0, 61432102823246505619, 0);
        _reserveERC20PoolHandler.kickReserveAuction(90632424972185451325878827725, 0);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.removeQuoteToken(662383544472518305626297967684, 417256349487250392122120746762550, 11019, 0);
        _reserveERC20PoolHandler.settleAuction(818097782230726263131224806387432801887947892950801, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 0);
        _reserveERC20PoolHandler.settleAuction(1045174129353233337547, 14962, 490775706239416317157126137000, 0);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.removeQuoteToken(7138, 27260, 5841, 0);
        _reserveERC20PoolHandler.bucketTake(130086595647608623733586123, 0, false, 2, 0);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, 0);
        _reserveERC20PoolHandler.settleAuction(877519612062733, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 0);
    }

    /*
        Test was failing when collateral is added to 7388 bucket in settle
        Fixed by updating depositTime in invariants when collateral is added for borrower in 7388 bucket.
    */
    function test_regression_invariant_B5() external {
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3097951365082855701011892593056006, 28505541224098934564122193102646813744506286540202295861523654, 0);
        _reserveERC20PoolHandler.settleAuction(268023445355841172515900573198115553, 232461104934, 3, 0);

        invariant_bucket();
    }

    function test_regression_remove_collateral_R1() external {
        _reserveERC20PoolHandler.moveQuoteToken(3, 112642414612381, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 2, 318641953631952589414977894280024365632);
        _reserveERC20PoolHandler.bucketTake(182494113675724977281776140380971070728096798326637457234650826485, 117214647013297091537317197140644804056447612846311, true, 1904681890422957, 597521941940451948616669716374429304528665022989234078986136163808910103141);
        _reserveERC20PoolHandler.removeCollateral(3, 251744909376884114715, 2, 0);

        invariant_exchange_rate();
    }

    /*
        Test was failing on bucket take due to rounding in invariant fenwick-like structure.
        Fixed by setting deposit in invariant fenwick-like structure to the amount of pool deposit.
    */
    function test_regression_bucket_take_F1_F2() external {
        _reserveERC20PoolHandler.settleAuction(1510914784515760699173187165544, 56781153476701101508130985112, 738818868447359631695629380008183363630282764181000585867138796869876478, 826729014323244190827572488053);
        _reserveERC20PoolHandler.pullCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 81950073367662209514774267517191923671913258);
        _reserveERC20PoolHandler.lenderKickAuction(0, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1, true, 16564, 1);
        _reserveERC20PoolHandler.pullCollateral(2, 11181577647630232495296346954387708896679284248835926583085255351494229, 4615339307365404773083);
        _reserveERC20PoolHandler.pullCollateral(1007164428353398281573211, 964159427775903864473526777760, 261230209900412451745100526475);
        _reserveERC20PoolHandler.kickAuction(0, 554539983014618013651520598582291624736058825092179787664, 607065087, 2);
        _reserveERC20PoolHandler.pullCollateral(8677988786893516887084947060, 10701983022987536454745187554, 2320584222753413054555955504763);
        _reserveERC20PoolHandler.lenderKickAuction(1486776298593531042, 2020603011457936715090930810854, 1402064626949378737);
        _reserveERC20PoolHandler.pledgeCollateral(65582376469670144960045063897640986143586634210322834458, 245005754869224, 2);
        _reserveERC20PoolHandler.withdrawBonds(2523139806230558464349567550, 1188425283706188004221953654058, 6393771947719760203082952454725);
        _reserveERC20PoolHandler.lenderKickAuction(1, 2691769591875735361793461264703373146895996368, 0);
        _reserveERC20PoolHandler.takeReserves(5737, 2688407785637229852497751501094273, 1004385089582049768428212223255);
        _reserveERC20PoolHandler.takeAuction(554219272498135606970798166790315003, 3, 2, 0);
        _reserveERC20PoolHandler.repayDebt(29687620020, 3369242366170335995970777, 225603670502873549001365942057667084788237);
        _reserveERC20PoolHandler.pledgeCollateral(716885903235853433284117399980781309405669646944833455086249746653872598, 1110614947529974105, 1016435599216856314);
        _reserveERC20PoolHandler.removeQuoteToken(1002, 2, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.withdrawBonds(2, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickReserveAuction(1197540611232157020, 2224702545892793666262242745595);
        _reserveERC20PoolHandler.moveQuoteToken(6472581915979582519934890625128, 4686076390146354794761353442546, 153625863241017113128712718456375, 1092720414754004268, 2824050399931527721067);
        _reserveERC20PoolHandler.settleAuction(988243680001096450676149, 1816823256461441862521245540127, 7413874292852028782123044244146, 4797997733388308794048855522661);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 199021831602624649170040113289346230604346517689422625269269437242619506, 6101, 1);
        _reserveERC20PoolHandler.addCollateral(605396686083795331558129839337, 882660027196729550195451518219, 1672491471, 2564065349410993575159219897127009);
        _reserveERC20PoolHandler.withdrawBonds(45865057437640263333517073614890677509028575205307909127, 0, 282519401025573585781993818896836826434536845069930126413729090915181);
        _reserveERC20PoolHandler.addCollateral(116929, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 285202866600578298455098104539945729353367981305589001, 141267956435941439);
        _reserveERC20PoolHandler.withdrawBonds(115792089237316195423570985008687907853269984665640564039457584007913129639933, 37883603689365170993845038519298489620377056, 1);
        _reserveERC20PoolHandler.withdrawBonds(1, 16812, 5918372428008830525608336425396581892243715009);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 412525141893056351100862438113393164058, 2759444, 25728032555641171644636607539656118333998881);
        _reserveERC20PoolHandler.pullCollateral(1662504175369963, 999999999999999031474421897842367703441397620, 2096734133807097909348405107855);
        _reserveERC20PoolHandler.kickReserveAuction(85959652478551470521729261, 1);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 33020590407178855511758345, 3);
        _reserveERC20PoolHandler.moveQuoteToken(0, 2668970999202447031133789085539926160085152892918501572614651277522746, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 9899499354655258734650983060, 0);
        _reserveERC20PoolHandler.kickReserveAuction(3, 111350983922696397771656120829290070270862146672613);
        _reserveERC20PoolHandler.repayDebt(537837957907582525859501126027241, 1066815515628580409796241599143, 1001156513580077724);
        _reserveERC20PoolHandler.moveQuoteToken(150994705072980195816644977482, 1728676792823377569756944287120, 3749400490566836004015771809290, 166858, 1509516514751735973985835075499);
        _reserveERC20PoolHandler.lenderKickAuction(193413806405457706345786708852661811545178, 1047704970, 2995221756746166151759690152622550418495787241369904977564155482144830696);
        _reserveERC20PoolHandler.addQuoteToken(3023841269839124425804122589061027, 2058019688463725681621910836029, 891046488727245859377654469131, 1249210750552821373482);
        _reserveERC20PoolHandler.pledgeCollateral(3, 0, 98322504996953992046749321771);
        _reserveERC20PoolHandler.pullCollateral(92794261541957113617256800038346816759944975908266533925455372278785, 1230582320792434706053835371, 1276471416813335613);
        _reserveERC20PoolHandler.removeCollateral(311083601016171346809697513226156424530729626196719942485438390456924386075, 323225075558224052578960655880898250877447513447792686936586523666850088357, 1, 2);
        _reserveERC20PoolHandler.repayDebt(790249799973210468816404030969904775718016377707918061582196079205358796, 1002540195044483475, 2047504745217207665732381542336);
        _reserveERC20PoolHandler.removeCollateral(175747187405538549430291807301, 2993077097459977143561761776211, 3400193697158807892113582166494, 1800755543922400017856720682751);
        _reserveERC20PoolHandler.pullCollateral(5580986838573390475213789522775, 1007047802912429960, 2197353511672204245668);
        _reserveERC20PoolHandler.addCollateral(342897622477172473103913197218935, 3566697594030839459401081846106, 1833770083980687784404083993696, 1234905615381949595);
        _reserveERC20PoolHandler.pledgeCollateral(2463626930384523140973254075024, 4083558017162549373575014837932, 5196030473962574880735225321951);
        _reserveERC20PoolHandler.addQuoteToken(1765631026212169120598169564509, 2220562534907846076005234838068630, 1196035260473993921667564282828154, 3549126263243282800240712017898962306367829922976041987802797000382284);
        _reserveERC20PoolHandler.drawDebt(20719384903561398469789062085066937587280736842419948, 24862907662684278802525417652872014310188960609717779080238491378317915, 5495980051242044270058814218059392525381094935486256389);
        _reserveERC20PoolHandler.removeCollateral(7213700723040707136624937293900, 5285412118648451003769928072955, 2392814292869616064589528460392, 4544146352675206325539102249428);
        _reserveERC20PoolHandler.takeAuction(1903009777, 20204938929802537428200456465, 3000000000000000907813878166423639025933941865, 1000824219968204421);
        _reserveERC20PoolHandler.moveQuoteToken(688073698066139431880812238682096657890137322106298141036595297116225536, 548183165672510190208688509944, 2189520668408679809179281591411, 3837428774749554008775751387896, 1041957604035273349);
        _reserveERC20PoolHandler.addCollateral(945455232720059013000192588525930570481, 5170564156769133914580628561092287826194251341369061370707290, 0, 682);
        _reserveERC20PoolHandler.removeCollateral(1043634308541268817, 2510955772895946458937107461206, 731679651933131536718824050845810165418380324173749221986397925343434171, 3016679583253102895599404358104);
        _reserveERC20PoolHandler.moveQuoteToken(346034886298196564179691738807538302349998359668, 2506541264698307195311054367718059410346354956970789324651065, 145206497121716735377920691882287735853626593169359372521320, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.drawDebt(247625427168, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.pledgeCollateral(45987302144709581746875, 1, 3);
        _reserveERC20PoolHandler.settleAuction(1793755319666702586223721636112, 1062058871163086566, 2413232366548259005446, 1796325987279351495770187048297);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 143381296286622596217261690020938346499350019625300111739, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.kickAuction(746337189990642222625, 24840873603345398151212671885145398406615143472203234339196049246556, 0, 1514976639337558233422658496899394592);
        _reserveERC20PoolHandler.lenderKickAuction(8405289450785532590816548320, 1029707615502801074, 4520920790726583536432399129470);
        _reserveERC20PoolHandler.transferLps(2996563606833486714118058094564, 702408244445504832281666423610937442523512618396554838397742202654139648, 762810992474851803555903948575531786509, 11084174673435631351973324677604, 61235761931845916270908237816);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 275227317920633202208830403173255314144728374, 2, 0, 688725045170235338428585609807);
        _reserveERC20PoolHandler.kickAuction(1, 2, 95173045790157393433334185544083261266161112921995634013255737145082976, 2);
        _reserveERC20PoolHandler.takeReserves(6224104947938771307608544842867, 46564278089684585678589826761190, 962941538624781792047471718364);
        _reserveERC20PoolHandler.removeCollateral(1063700154911047485, 2002714622841278371304390186223, 347504308413716218659327939950, 731308625622427447831946501088238612223204948119185994526814491838436009);
        _reserveERC20PoolHandler.removeCollateral(6511927091822672233241152342, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3);
        _reserveERC20PoolHandler.removeQuoteToken(6276079537095712876036938068681790, 100938971766937741067815187067, 8937254300213964685220914919850, 4799942332716521084650682416626);
        _reserveERC20PoolHandler.kickAuction(3259540355231532862899046408147, 29, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.settleAuction(1000006818713680216, 1970141763586393527393378064287, 878551153196508667525841407502, 1690601302);
        _reserveERC20PoolHandler.removeQuoteToken(2, 31328579150151009067591279330331930, 2491387393, 41235238234);
        _reserveERC20PoolHandler.transferLps(4282248179520604211437195319437275714332525566388937456256953512503367354836, 5601389362717732543021478, 4996930, 2644484301317293976316158994251953451759288746536532414043760834885859235, 1);
        _reserveERC20PoolHandler.kickAuction(3568230689697833016349604996579, 693522743735106744774173589245, 3389725449062448673733286774569, 1301892313973516146);
        _reserveERC20PoolHandler.kickAuction(201, 21631479461464263959768, 78123176120365843894150397741, 9300800067863236721553303813027179802975904016109787695236273);
        _reserveERC20PoolHandler.takeAuction(2736062665407603508654, 2060027413022391924621910998607, 1889598418819244308794543271766, 3085151436892150503789441382075834);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1);
        _reserveERC20PoolHandler.lenderKickAuction(16534523299591874273106448500135778, 71859113478704890667760930617275, 157063302890337049783087968502017451800257526563959);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, false, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.pledgeCollateral(7463182009321059015374227047840412, 101831081341642573274301689378412876012422960796588974807649751, 0);
        _reserveERC20PoolHandler.lenderKickAuction(6057082585985160611374338873092, 9037036310590101965162407201532, 1757181752773554121418819873463);
        _reserveERC20PoolHandler.repayDebt(3, 1, 1);
        _reserveERC20PoolHandler.pullCollateral(860890364359, 357071378403476971353854511534324768381739279063271933897303445465789815353, 6593344128314924384710528432227744612333514602846854245);
        _reserveERC20PoolHandler.transferLps(2151741125651550001598260859423, 1000000000000, 7738815365523781817313950916289, 769770164544161186766097336122909859786947698826792914214697337544273867, 843462236981741829082334556003);
        _reserveERC20PoolHandler.moveQuoteToken(1, 946799222988, 1, 813535, 3);
        _reserveERC20PoolHandler.lenderKickAuction(6117630415543116221029359681, 1436615297827490227261541667418, 660419568619948531310455586057838);
        _reserveERC20PoolHandler.lenderKickAuction(1, 2, 1);
        _reserveERC20PoolHandler.takeReserves(42317498246148578995135345225498459937438, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 75242355315450165939025760776986335913274750311380);
        _reserveERC20PoolHandler.takeAuction(0, 737682015658631343232102398874034548752313741661360229665602145052, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2);
        _reserveERC20PoolHandler.addQuoteToken(267101460469660557, 21691712974319419159980592740542096318021321414207, 774819884029991515642353812484, 1);
        _reserveERC20PoolHandler.transferLps(29266759353229343784590279316422157350460, 2879432373322253845758229217549935623032371246851323135355925442739880, 1454847700781152456759205380609245534636174204385, 2, 3);
        _reserveERC20PoolHandler.settleAuction(288276142410360385726205619467, 2999999999999999323095577754134545075290512509, 2507727012166377727620026676592, 1094918858620658387);
        _reserveERC20PoolHandler.bucketTake(5570782479718063682441647619517, 126557937261762406, false, 4462727505845948, 1055876252762728108708117695340653);
        _reserveERC20PoolHandler.kickAuction(853834800860644866000970165791, 1498216243443044301357664578578, 2017500690698780120510658658760, 640564033161223179642358687723);
        _reserveERC20PoolHandler.settleAuction(1000031072117326780646911, 27764494972562607738430382283, 1263822902041223401400, 6065003936906725025397073402);
        _reserveERC20PoolHandler.settleAuction(473174439797857464752145959072549822734640072666747467, 3988431068128298524094839625, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3);
        _reserveERC20PoolHandler.takeAuction(1, 1, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.withdrawBonds(2, 2938288055966455633017617488334083433, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.settleAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 497111556184224109453, 18817490);
        _reserveERC20PoolHandler.transferLps(3190358537186761891573846311594767496710, 1277467289456490057220968638073464, 1572765138384812186119187255874995002923326022084016179570537435116372026529, 1, 3);
        _reserveERC20PoolHandler.takeReserves(172504958469728293938709216359452294, 2, 2506321198306128726803818);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 5330922775867442976385345344233917880089958849074381595130, 98949440597987563);
        _reserveERC20PoolHandler.bucketTake(2132955261059108032405590124321028664092030715213, 68744341008080485100000482970, true, 1782512349109005, 2);

        invariant_fenwick();
    }

    function test_regression_take_reserves_R1() external {
        _reserveERC20PoolHandler.pledgeCollateral(4057636300611646440676625979772326719512580386780524474507381284126503, 2732970107756608752628, 1639176274380271791781);
        _reserveERC20PoolHandler.removeCollateral(2488548050141249601290217862186, 1010938772241377130, 1742624602, 702622783272807674473935035799247791685664136270296313519327622442371448);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 24724702085778998154273896816251067, 3148124806876262102415120816737807);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1090680745454, 32739946039095373758494866);
        _reserveERC20PoolHandler.withdrawBonds(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 7109967278385509997047734962128020765900);
        _reserveERC20PoolHandler.settleAuction(12473, 15314644464349062995, 2340004932058035700615548201164, 920644584147693467489745945878);
        _reserveERC20PoolHandler.pledgeCollateral(1173043236511673745512, 1010258510334443772195027060356, 2077490838405144841840210);
        _reserveERC20PoolHandler.withdrawBonds(1000230151193478095314209, 258031125591785910207723496145, 2999999999999999285713593101745451035939018597);
        _reserveERC20PoolHandler.takeReserves(24619740737452456742454713972797964, 2, 15934392);

        invariant_exchange_rate();
    }

    /*
        Test was failing due to huge amount of debt accumualted in pool / overflow when calculating interest.
        Fixed by making min / max debt amount configurable and reducing default max to 1e28.
    */
    function test_regression_reserves_evm_revert() external {
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 7432067536647556445218799335704136837, 4715747042346669633319009519697859100951799355423633267, 0);
        _reserveERC20PoolHandler.moveQuoteToken(0, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2020269834232719980360881883372061867637447195013028, 296061827647157426699935879, 21374058504515555011959882705296305527939080110442422439344264);
        _reserveERC20PoolHandler.addCollateral(2, 77205862965693025436922054480996, 4344222312209130, 174840280321130588357457751689775852442885192877604295382683029677);
        _reserveERC20PoolHandler.addQuoteToken(1, 1929147, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.takeAuction(490755647117658234348758765802, 8982488993478280234720608316103, 916772893601469494153024574468, 4393647813071625719038756328837);
        _reserveERC20PoolHandler.drawDebt(4805159497444458618258157557393, 2724327046368242919005, 138663543269007052406812949607);
        _reserveERC20PoolHandler.bucketTake(1, 2, true, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 10936920220923822582469796080110513985350128097288);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.takeAuction(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.pledgeCollateral(941546152966350625612077433, 10726371082311977329457077325558, 2696978587756683035831);
        _reserveERC20PoolHandler.takeAuction(53967993193519472913249381733776180457794803784719002034313, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 45, 1);
        _reserveERC20PoolHandler.drawDebt(3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 207422172143513596064280517991838032372865452002480500460809617220436380076);
        _reserveERC20PoolHandler.withdrawBonds(1008907648857783727, 3940655974348527622247847423997, 1778529333);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 41, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1583081402595933263634733970723774);
        _reserveERC20PoolHandler.addQuoteToken(1318761947547626190, 3535665217472453192989561351428, 5545307744815227663803719621368077, 4718832438319909613101473845685);
        _reserveERC20PoolHandler.drawDebt(3520204303230438620368248088232, 1031629562620437104, 1695217228280423504);
        _reserveERC20PoolHandler.kickReserveAuction(3, 56953303127053635803409068588);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 28780784752324816188446653619482971184220946340852088360615403922, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 64851728549141131070);
        _reserveERC20PoolHandler.removeCollateral(21127794858652655382, 6592337969330, 231144196243616635088272696137163313381833211082214248, 188092863589714213711193127617726717835239275550742557092069077687088602212);
        _reserveERC20PoolHandler.addQuoteToken(58623888880348232, 9754526, 3, 0);
        _reserveERC20PoolHandler.repayDebt(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 189294932789);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 134028038539, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.drawDebt(94568131799194924822220833994650, 798153395314680475690544418269290018451921175584520796228428403251419925, 761087353272232042010041289868135748540874739997222302677461783596680941);
        _reserveERC20PoolHandler.withdrawBonds(442087108851831787, 3, 9899633437856208023172592338572615631693082795);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 18312443585954408336504761094264794746123911472797590745151780270, 106928407998134481256579921606198494811038, 40054321155110060, 17632673982015669578934397516389902391712094233957366078997972380075445240);
        _reserveERC20PoolHandler.moveQuoteToken(6283406239330968476527973782295, 1000002024752978829, 2786992528704103056168, 1000056862327843250, 443482445028138877069329782965917);
        _reserveERC20PoolHandler.withdrawBonds(9310131783400215696532970265085, 3398225097271403812778930480214, 119105783160918404147636798056);
        _reserveERC20PoolHandler.removeQuoteToken(3894761032687976733986650505333191, 775309891015887274224586983768, 2749888426342989019943, 7651650561576754417503365256344);
        _reserveERC20PoolHandler.transferLps(38678488144366649876627625991259993748086200, 3, 4672456638679699883741106489916338727828358754961773, 559561450, 3);
        _reserveERC20PoolHandler.takeAuction(0, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 172979094575783295514817417301354389013264, 2);
        _reserveERC20PoolHandler.kickReserveAuction(240724945448466640473978788247011, 1400619251581759919792753908353637193771243932);
        _reserveERC20PoolHandler.kickReserveAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.removeCollateral(2027733521, 2276103056447174873072048292793, 3804937116765104686271347242905, 3998711419257207839419306349072);
        _reserveERC20PoolHandler.removeQuoteToken(410546400794342718, 212370654068061231887567852244, 796446558503683289, 1726259209657386899);
        _reserveERC20PoolHandler.bucketTake(2999999999999999999966415087816369899240395020, 1221411580361092699021436719914, false, 969381711066436605445840420039, 2227312010044629450);
        _reserveERC20PoolHandler.moveQuoteToken(8517481715826314316540327697785, 1619499829250006718815381503384, 1326687514114871074231463998241108, 1042694132063168447, 4673256212018242188061496920750819280243551299401758001644397788520344);
        _reserveERC20PoolHandler.pullCollateral(0, 1961, 0);
        _reserveERC20PoolHandler.pullCollateral(2107184968682540637222168402402260, 6976945233474060516949541924, 10666089550012015382626455302014);
        _reserveERC20PoolHandler.takeAuction(2, 10001569229914546588403446781361564495361, 45867941843605449875930196882942691023106069575773335329017753223, 15827094);
        _reserveERC20PoolHandler.settleAuction(4459787066864056137922416868599, 1043836262122498138, 5293003766838764380279676973542, 824026457496951518112890267558);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1722842605532975337834938114152151019578165536286804239);
        _reserveERC20PoolHandler.removeQuoteToken(3236621837, 44183766947594404, 2974124552001687, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickAuction(105185097275328730025037262046113899775376496820745273956304586546, 1589078415473592047181994985685135, 1, 3217485339);
        _reserveERC20PoolHandler.withdrawBonds(321128742051564402669457978517, 3, 11597933248424411);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 6068268487225145977908049688262, 27794963, 193420231201676799139695561423127820410341);
        _reserveERC20PoolHandler.addCollateral(1, 25067174358136880242791408545007663440204375899873897786004681032713320, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.settleAuction(6311469872117467035734043119842, 2729495905637957272462218190459, 2582774912787149919305047307032541, 2429481783363523940477890062827);
        _reserveERC20PoolHandler.takeReserves(6311892282739652824269633667852, 6314307285736729430057544742935, 11242387119955788720063486774742);
        _reserveERC20PoolHandler.drawDebt(131195636228080530409879084946374477086612177, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.drawDebt(1059512, 1, 909477225258871115986346185885701353249075126);
        _reserveERC20PoolHandler.repayDebt(1027379846155197184, 5021429792761646149436322671963, 761108618539002443286025569073624232820788258138497851866096066064141603);
        _reserveERC20PoolHandler.repayDebt(1, 1891088270259771, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.lenderKickAuction(300390279396872823639244057100825569615, 0, 3);
        _reserveERC20PoolHandler.withdrawBonds(4196906598583494376186279932398, 4497241908239658040573381740008, 1046112866272332596);
        _reserveERC20PoolHandler.transferLps(45001641534605145137523002218999291861378873673372208251415919733, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2, 0, 3434873428102678042182782);
        _reserveERC20PoolHandler.repayDebt(3303634669327189965378726651570, 1406376839519270869072044219653090, 380296556529511098221);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1023343985346637704899275796473392926288336271343198026, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 28857512090312100287162378571551742890150336479068309734938, 1);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 6125836867216049990939896484376722, 18393606630926641797248612342);
        _reserveERC20PoolHandler.repayDebt(162932298191395641789658287564538, 1025215414849999646, 2999999999999999302607066894430600995197350597);
        _reserveERC20PoolHandler.addCollateral(3192, 1258870123948754975934719233476780946206984176238780731425073008, 278835345917755397532505813041683227874855455726253575592767748796, 1);
        _reserveERC20PoolHandler.removeQuoteToken(13, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2, 36739925547689172301900890403876163281267485842358116379985258607488102225);
        _reserveERC20PoolHandler.addQuoteToken(0, 52160440771445398859265218198969700678470583039, 2, 136976725652067842068006354147265247563941666103100639183589196095804793240);
        _reserveERC20PoolHandler.pledgeCollateral(3, 170492227564282047126, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.addCollateral(1270744585662626, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 90226121806431194782245400756193728, 1);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 12377615235980434330469749220, 54289616930265498272273182179664228091804062500140130319397233, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.withdrawBonds(1000117305548843410, 73849868392851742413150409706, 4346276117046344791695503030483);
        _reserveERC20PoolHandler.settleAuction(9547521812214451840653486389726, 794441229233281486, 4511497902694814377922862924051, 1000000007626253540);
        _reserveERC20PoolHandler.lenderKickAuction(1039853791313702979, 1002386832397769812553370, 24519218157573415);
        _reserveERC20PoolHandler.addQuoteToken(1005767073092496690, 11343481630748420758999004408570, 3225912566227729574375973110, 2349178470758192740760600733698030);
        _reserveERC20PoolHandler.repayDebt(126172940855594324020583670142245989043194002832582726, 614364996266979362934279134515, 175241477724685331709233230552259521288362115444301425763618382220169154);
        _reserveERC20PoolHandler.removeCollateral(2069362329751901762, 0, 3601637614991925341243, 409012071510846939820280682934901873417767627622444842446);
        _reserveERC20PoolHandler.withdrawBonds(420989892944407991931154933398568788985111840784780507863456993791664, 532817719903025855973419901802797411641799670053067570474191471085105639, 109350147409798725263863843617577433230695345540692899447);
        _reserveERC20PoolHandler.drawDebt(2, 131984848142262595004068552828264386596051477599052, 0);
        _reserveERC20PoolHandler.kickAuction(1, 20182441636829037235129629469986148638, 5859843449392668680263692535966517887299682581948467, 0);
        _reserveERC20PoolHandler.moveQuoteToken(2400219610281260451724274317083199001, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 73515366917337355139626016611138170465805537091234577013, 2, 179865232851714470);
        _reserveERC20PoolHandler.pullCollateral(6019293640605228511978260558352, 1973316248, 1717508269675297559154269263415);
        _reserveERC20PoolHandler.repayDebt(4474507393296899634618019559413, 576438254231201382190504327000909, 1362930267588852387);
        _reserveERC20PoolHandler.bucketTake(3223823237354686313918759360797465471784188352102860652348606665897890, 1754353286614602592, false, 2185014526, 3860770289842261099567160893419805);
        _reserveERC20PoolHandler.repayDebt(7517685404433611986094250342214, 7940901081625241886337696262142937, 1097380875386845652);
        _reserveERC20PoolHandler.settleAuction(466828746892708685166031060246, 7700884483698536245874645220943, 24755120684682887675851958558, 13022015566438663971362971400004);
        _reserveERC20PoolHandler.lenderKickAuction(13171130573439383597216480715235988594211573475731394375016373802717212, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 914024113882843531397);
        _reserveERC20PoolHandler.removeQuoteToken(695447900447299642356165997679842662901566195463157340836308600901538944, 26338, 2750085291079463313654375774119, 1009983518963444847128355032656);
        _reserveERC20PoolHandler.repayDebt(2, 720009914530612268728781952715289187456556291113063227723, 1);
        _reserveERC20PoolHandler.removeQuoteToken(186798158006677995439829616916, 1669048312912208536158674351746, 1331790117327389005457408891555, 1009210456843097238);
        _reserveERC20PoolHandler.transferLps(991588, 0, 2, 185114861820223929712948814264950620788735180917125, 276870856454433335);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 63769669960, 2, 97149103751280306774067361669734225883451442975085564);
        _reserveERC20PoolHandler.kickReserveAuction(11692433081503889197821392055228, 1010766412523652204);
        _reserveERC20PoolHandler.repayDebt(8924226044880735361609379745412606333160478925, 19989402777956700558420697463244304447582589962702105092, 1);
        _reserveERC20PoolHandler.drawDebt(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 23962313511619198832612632);
        _reserveERC20PoolHandler.settleAuction(3539333218283803558221379703441729486607923717130701980907774963194645577, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 122417852564842231348);
        _reserveERC20PoolHandler.repayDebt(1036157435152920871, 296432208332564, 1041275378574753707);
        _reserveERC20PoolHandler.lenderKickAuction(221918906303210725917652444807610588787540333206884, 2, 2);
        _reserveERC20PoolHandler.removeCollateral(10147684103334539502918396075581113, 3841078953660488375366583614786, 5676616818976646660864850730552, 477776147858243698);
        _reserveERC20PoolHandler.takeReserves(1113050647784922130, 142473471658488519340713962054, 2478598952576055565665905);
        _reserveERC20PoolHandler.withdrawBonds(2, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.takeAuction(7383832439501091127860246143139671, 5835291956497071737963700349486, 10573910895250239767410165933134, 298);
        _reserveERC20PoolHandler.kickReserveAuction(2203855929402825305986412653778035, 18636299863312956140570611637415);
        _reserveERC20PoolHandler.settleAuction(1020023736318551872, 8050298237688127321910024568, 26737143013578945639199305661, 1407484244660656291863065807719);
        _reserveERC20PoolHandler.pullCollateral(531917866732841573467264887, 12057067381580293046533557, 10118848302541289670175765275249);
        _reserveERC20PoolHandler.addCollateral(0, 1, 1, 1);
        _reserveERC20PoolHandler.drawDebt(666521023699426458659666571327996421615540850890009629, 72166822664320374119495488514474431881182136618917, 0);
        _reserveERC20PoolHandler.removeQuoteToken(5144239076146989715965106731423, 1000071303797560005, 8710749781768807077101872029559, 276209362900325599864796740963);
        _reserveERC20PoolHandler.drawDebt(5325524760589606145594314077967, 4730761047518278024636321513723, 6807055724321157389761347122709);
        _reserveERC20PoolHandler.repayDebt(1000485616473352354469219122811, 9651469104010325207117449196912, 2808438831858849715937);
        _reserveERC20PoolHandler.moveQuoteToken(7454040309400210712275, 2812153626373728366456786782311, 574473931276658437286, 4813238650026144075265285138403, 4744785461484799122461551763713);
        _reserveERC20PoolHandler.removeQuoteToken(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.bucketTake(48717687742405329544087689, 1911, true, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1948198095581486781785859);
        _reserveERC20PoolHandler.kickReserveAuction(25574, 0);
        _reserveERC20PoolHandler.removeCollateral(392, 0, 5, 1232890542834285579224118820313293);
        _reserveERC20PoolHandler.pledgeCollateral(1903655765321737838045110873435, 84260241521254471084671825548, 1760582694);
        _reserveERC20PoolHandler.removeQuoteToken(1207029624308850304685657760952501453282297619043072791255821747487419643922, 1, 219115292265915811623890717117285699021873530422413, 1284055940502576843747109289578849);
        _reserveERC20PoolHandler.kickReserveAuction(1, 3);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 81879577845458796722163030797080833476139568975206586970647380742, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.lenderKickAuction(1188022138207972484, 811819938423221709910746519451171960025020447862340415313819696144610399, 116756059283900633269555696670);
        _reserveERC20PoolHandler.addCollateral(278745405706241433205866274723856692911353790542553123896139586, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 0);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 14398994507642219, 387176001736981316845899134170473924828818, 391032112785994464285277564833775366165);
        _reserveERC20PoolHandler.kickAuction(61041404087, 291935695912440421090686268850060008895187650347757099923166, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _reserveERC20PoolHandler.addCollateral(14671132121662062146489585154, 2546512399685967598441917509501774, 152141967931155182702270, 1145374689);
        _reserveERC20PoolHandler.moveQuoteToken(70099984039551834765000, 1028552800565383872, 292395574266910552083716189227, 2148316038408289068712584014098552, 1914611922997686496186590914031);
        _reserveERC20PoolHandler.addCollateral(3, 4900222216611583813307056859, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.transferLps(1931854544556192231849350062994774, 2044637794174221820726854298843, 2099054531044613733088458086519, 146401084693287768820340001895, 7984503452821327002253);
        _reserveERC20PoolHandler.takeReserves(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.drawDebt(81475957283104500803441729085, 3612778198882533119778837270530, 9922714459144784603057264887419);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 25104328799466);
        _reserveERC20PoolHandler.pullCollateral(90676237759214414885900829290828179209609353668805, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.drawDebt(90117714255547081923244102774281723, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 0);
        _reserveERC20PoolHandler.pledgeCollateral(1275005848066240900647498110251, 2675369317454524044827466835151, 3068659557111913567993817625772);
        _reserveERC20PoolHandler.transferLps(3368636125165675948210347735615931468095524081864682977000121618, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2095510619019941, 3, 1385123012);
        _reserveERC20PoolHandler.transferLps(941238929349167377382497145498618, 1001678183999595112, 6155675980821498478690501806462911, 73922656669254370012233486896, 1153181142153457284);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 65173807055092463535316780, 221538458141764531385426839261660313051103110380205705);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 6390753502792, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.bucketTake(3249301567122864482404609, 115792089237316195423570985008687907853269984665640564039457584007913129639932, true, 43095118796671447885156212975039306507007842280926288095801373960, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeQuoteToken(60368008577548596749452695301205854760772602975116449319813, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 441125);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 2, 3);
        _reserveERC20PoolHandler.takeAuction(25394593198437059756515690888273663716096692946494511556735383409839, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 4411913199919858, 15);
        _reserveERC20PoolHandler.kickReserveAuction(2999999999999999188193635543420413445785167770, 188541454266826417559351297255418452161640542913641557273458);
        _reserveERC20PoolHandler.bucketTake(4117584633717556490381481495291, 11232, false, 1000000000000000000000794383175963273556507742, 31518878288391130763781876790);
        _reserveERC20PoolHandler.kickReserveAuction(5421330324513745607182249, 2);
        _reserveERC20PoolHandler.kickAuction(1449415483150607552, 1057600098616381511, 10633398011157349937482345581425330, 4262983154397700084946393187695);
        _reserveERC20PoolHandler.transferLps(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 443341759225172591783070112, 34535393520, 33426288711054711637910);
        _reserveERC20PoolHandler.kickAuction(775492949247373457445383642056340994454354180856685326672406665896156186, 1718681182070096947367690337828, 1496045526884315749, 1000124121813682367);
        _reserveERC20PoolHandler.addCollateral(1004813978014726814, 8880, 3162412220858905989648, 338276043845621613167628);
        _reserveERC20PoolHandler.kickReserveAuction(804587210716814422547214290016, 595086743631188743097);
        _reserveERC20PoolHandler.bucketTake(35633075728779417985687785064029, 8958407063840586205380525189682, false, 2999999999999999999995037531835193701100667451, 529840937475708841990494700819);
        _reserveERC20PoolHandler.pullCollateral(169446026654506451221287595859524993283, 861485377911827600159888322859819354253377293501419527692, 3965991656494378094890797002957033087699169684813166889308838046110427854);
        _reserveERC20PoolHandler.repayDebt(11122504903306538117326560656187, 38790029776953193687396346673, 855425542209119244662172863145191878476943514852736081594795668274829824);
        _reserveERC20PoolHandler.pullCollateral(1863609602290406427446514257687, 40229270568155588, 28342539164762883632144914175556);
        _reserveERC20PoolHandler.kickAuction(1098806786891021651, 2703083511076243960929986926113, 214140657945115341322668164538079, 1000099538589911222);
    }

    /**
        Test was failing because it required a deviation of 1e13. Updated reserves invariant deviation to 1e13 (and inline with QT1 invariant).
     */
    function test_regression_invariant_reserves_removeQuote1() external {
        _reserveERC20PoolHandler.pullCollateral(0, 5871969820778926, 1);
        _reserveERC20PoolHandler.pledgeCollateral(4714, 687973989128864692730989368863221890875625519472204040673170653989568512, 7025);
        _reserveERC20PoolHandler.kickAuction(2, 713542366852377195630179501471439338034831686117, 796378108311962951796665329159023979633134275698667251224006456286, 425684864204774853757164726521165827521641550585407082010);
        _reserveERC20PoolHandler.takeAuction(15183, 5485, 2157, 13906929370032950118523165779536);
        _reserveERC20PoolHandler.addCollateral(12183, 10662, 9186, 9204);
        _reserveERC20PoolHandler.repayDebt(217612996200577063, 727438790722909972322661500136016180009558310649984, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.settleAuction(3049, 2995, 15879, 6844);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 1000559816108266818073061, 0, 0);
        _reserveERC20PoolHandler.transferLps(508702354760248121236948775, 124588969805382906044256850955, 0, 2, 1262738132918364765995074197182298873);
        _reserveERC20PoolHandler.settleAuction(6885, 10120, 12223209939952804167714829484, 1000001744681168143);
        _reserveERC20PoolHandler.pledgeCollateral(144429794452160357255889109538413975557632754, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.repayDebt(166, 8601, 4558);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 832034627619028695935891222, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.addQuoteToken(56028898219422, 258052236866236679230, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.removeQuoteToken(459, 627, 10875, 14511);

        invariant_reserves();
    }

    /**
        Test was failing because pool state (interest accrued) wasn't updated when repaying borrower debt.
        Fixed by using updateLocalStateAndPoolInterest modifier on _repayBorrowerDebt functions.
     */
    function test_regression_failure_takeReserves_F1() external {
        _reserveERC20PoolHandler.bucketTake(8133180731752238771811412, 2712455524425212829985, false, 676668306530713167580483133679, 1000071978024180465);
        _reserveERC20PoolHandler.addQuoteToken(14036311948084606882143641577, 6114726890383846519464348356, 27440, 124577843671240731663191476069661363485564336329605232166988892654002);
        _reserveERC20PoolHandler.transferLps(9872990784377414306547041, 999999999999999999999989641217604218267494373, 1672536439, 10027, 2533);
        _reserveERC20PoolHandler.drawDebt(3, 14972137663886333686802900321, 523892674);
        _reserveERC20PoolHandler.lenderKickAuction(1000130943059863910, 6131, 1017224451143915959);
        _reserveERC20PoolHandler.kickAuction(16612, 9052172837629344905112030283, 149277958556264141173760145, 16812);
        _reserveERC20PoolHandler.takeReserves(3, 101612373222750572528253027191156910463885519243511875272520449979009, 266614003985374887564348479277741231124260919310742954767943555991);
        _reserveERC20PoolHandler.takeReserves(607548627652618511385002408008383549076778857, 1, 429966741527392416);

        _invariant_F1();
    }

    /**
        Test was failing because t0 debt in auction accumulator was in an inconsistent state after repayDebt action:
        - auction was settled, the quote token amount to repay was rounded down to 0 therefore t0 debt in auction accumulator not updated (updated only when token to repay was not 0)
        Fixed by guarding against repayments of 0 amount and properly updating t0 debt in auction accumulator every time t0DebtInAuctionChange is different than 0.
     */
    function test_regression_failure_A1_repaydebt_t0_rounding() external {
        _reserveERC20PoolHandler.transferLps(883172166925196014153612741, 1011874887306145524, 1560280797611982634762545, 2999999999999999999999999999999999999999988581, 166067911958117829389897753);
        _reserveERC20PoolHandler.drawDebt(109748618821205351803014988731482981932, 1, 1946224850931);
        _reserveERC20PoolHandler.lenderKickAuction(23120646526972050226088733811, 114506716413332403306176469, 85883);
        _reserveERC20PoolHandler.pullCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeQuoteToken(16015765038220222984273010530, 1020363514639207733373983, 1014737335754083714, 673321911366647590987964);
        _reserveERC20PoolHandler.repayDebt(266183799725795118552059050547, 999999999999998990000017889368360594282917314, 25104380621850820);
        _reserveERC20PoolHandler.settleAuction(86115324240622909644348503594191331907, 3, 13415589128718995512776336035268391001749531136, 339085840303819);
        _reserveERC20PoolHandler.pullCollateral(1000001909488749440, 23120, 7111290336193937);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 233802727051342750, true, 0, 2);
        _reserveERC20PoolHandler.repayDebt(263170258309, 5080744165795717982603, 55117253660090837057621764590);
        _reserveERC20PoolHandler.bucketTake(993917833171661375516941909496, 745631306942772834416252, false, 1371855054152529049, 43724538864552400563951010712842);
        _reserveERC20PoolHandler.pullCollateral(3, 25743313275914362980617822412296162738, 16762886985273);
        _reserveERC20PoolHandler.kickReserveAuction(3078150006564196, 7396882861103323249736713);
        _reserveERC20PoolHandler.removeCollateral(16468976271668126152885936984970, 1487154400729783333282192, 5478375424271713063891503967473762210131012071710882253815092609, 0);
        _reserveERC20PoolHandler.pledgeCollateral(1959756081363182154945484, 695184912617939452564096706195147982029158844651640050845541975060105216, 20953);
        _reserveERC20PoolHandler.removeCollateral(0, 8429530503692258767600766472296295879485010785135841986, 27382077361849487290924013, 110712338779070583237865355301234737011758479442161592032064020);
        _reserveERC20PoolHandler.bucketTake(10735866914, 6938610560402955446652241, true, 2155641559294868879304378353988888425791710176590436362969520343, 652324170013566633900821571929737900067);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 656209644453247396627537146682850200028671428518089);
        _reserveERC20PoolHandler.addCollateral(1188072877812797985369622751974814986783160701880309, 1, 1147849554826063753972872541, 115792089237316195423570985008687907853269984665640564039457584007913129639934);

        _invariant_A1();
    }

    /**
        Test was failing due to invariant paralel logic applying take penalty on the current borrower debt instead borrower t0 debt.
        Fixed by making invariant logic inline with pool logic (applying penalty take to t0 debt).
     */
    function test_regression_rw_reserves_failure() external {
        _reserveERC20PoolHandler.lenderKickAuction(2745, 24455, 13722);
        _reserveERC20PoolHandler.pledgeCollateral(123337267943716142615242382731926630930323989357616310, 831733227434971474, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.withdrawBonds(15840, 11617, 226);
        _reserveERC20PoolHandler.bucketTake(1365, 2902, false, 18724, 939);
        _reserveERC20PoolHandler.pledgeCollateral(539326432733374732884941193, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 153518275391877220937979377471);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.drawDebt(2, 1620636476530426914005760203730864495513993450783166013428737958399072815940, 340874209460801802727144333948073099617657);
        _reserveERC20PoolHandler.repayDebt(688556596275, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 368094257615470101907295);
        _reserveERC20PoolHandler.takeAuction(3585219579480534231848357301825602838866679189897607958322726920257536, 14457, 1954, 13154);
        _reserveERC20PoolHandler.repayDebt(4617, 8718, 365);
        _reserveERC20PoolHandler.drawDebt(59776, 5221, 3265);
        _reserveERC20PoolHandler.drawDebt(7264, 76160, 1354);
        _reserveERC20PoolHandler.pledgeCollateral(2, 76961268213505018630059906018712883113465719035691941927061520, 0);
        _reserveERC20PoolHandler.takeReserves(3097519512, 94653314286117312, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.lenderKickAuction(3417, 5313, 1065);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 262723374, 3);
        _reserveERC20PoolHandler.settleAuction(18592, 23024, 59620, 1130);
        _reserveERC20PoolHandler.transferLps(17904054251994466560905859484014215462564, 15888216163148783188069980097884298806041869, 2, 79507040, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.settleAuction(25044, 2839, 3625, 10348);
        _reserveERC20PoolHandler.takeReserves(982635115242346064607322395786817600531455973005452194083, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 889370);
        _reserveERC20PoolHandler.settleAuction(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 89167707403713776180830955605269008311134343539);
        _reserveERC20PoolHandler.takeAuction(6470269723793827696552427938265598607645887801758057431297364941052293, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2866630568615781311922993476096073, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.bucketTake(68664, 7326, false, 4233, 5677);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3);
        _reserveERC20PoolHandler.lenderKickAuction(0, 1218898441896362378535137262535177203, 21798664731976227158610477457991755208543783402036139286216);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.bucketTake(13445613122200147477792608151727, 270565483187498024573987287835057900370441980356809225245307134, false, 172971071584471702836978258371210100661094308, 0);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 3168, 69361987003667393973146886443285869929, 151854736120);
        _reserveERC20PoolHandler.withdrawBonds(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.kickAuction(1, 315546839809342740045193554800216, 16032, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.pullCollateral(3303, 1618, 2392);
        _reserveERC20PoolHandler.removeCollateral(38396, 3984, 43724, 801);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 4136243925327015826551896052210933199888246316718789990226072929761635355, 17017692613008421741158348905143822);
        _reserveERC20PoolHandler.pullCollateral(576878529233854490611652048799820558153187703902, 23345238424267457, 678151723892535345234384954426157441012880665738860910379295890697763880);
        _reserveERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 0, 8022761294074727038680587196911881844164552093948646494354);
        _reserveERC20PoolHandler.lenderKickAuction(22192, 33876, 1849);
        _reserveERC20PoolHandler.kickAuction(3, 54344449090570270030575794, 41331735998982754712822, 413913523436635659969293009110325);
        _reserveERC20PoolHandler.pullCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 590921270504087763943624823522978007950936);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.takeAuction(2147, 4584, 3843, 5018);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.lenderKickAuction(14340, 48434856810956849965736021604069675576075951470372408084823421939858231806374, 3299);
        _reserveERC20PoolHandler.moveQuoteToken(68852, 7424, 1038525076100356668671255, 492568651, 13139);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 505628);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.drawDebt(314, 67784, 21539);
        _reserveERC20PoolHandler.takeReserves(16631, 7641, 15813304800480849075013522109620);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.kickAuction(78347310717410332489887175069473254630037478751251177540284229024971, 3, 2, 1233824434582477798584326375008130503551039483729831882824086787424);
        _reserveERC20PoolHandler.kickAuction(242768334464864707264952, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 14074, 1721284543988222482907417);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 11105967986029427869076715, 3, 406604372117093127509064484362759301341600801659247);
        _reserveERC20PoolHandler.addQuoteToken(1, 18774027645564423189902454159, 442346924783177633612644226567494995513426265637554153229004729, 1);
        _reserveERC20PoolHandler.pullCollateral(1004522438786235492048468453, 164705218122715295049806191381208816998911604105097332, 643240014155684032904315471687858800596406618599250399743645325);
        _reserveERC20PoolHandler.bucketTake(211, 70894767171094701924380241813678321351874967904284301036263, true, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 587524960523350577531110494565315845260665710571);
        _reserveERC20PoolHandler.takeReserves(2129636942992548828843421325074058252047527111840809862524997997604655480567, 0, 2);
        _reserveERC20PoolHandler.takeAuction(1995, 52592, 16411, 61000);
        _reserveERC20PoolHandler.bucketTake(0, 115792089237316195423570985008687907853269984665640564039457584007913129639933, true, 4624698904533685297229897439094843595668654826825810413531371864545943304, 165550145956386111276459080941583520428362226);
        _reserveERC20PoolHandler.repayDebt(2, 35417841946221182133768342906925, 81560474795151136303307655218174579269488251191295053167523);
        _reserveERC20PoolHandler.pullCollateral(262005231982037012071095053951950726890, 165897178866840433455273519, 3888558842537780612354835116962744581018);
        _reserveERC20PoolHandler.removeQuoteToken(67601320205637231575518551341855435078757081656, 42506491712172925477842742026585129736172, 0, 3);
        _reserveERC20PoolHandler.removeCollateral(2735948757698, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0);
        _reserveERC20PoolHandler.drawDebt(69604, 66364, 62708);
        _reserveERC20PoolHandler.pledgeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.kickReserveAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.kickAuction(42696, 53948, 4098, 80208);
        _reserveERC20PoolHandler.lenderKickAuction(11168, 4687, 46203667883211236176009300351222888745161251164121910689922122206957300538260);
        _reserveERC20PoolHandler.bucketTake(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, true, 52717956413245182495690438857638203602407222750947906512913358177748309461, 1830655722053423400022802920473021837);
        _reserveERC20PoolHandler.transferLps(8648942085539954219328447003223809341519, 950885841320713403982849019036607701793496635, 1864492050351847862134365417027951703327712, 0, 12365193093817834339793997848323656585885308060548800349);
        _reserveERC20PoolHandler.repayDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 441041722731880847112545726224);
        _reserveERC20PoolHandler.drawDebt(2, 5637245938950027975241707143245277554697641348009134206336950495061, 0);
        _reserveERC20PoolHandler.pullCollateral(77076, 1029781823869605113168706583, 728102202963728405455246);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639935, 322, 158131966158438559143880652910421535378683600, 552124628095494158214465237746987896396049733188757299922485316684095);
        _reserveERC20PoolHandler.removeCollateral(63832, 14378, 14464, 7199126569176769759713715016380);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.takeAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1676984243940844902856884113511719636660353869679548995883472046500284900, 194762926621741009790380454595699099505044650049277809140105);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 86702800819952145885, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.settleAuction(68836, 6293, 3646, 40652);
        _reserveERC20PoolHandler.removeQuoteToken(1435, 88274, 27344, 59680);
        _reserveERC20PoolHandler.addQuoteToken(9653, 36884, 43164, 34240);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, false, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _reserveERC20PoolHandler.kickAuction(14030, 78156646155174841979727994598816262306175212592076161876661508869554232690281, 14958, 26760);
        _reserveERC20PoolHandler.pullCollateral(31354931781638678487916134672869638484047149969764982831501014746446650500196, 20100, 1934);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.transferLps(5228, 38484, 4990035944185332538707557538917939723630454073884429990845069690000830, 69516, 21665778744210722290811484629);
        _reserveERC20PoolHandler.pledgeCollateral(2, 75422987196044127630761837780987325699862235109119318162336547749, 6179987597);
        _reserveERC20PoolHandler.removeCollateral(6378, 2588077117166263351284689902931333654327841381007133193817924669990258558652, 42920, 59652);
        _reserveERC20PoolHandler.addQuoteToken(212393376599363843461142355438411176318797499816971, 1082626922, 2, 1902339354244380);
        _reserveERC20PoolHandler.addQuoteToken(1041777794389919310, 74308, 47400, 2747);
        _reserveERC20PoolHandler.kickAuction(485935523377801208785095832858151873122377611590354602078,9372151449027021227981818334816093164047701121915049579602971879, 1, 1350089742552569926514612646160420107975090607927746546952709);
        _reserveERC20PoolHandler.addCollateral(42292, 7344, 1359, 54977386430942545964497351608958257571213157214788288810916378935044424854184);
        _reserveERC20PoolHandler.kickReserveAuction(1000236603027803172, 21754741055016307934840204006);
        _reserveERC20PoolHandler.withdrawBonds(373702251020986977207790889868085050901394374965, 4140, 53424);
        _reserveERC20PoolHandler.transferLps(58808, 53864, 35788, 74796, 55652);
        _reserveERC20PoolHandler.lenderKickAuction(1764, 5382, 31700);
        _reserveERC20PoolHandler.pledgeCollateral(1058781579682788238311, 3595163542440, 1174127066216041681081057);
        _reserveERC20PoolHandler.withdrawBonds(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1);
        _reserveERC20PoolHandler.repayDebt(3, 577096421800264625310269861, 6069872263612439813277667159763490263920271842304881717238);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 19, 2);
        _reserveERC20PoolHandler.kickReserveAuction(4210960525909156020704, 150717425581035467460005734401755);
        _reserveERC20PoolHandler.transferLps(19525089915530989, 200896599144468014944428982, 31856939995214172578550674772713104925855484, 1, 15450231414793903579649709108337);
        _reserveERC20PoolHandler.transferLps(9999999999999999999999998904, 51624, 9971, 1342211067070467, 16700);
        _reserveERC20PoolHandler.addCollateral(119764603467019941961977205, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0, 1);
        _reserveERC20PoolHandler.removeQuoteToken(59800, 37640, 8317, 74040);
        _reserveERC20PoolHandler.takeAuction(263046553377839595733555, 17173744718130880047583445834558963405893, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 4833604285229578029430100810341);
        _reserveERC20PoolHandler.addQuoteToken(14956, 27115, 8262, 1393686142056213573);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639934, 37633653110846165980514994245971462730370047059165, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 2811764013130114534361640788272261420507665322357890541394754);
        _reserveERC20PoolHandler.kickReserveAuction(1522557716685203217262503, 2073);
        _reserveERC20PoolHandler.repayDebt(53376, 9700, 77016);
        _reserveERC20PoolHandler.withdrawBonds(41472, 22556, 515544862944662148599477108050029971417792571756);
        _reserveERC20PoolHandler.kickAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 9406223615136939066939078713383);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 12096, false, 26257948, 868853496937525842673186021209);
        _reserveERC20PoolHandler.withdrawBonds(83049693977262618120718736926118174180340700, 514841, 1);
        _reserveERC20PoolHandler.addCollateral(1548735198738205401485330251216522, 3732433568614, 2180862107850515031333, 125942509745293258656006517886029838705216318787717437080279894744491);
        _reserveERC20PoolHandler.removeCollateral(2, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 340960440, 3);
        _reserveERC20PoolHandler.kickAuction(162709566598368579437817, 1332873599505451132354360677515123340395328204920455806150312990831427444461, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 633026962134701401242064608840823919980052438526687733234921642689608023933);
        _reserveERC20PoolHandler.takeAuction(322, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 773873574571235061415839771570789947238402953522597705649743297428242994, 7758586519239924744171);
        _reserveERC20PoolHandler.addQuoteToken(6249681088590046484676031495866526227464307055320967, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 3);
        _reserveERC20PoolHandler.moveQuoteToken(702067896002955667744486226077, 1851755658, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 25424747081166118510931721327439432401626401971457982577840174748229701584345);
        _reserveERC20PoolHandler.addCollateral(1413, 49095168302549099840713749279118697142645461715153932419307502388083636811957, 59312, 63044);
        _reserveERC20PoolHandler.pledgeCollateral(265113518, 26743690141064050503543535875740594379319460156696308243384294412911045650, 6857685657629659715371385916444198334380046347135735206631285400);
        _reserveERC20PoolHandler.removeQuoteToken(264755099108448404874526611938161139982716097780249605324091382474858483, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 29555907885141198250374421455396897600803290868687224178413745256);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 913445681, 24016, 3);
        _reserveERC20PoolHandler.removeQuoteToken(1318962590322040984799347, 10975, 11423, 991989158181821594939988);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 14312416314106325, 1210);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.takeReserves(1, 438727355721426477239898491851681108155220538380850414154, 13847678296111811789794085392979441933736231);
        _reserveERC20PoolHandler.withdrawBonds(0, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.pledgeCollateral(2, 8524283102799585244522974229466876622939214, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.repayDebt(3433, 846284097141101951348951915496082269416134646619748038244302899114646796, 95136396632074037836788541112);
        _reserveERC20PoolHandler.removeCollateral(430312666383248217368835965751, 608359823, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.pullCollateral(1000251480639075482, 1694, 2861);
        _reserveERC20PoolHandler.drawDebt(43388, 15271340786116372574138093141534396687613031025591758746939347758077531181799, 44324);
        _reserveERC20PoolHandler.withdrawBonds(2, 1, 0);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.bucketTake(11273382872855962494616156929227174104394223152675369,563071629684930228962, true, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.settleAuction(120876873422711933, 13123, 1202025693345828720, 86474506389175276555789104803);
        _reserveERC20PoolHandler.settleAuction(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 2153576920718485934032590649534232750065468526);
        _reserveERC20PoolHandler.drawDebt(56176, 15280, 2027);
        _reserveERC20PoolHandler.takeReserves(0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 69287402946168098504);
        _reserveERC20PoolHandler.pledgeCollateral(2513453083628410660, 354836047215678049566111164509186528820097440614198, 1440945232);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 122203289258304993638271269094949);
        _reserveERC20PoolHandler.addQuoteToken(53679, 62040, 5947, 2103);
        _reserveERC20PoolHandler.addCollateral(18774795145391113931569311773, 13864, 22198, 249890409261739105535806062594);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 402481164733638687888213, 3, 1);
        _reserveERC20PoolHandler.removeQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 6570343599);
        _reserveERC20PoolHandler.removeCollateral(904, 62088, 2606493574, 1568);
        _reserveERC20PoolHandler.transferLps(386809077963557983132, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 148380917210836178473325853580934307774647345526133, 1471892031300499403);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 1198429820689537065749, 243483583504501197526845158753139835924066659);
        _reserveERC20PoolHandler.takeAuction(1199779041428331153, 71740, 29306, 212074468834203469445731314306);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.withdrawBonds(5886, 6118, 31095594184158051362419323440);
        _reserveERC20PoolHandler.settleAuction(73104, 19886, 67842558439608731261142755949781586203409010660475186688055685950916002409738, 252057734655093500419854976371);
        _reserveERC20PoolHandler.takeAuction(7196998050564854545778916884105598407810383237719695, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 7255413239007126458982904756151267359533146366352519669325613874036, 2047248371259122735965487218913991798927990);
        _reserveERC20PoolHandler.removeCollateral(1864213972, 640566951528318811482719954179,23306860749941827438288665513, 17991);
        _reserveERC20PoolHandler.repayDebt(1829308781, 10466, 10844);
        _reserveERC20PoolHandler.withdrawBonds(2653308208712636950001934534323483618764, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 102999660873007284);
        _reserveERC20PoolHandler.pledgeCollateral(31720, 70932, 2780794693417059803);
        _reserveERC20PoolHandler.settleAuction(1, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 854671780727979439081563500191, 225262438160);
        _reserveERC20PoolHandler.bucketTake(629940976225716059962960082771, 1, false, 225849678556989118720101007068792997916417849594324517755148263306, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.kickReserveAuction(606348554034558493679860454709431448, 89966888302392);
        _reserveERC20PoolHandler.failed();
        _reserveERC20PoolHandler.moveQuoteToken(41440, 21699326946127593872059764476,4710, 6203, 14804396475113080648507077369666489796844133507008083789207787640816145781579);
        _reserveERC20PoolHandler.withdrawBonds(2, 17699682295103685686607846447761536549069783056697648210356871, 32242429915466227126678114985365834118645100);
        _reserveERC20PoolHandler.pullCollateral(1251991137329864999647595984957979509770972143957828381127002, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _reserveERC20PoolHandler.settleAuction(2928541728928580567000226390336957184553436628091154283961253785794613, 2, 2875303751127784380477338443990777660043197429138675174892500, 521967551);
       _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 5760141916331935256020319985050770378843488870096130251085692594128, false, 252114383392869660254, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
    
        invariant_reserves();
    }

    /**
        Test was failing due to borrower penalty not added in reserves calculations for reserves invariants.
        Fixed by adding borrower penalty in increaseInReserves.
     */
    function test_regression_rw_reserves_failure_2() external {
        _reserveERC20PoolHandler.pullCollateral(467812928760450922852130520517, 0, 8875981380220900699974754772374433563827538899982250783154248);
        _reserveERC20PoolHandler.stampLoan(40175363097800960342714213669375739863439895429878092142484989154449, 409061);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 1, 0, 0);
        _reserveERC20PoolHandler.lenderKickAuction(6739921392061593446919, 6665134088409172498708598665753565015506650372591945929089778543248096029475, 28995118252860325273433400612247);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639933, false, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        invariant_reserves();
    }

    /**
        Test was failing with underflow when debtCollateralConstraint is calculated with borrower price equals to 0.
        Fixed by setting debtCollateralConstraint equals uint256 max value when borrower price equals 0 to trigger third case in `_calculateTakeFlowsAndBondChange`.
     */
    function test_regression_rw_reserves_failure_3() external {
        _reserveERC20PoolHandler.pullCollateral(689310072489575950194610941862218313559051158375867529942715794, 99036455857404432, 6869705889740062461982024);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 6742192, 213010309037469, 559253357385477068169816814589744715662918367352352023924236308825157221);
        _reserveERC20PoolHandler.bucketTake(1016146854898171779840580985646, 702533447184886148876700400367357570569398118557415200792466345280405503, false, 529372371950495425561109650, 2068665645832452894016891);
        _reserveERC20PoolHandler.transferLps(22896729871095067, 33099474, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 0);
        _reserveERC20PoolHandler.addCollateral(1243, 20194462732101988290791998389, 1689661434, 2016395110395212283077154);
        _reserveERC20PoolHandler.takeAuction(1053065795079038070957917, 7983715169874533544149183933, 10149841974673137113234915054, 14423198);
    }

    /**
        Test was failing in bucket take because of kicker reward not added into decrease in reserve.
        Fixed by adding kicker reward in decrease in reserve.
     */
    function test_regression_rw_reserves_failure_4() external {
        _reserveERC20PoolHandler.lenderKickAuction(41448389421126432182726016581, 2602898649473330, 17196485686943506801781467688426213134395453464);
        _reserveERC20PoolHandler.removeQuoteToken(6486, 9034, 4005, 10875025938101873);
        _reserveERC20PoolHandler.kickReserveAuction(19936, 1602202823226609409493879949424965818777601);
        _reserveERC20PoolHandler.settleAuction(43422653358836780601775799271338712538765906652243288953354029299518452019549, 2, 222121421529490670116623911755462896144535, 1);
        _reserveERC20PoolHandler.lenderKickAuction(7275, 24173, 999999);
        _reserveERC20PoolHandler.lenderKickAuction(8295, 33429, 8199);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 64692573191385631161743023454013934845178776);
        _reserveERC20PoolHandler.addQuoteToken(4, 0, 831011391, 15);
        _reserveERC20PoolHandler.moveQuoteToken(8396, 21445, 1150130547533370594, 74603461372738258605591962, 32485);
        _reserveERC20PoolHandler.removeCollateral(593804, 3, 1, 9704287815361877708977161768658767);
        _reserveERC20PoolHandler.addCollateral(10494, 3176, 6582, 1000013632258236536);
        _reserveERC20PoolHandler.bucketTake(34739, 9151, false, 14043, 17239);
        _reserveERC20PoolHandler.moveQuoteToken(9754514353313, 109703, 3, 2240925396839878898078075591575488344995370, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.bucketTake(1, 0, false, 115360980752823, 23554795443976594444786153429144989301756);
        invariant_reserves();
    }

}

contract RegressionTestReserveWith10BucketsERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override { 
        // failures reproduced with 10 active buckets
        vm.setEnv("NO_OF_BUCKETS", "10");
        super.setUp();
    }

    function test_regression_10_buckets_reserves_exchange_rate() external {
        _reserveERC20PoolHandler.drawDebt(6520093117695692, 10502155266532607043273364294314284, 1098298774976985856973546303238);
        _reserveERC20PoolHandler.addCollateral(799413999404661436938800974130322989398660743689953725050361533512927, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.addQuoteToken(1255508307403442885488346999776530100723982429883749097689986204842323, 265286955307553699, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 3);
        _reserveERC20PoolHandler.removeCollateral(2965235700463937713398460019097, 4895028025906346399626720847127, 3728128946475078059073833346505, 906504442015914621357139352779);

        invariant_exchange_rate();
    }

    function test_regression_10_buckets_reserves_fenwick_depositsTillIndex_F2() external {
        // this test pass with 3 buckets vm.setEnv("NO_OF_BUCKETS", "3");
        _reserveERC20PoolHandler.pullCollateral(1725238694, 5607861119407238108682743905764, 3697947221836192961852172220745);
        _reserveERC20PoolHandler.pledgeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 4163003353533717107712248278327, 3);
        _reserveERC20PoolHandler.pledgeCollateral(331051108471112814068505394235, 1794357362670427033443967539383, 5434760184066684970661380825914848);
        _reserveERC20PoolHandler.takeReserves(2093390169277455457120395826009, 225655960252256920594649467486, 420191481913388856379382341234);
        _reserveERC20PoolHandler.takeAuction(1000072601753449902, 6742594571340865561402752538156, 6185991641637615001992062400650, 2579004074292614487814817916190);
        _reserveERC20PoolHandler.moveQuoteToken(4379799846767962622058097964138, 4282396763100001034720772014232626, 5963803418953998430016013239158, 7396228690901613004007474991524, 796254125618203630857931805060);
        _reserveERC20PoolHandler.addCollateral(888898768883276460170629663497068, 716786772693430592538218347633574211299860345742396124898302617941098931, 3339070800417238370478910808909, 788108251185339569414458624308);
        _reserveERC20PoolHandler.removeCollateral(1089233309112608580, 2016088173856873109127353621467272, 4816638127778058080435479900912, 17394197214993611742051);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2447848839490892868643621735058214832159901902455148010868708151771, 2);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 29425834998902062728, 2815561902903892364700367145997869863083581937863, 0);
        _reserveERC20PoolHandler.takeAuction(1002082639411802781, 1000000141393972450, 2062329569865819338652496, 3639518374983970385625641369267);
        _reserveERC20PoolHandler.pullCollateral(716928335861873075224326450171091915803141636754600547146763478924688677, 6017014239243671152668202570617, 811528433232365724170352835761);
        _reserveERC20PoolHandler.lenderKickAuction(1006966022689012113631510, 2839423961165, 1012610096869894613);
        _reserveERC20PoolHandler.repayDebt(59697, 4218268651349607331917838812219315, 4198061940385182860329527760110561);
        _reserveERC20PoolHandler.addQuoteToken(9102590, 10619990735779382463268300515514058022851111, 1670387541301, 10508691425622217157731331015369006567594519374645329314842933480452519);
        _reserveERC20PoolHandler.settleAuction(0, 59960806476012009153510156995088168122, 2, 238483732749493419311882771922463500070384363806126829);
        _reserveERC20PoolHandler.repayDebt(1, 2686234748092207156, 100821654896808);
        _reserveERC20PoolHandler.repayDebt(181009111300787803171804491289802958, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 17);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639932, 2, 174569101234346814190149980229336590921869440994501902536709);
        _reserveERC20PoolHandler.takeReserves(58323667455796458960119752251314, 999999999999999999996914159864440813004952921, 2414971389277316683224492871172);
        _reserveERC20PoolHandler.kickAuction(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 624349585752278917231152081294053644738674, 93866371540144105487879266738177937819573038841100);
        _reserveERC20PoolHandler.takeAuction(4009182895962590698169242, 1027990407286300256, 5767416410879431720916599990791, 4407902621924331080675140948337446);
        _reserveERC20PoolHandler.kickAuction(2665212666883282385351563849988, 3671051269384066725179739044196, 698810519264182935230648819185220104516393118, 2532667659084170710624920489511);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 67847457909646289591363578592322056020323327076484828692171208309696597165, 850058, 18301753154181254958465622305761670944);
        _reserveERC20PoolHandler.bucketTake(4899749608953023536728566927535, 1195705898947877847733236256196905, false, 3846324670787072290361799026507, 1895755726707090730202504915719);
        _reserveERC20PoolHandler.transferLps(1001555259040324866, 219983341601869521, 179994348168896996267584235984, 10938648711638122917574185928518, 6766351769155174805492401339267068);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639932, 210805673161421882841240320778627479);
        _reserveERC20PoolHandler.drawDebt(1576194744345532774068685102596, 1797313800, 1791527976146243688526195152423);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 2);
        _reserveERC20PoolHandler.takeReserves(7473156297292164364442021004735, 28298835592766099474577065620, 4367231807488463594739598804132);
        _reserveERC20PoolHandler.moveQuoteToken(7428996156802457743983475024326, 340013001967490041612835676059, 4543539693481132121488275579733, 717078735389788372786880924893119953278634685058403423810552508405332820, 2747877709767875638682785092039);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639935, 1199844344067318008016861893636238195, 1);
        _reserveERC20PoolHandler.takeReserves(7594217016957595273358984273232240986967, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1);
        _reserveERC20PoolHandler.removeQuoteToken(2123674426112976590010963758042596163040978908500930465, 0, 1, 2);
        _reserveERC20PoolHandler.takeReserves(1000047442406905567, 617509245024506032895859547987, 5778018676208469410493025015732);
        _reserveERC20PoolHandler.addQuoteToken(35995929, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 214362937278044814672278861604687139751920139426212338400);
        _reserveERC20PoolHandler.settleAuction(872, 12074647577213068558550804504672314313959440976957612, 36439400262778262906769930774880775814972449146877922483550300590102542, 318370212615296752719110675464569232142337676785721110080418244354575);
        _reserveERC20PoolHandler.repayDebt(123266242330573767, 1035733068352764981, 120671020103695083742903620763960);
        _reserveERC20PoolHandler.removeCollateral(1000000319538407292, 2008341881791431479843343, 899102818114014511971899123461, 3959387048639002356932220155605);
        _reserveERC20PoolHandler.takeAuction(1005295756215100198864026, 1760280839764147909673794710032, 789352182639308272, 1001105712307015464574634072744);
        _reserveERC20PoolHandler.drawDebt(2113416239727263773814576784034, 1161073618109393929, 547205239944875850370679274);
        _reserveERC20PoolHandler.drawDebt(2, 3636705783259448516133156662357670309067, 285616183869066432501692845851878691729755138784635485991695);
        _reserveERC20PoolHandler.takeAuction(2715404242808797632081341083084837565723704868026, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 0, 39793392840327830820680401190667337);
        _reserveERC20PoolHandler.kickReserveAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 1531077172191020224002333744440866354388080814127358767374637012209269972664);
        _reserveERC20PoolHandler.settleAuction(7790077719981479902654711497260, 2203631374956410123461336421893, 916448996305574847264791904981, 1002133809706456504575372);
        _reserveERC20PoolHandler.withdrawBonds(3700130040914704759363595235214, 1030675064964112851, 1005519911429581350);
        _reserveERC20PoolHandler.moveQuoteToken(3915432646857867035114192405496, 4609404034339185572358252520081, 9007969379188124973120136273189, 731419523757918578, 94166848144089645562304450222);
        _reserveERC20PoolHandler.removeCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 675223079871355811436762729810330880280120, 2140814967183482480681884235946420360133390088730);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 177958195847343072440954347149552735);
        _reserveERC20PoolHandler.bucketTake(525644741809339749554203, 7869337152450762415516057420200, false, 3897880605063230242599616831067, 3700431326419314223980729493053);
        _reserveERC20PoolHandler.removeCollateral(2000832567864949824297396248339, 908182074171726670379604432310, 2491454627421088713029519972361, 1000006612673653339);
        _reserveERC20PoolHandler.addCollateral(808594806729699629112134281330, 3877057354969661475686284185325, 9086784489686696949716435672881, 992456795310749116943374893755);
        _reserveERC20PoolHandler.withdrawBonds(1000000012872576761580818, 1590119390558557540599116692806, 33364766054018154844710959877);
        _reserveERC20PoolHandler.takeReserves(62418894493561534878, 184295902472986082251384281776735221531678582045202848, 2);
        _reserveERC20PoolHandler.transferLps(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 1, 42019400363510559466713945056402714606538140568246384014480110914328265163403);
        _reserveERC20PoolHandler.settleAuction(1057279804021938190, 246687658464793724986455352391, 5925827996077694552730400457343, 2084381812461048011473064757225);
        _reserveERC20PoolHandler.kickReserveAuction(214359998882822941400036836759, 772237151693507486089823656752);
        _reserveERC20PoolHandler.lenderKickAuction(580502608968719507145237660113965916868063012, 1, 2);
        _reserveERC20PoolHandler.withdrawBonds(1, 1, 869697374638745867981687493872400658574867528089570078229036174);
        _reserveERC20PoolHandler.addCollateral(2835013280595323711754, 1379747638539802930158795366740, 2999260289280542828859825661600, 1111505902930696308);
        _reserveERC20PoolHandler.transferLps(101318005368562086532090860441, 727691276523922201026494539, 999999999999998209545201949951385339923831640, 2625186857895955159432498610976, 1008568104827895584797314);
        _reserveERC20PoolHandler.takeAuction(108221678869582869958545780, 869196763401261087493999826401, 3017908586652896026183849934632, 1025465081213741246);
        _reserveERC20PoolHandler.transferLps(48795152523476684116952182940, 433417159535039233355211014431, 1672322436938904502828626028960, 1089265766493498060383870046015307, 1000000315952461027);
        _reserveERC20PoolHandler.removeQuoteToken(210566583091, 35967496172865341668096611623330616365711619715451093333, 351, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.settleAuction(1, 26046038938573022881778996231552706821552625849703911370781119255688992648171, 33703319315472791056, 96780568387179063244580652852700750875077793);
        _reserveERC20PoolHandler.kickAuction(1, 185285446, 378697901814982286731, 0);

        invariant_fenwick();
    }

    function test_regression_10_buckets_reserves_RE() external {
        // this test fails with 3 buckets too vm.setEnv("NO_OF_BUCKETS", "3");
        _reserveERC20PoolHandler.drawDebt(290017231884009828565779120576, 1002346974105628138843242095525, 1653584878177848176194377074799);
        _reserveERC20PoolHandler.pledgeCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.drawDebt(3672889067541591, 17, 83856721931010423002279627799971306025841049042329947);
        _reserveERC20PoolHandler.bucketTake(1000197316935676153, 3096097749449943758920050453756, false, 2824023740736482172369426325793, 1777694503);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3, 64603456943647345, 22726223561335484363204986876705771);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.settleAuction(5448707427889081580045157214016, 898517806662526225, 57255705446025176430893986032941, 1798503358);
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639933, 338902, 24895432670362520003757781937901496507349044);
        _reserveERC20PoolHandler.takeAuction(253339908492728, 17277739980789095840457279982793255431547403624057861740152922, 2, 47882133371720379988628201061591263125271753131194);
        _reserveERC20PoolHandler.settleAuction(2753283363779176472273, 25608716488622741794441581974264544214953846896, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.kickAuction(19414070578865673973718167627323950328762130421, 101199815046304851350471242729, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 8007554645229363487529300028025230736429643245034385208137923);
        _reserveERC20PoolHandler.kickAuction(12562041944730213876401507392536536171693897323265736340132124, 542653972998765405218543635289786883927326994341381904010685021072255, 3, 9233918920157136119146);
        _reserveERC20PoolHandler.moveQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639934, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 1462574483700643795161756098043989899405507099055518688993);
        _reserveERC20PoolHandler.takeReserves(1, 0, 2);
        _reserveERC20PoolHandler.removeQuoteToken(14730140957608857, 99, 1, 1386705920515328814743931560931167479097551832850008218878487983494150);
        _reserveERC20PoolHandler.kickReserveAuction(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.lenderKickAuction(893008286811460788553031904481952573606214832422259596085940570283982304, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.takeReserves(3, 170439307069053886557145191896703842826953837742170479, 20466465501556948674803401059840117427266555527646887);
        _reserveERC20PoolHandler.moveQuoteToken(24576850282145403341840304023303746575460022097947982029320014455, 199259095182280921249849, 3, 263081299123519591374903422280598171358315911105268634044959571252407, 107705715799261820459195895645732878612286692246405740446896247929123014);
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639935, 5504186113825436176758787846084168342878, 41473922375020639787670112003);
        _reserveERC20PoolHandler.addQuoteToken(7325, 2954833337023190538516242662284, 3367433177587846034146701567789, 787975225899906627970764104528);
        _reserveERC20PoolHandler.kickReserveAuction(789506806945947781973395839889873837801852027965244395560074620825525209, 7343029460976070011573595981514);
        _reserveERC20PoolHandler.takeAuction(1656596873830407787820916, 3688617597270095107887598723154497, 3278933088712828438944086868109846421171441741587847203531235677181, 1000047204802117783);
        _reserveERC20PoolHandler.kickAuction(16498486372578893979959279149, 102495710679400630, 2012171589600623221362832941245, 10959);
        _reserveERC20PoolHandler.addQuoteToken(2206172833895134654629140542579, 38495, 437987353745559351, 9989828001206899429812877610175);
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 19510935589660207977979858847329461893234305550956273506030315504509452499293, 5618426840076102374407720);
        _reserveERC20PoolHandler.kickAuction(1005012487396868295, 58890819279122694863, 1777723313, 451036903866146529372826612192);
        _reserveERC20PoolHandler.removeQuoteToken(578054643634385875382779806883, 995986024390026689599325420880, 1212208052270684631, 915932822573274712433002209298);
        _reserveERC20PoolHandler.bucketTake(58452, 7989451717336466463163480737395323769105157546, true, 0, 2982422632369226214652442581962969444852761193327330692572341854);
        _reserveERC20PoolHandler.addCollateral(4327795945510946329857323835558, 2280002616451219951843777766825, 2753935105800702192896442118, 1000014897118126606048973);
        _reserveERC20PoolHandler.settleAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 572852888739807418847637975133051259849108089150193598633);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 1);
        _reserveERC20PoolHandler.takeAuction(45608808137377086275068272517449173969266654744680237931555660529240, 922695446816283437904427175331876, 2808969292961465493746792392245575585431291270031, 3);
        _reserveERC20PoolHandler.takeReserves(23516087622120187750393524991337377, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.addQuoteToken(1771380905134061495159586519375, 962424168217907571086988979439, 2705737892325074800408, 310383682458910402);
        _reserveERC20PoolHandler.addQuoteToken(1125592372237565614088627104066, 5423140408463152948915224198927, 65057536008684882637316853646, 5270294277016808585300236482301393);
        _reserveERC20PoolHandler.bucketTake(1883531208, 1044596597307435994, false, 1148561174557185377480250370, 1724803952);
        _reserveERC20PoolHandler.settleAuction(6764815468945041250411727809692, 877, 2, 3004121113053304893931411185);
        _reserveERC20PoolHandler.drawDebt(17, 699675949875749350477881784726699749036129541037, 26378247963);
        _reserveERC20PoolHandler.addCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639932, 29302100276668979277192554575067413969929213158376793, 2, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.removeQuoteToken(1000000000936215753, 254605325365626694, 4069, 1035856500028837119);
        _reserveERC20PoolHandler.kickAuction(1000090607229722934, 2580171788160363207026734674037, 1347092665025078310051154421986979, 1004037368521554395568163);
        _reserveERC20PoolHandler.takeReserves(923522243225703254994721298870, 8700115546393917263343357543619, 2166428961936462402557439595392582);
        _reserveERC20PoolHandler.addQuoteToken(115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 3, 639402091975833721492394191878388806085281852328);
        _reserveERC20PoolHandler.takeAuction(2, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _reserveERC20PoolHandler.kickReserveAuction(1192029264782433734511278767050585798022919741840914701707701, 9838660868733061321749714698638583897632565681053207160200164948032353326111);
        _reserveERC20PoolHandler.lenderKickAuction(848911323651847292018922493625, 475461101841015439785306204553, 5038495789764551021097736053014);

        invariant_reserves();
    }

    /**
        Test was failing because replicated invariant logic didn't cap lender factor at 10x the interest factor for borrowers.
        Fixed by getting invariants logic inline with pool logic.
     */
    function test_regression_10_buckets_lenderKickAuction_F1_F2() external {
        _reserveERC20PoolHandler.drawDebt(115792089237316195423570985008687907853269984665640564039457584007913129639934, 872511381148049007720, 539489537953478369108753171886182489172581205791027954527);
        _reserveERC20PoolHandler.transferLps(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 15030691, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0);
        _reserveERC20PoolHandler.settleAuction(3311151379956769964767988508503575272954757, 75267398466877804280028379007551879365458802899983, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 282706799353988314281438019223518391928165574);
        _reserveERC20PoolHandler.removeQuoteToken(11174, 2673, 7678, 1606);
        _reserveERC20PoolHandler.lenderKickAuction(16859, 23442, 2222);

        invariant_fenwick();
    }
}

contract RegressionTestReserveWithMinDebtAmountERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override {
        vm.setEnv("MIN_DEBT_AMOUNT", "1000");
        super.setUp();
    }

    /*
        Test failed because there was not enough quote balance in pool for the calculated rewards.
        Fixed by not allowing draw debt / remove quote tokens actions to use unclaimed rewards and auction bonds amounts.
    */
    function test_regression_reserves_evm_revert_2() external {
        _reserveERC20PoolHandler.kickAuction(115792089237316195423570985008687907853269984665640564039457584007913129639933, 2, 91325230633814398717429910100117206750783558549035123181702119, 115792089237316195423570985008687907853269984665640564039457584007913129639932);
        _reserveERC20PoolHandler.drawDebt(115010764850365438892405937, 99266, 5629612810546441);
        _reserveERC20PoolHandler.takeAuction(3, 506252187686489913395361995, 17164053241942561945173805142, 614104279766114463662318087446225395238344193500787687172585968162);
        _reserveERC20PoolHandler.takeReserves(5223, 1039866472752662341, 959205933404025228743315025);
    }
}

contract RegressionTestReserveWith12CollateralPrecisionERC20Pool is ReserveERC20PoolInvariants {

    function setUp() public override {
        vm.setEnv("COLLATERAL_PRECISION", "12");
        super.setUp();
    }

    /*
        Test failed because calculated claimable reserves on reserve auction kicked did not accounted guaranteed funds in pool (already kicked reserves and escrowed auction bond).
        Fixed by capping claimable reserves at available quote token amount (pool balance without kicked reserves not claimed and escrowed auction bonds).
    */
    function test_regression_reserves_QT3() external {
        _reserveERC20PoolHandler.removeQuoteToken(1113521085121132368768304231458008366452480816650014, 518010775851214258829944481483992375293627503745004580402566336003, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 48867430425743212060722974487977454079436894);
        _reserveERC20PoolHandler.takeAuction(133562452276145897713007937331793075692999633506787708362, 13036850826973277279, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1486209174712829345536041338613223241477);
        _reserveERC20PoolHandler.transferLps(701, 29085, 956, 3134, 639);
        _reserveERC20PoolHandler.kickReserveAuction(1700813423553818493920759581891205508896009573139033389568178370182784, 2);
        _reserveERC20PoolHandler.kickAuction(4661934629046, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 1);
        _reserveERC20PoolHandler.takeAuction(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 3, 649482141532206195204383530931172995008638628921329782413);
        _reserveERC20PoolHandler.kickReserveAuction(11114, 133084258667509499441);
        invariant_quote();
    }
}

contract RegressionTestReserveRateFailureERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override {
        vm.setEnv("QUOTE_PRECISION", "18");
        vm.setEnv("COLLATERAL_PRECISION", "2");

        super.setUp();
    }

    function test_regression_failure_rate_rw_1() external {
        _reserveERC20PoolHandler.moveQuoteToken(2713745082854240244061, 15659150431173520656126, 11627790492018001678103538003719, 702302526125586756087377603844607976064956618811079445222892931689959409, 2999999999999999999999999932305381158509265807);
        _reserveERC20PoolHandler.kickAuction(1, 6809446559826261847258010878078267653625372887206796015056396925681, 3, 108777762057340874954184791481296119581);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639933, 4818032864823826134704772955529733, true, 486355303824498230104826569186, 101231418301489137629);

        _invariant_R1_R2_R3_R4_R5_R6_R7_R8();
    }
}

contract RegressionTestReserveWith8CollateralPrecisionERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override {
        vm.setEnv("QUOTE_PRECISION", "18");
        vm.setEnv("COLLATERAL_PRECISION", "8");
        super.setUp();
    }   

    function test_regression_failure_rate_with_col_precision_8() external {
        _reserveERC20PoolHandler.moveQuoteToken(7065465912395301546653771299344157923107747921279658981452834151342496639, 250541874700065836620, 115792089237316195423570985008687907853269984665640564039457584007913129639935, 339193523082930124569760269504805082869260003, 8148628492079059521271069954244976097);
        _reserveERC20PoolHandler.withdrawBonds(23709619545376531780606275884917745024902333684128986776737387593908743, 1, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.pledgeCollateral(42666532108011595784308924152350052531383375335, 5809118760125432997676654732, 965904341458225551777795352986886956188290554326089);
        _reserveERC20PoolHandler.removeCollateral(702351282836996322752708166120229445999756883520462134558879235029860352, 7094792829913997357504516282, 1000090299392130745372174632914, 1012057857228338770);
        _reserveERC20PoolHandler.removeQuoteToken(11988599652599805756463937657, 18221051085757115699515976785494, 1915424620773394265921779, 5149377894786633179300473);
        _reserveERC20PoolHandler.lenderKickAuction(2899957802674216732984, 1000216196714744597, 4008287359660140746236758059);
        _reserveERC20PoolHandler.bucketTake(3, 607525307198026895012163441032845762821611030339, false, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639934, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.takeReserves(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 2344477780612242655930676572341759663622902686070567495);
        _reserveERC20PoolHandler.lenderKickAuction(2, 0, 2302565122490673838968099194821778180394707183828480120102840951454827);
        _reserveERC20PoolHandler.removeQuoteToken(29999999999999999999999999999993955717018273660000000000, 100000074400781173509, 1690078137, 7746566126667503662259919454813345813464);
        _reserveERC20PoolHandler.pledgeCollateral(73702245772623658491340224, 16504816212303219314310736480896, 23854977676725639332395733208692944486349876972253503634401400543441081192917);
        _reserveERC20PoolHandler.bucketTake(32507579561616385, 3, true, 1, 24);

        invariant_exchange_rate();
    }

    function test_regression_failure_reserves_with_col_precision_8() external {
        _reserveERC20PoolHandler.addCollateral(114238260062574182853, 10369772791768212489561568, 695188329508152730048443240988655562367482441302665039944603718446743552, 18583369093672742703093239386);
        _reserveERC20PoolHandler.pullCollateral(10147, 2343322363531191320713183406, 1707574665);
        _reserveERC20PoolHandler.removeCollateral(1, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 3606477932718685137709236900053470943, 23385415607402486572668);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639935, 115792089237316195423570985008687907853269984665640564039457584007913129639935, false, 679194464007709242765248157037212202199214448722523641028299465752719992, 24137506329721);
        _reserveERC20PoolHandler.addCollateral(3258448918269729152175438140803564738674280, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 0, 115792089237316195423570985008687907853269984665640564039457584007913129639935);
        _reserveERC20PoolHandler.repayDebt(4240954761491, 506382, 46295193839352600139383379009183528168231424499253797364809851);
        _reserveERC20PoolHandler.withdrawBonds(529674970946337695788247196445527494449474476473211190416, 12633126596755336114408498859733373487282942486261382963393306387, 2427707355658);
        _reserveERC20PoolHandler.repayDebt(219913722554346459171121996440783221556597, 1580045853267856820361525499065414598, 2);
        _reserveERC20PoolHandler.addCollateral(3, 115792089237316195423570985008687907853269984665640564039457584007913129639932, 115792089237316195423570985008687907853269984665640564039457584007913129639934, 4924795240935312983096353741083393641419906095740467126627640723723085666);
        _reserveERC20PoolHandler.lenderKickAuction(115792089237316195423570985008687907853269984665505241123434172405395527169317, 1419490228827145537718746, 412671412358632982503555579);
        _reserveERC20PoolHandler.bucketTake(1027935897138128431, 77846035770509710261666, false, 354405506725417003060000000000, 31404802804047717331727);
        _reserveERC20PoolHandler.lenderKickAuction(12083827091688561989797789, 5036169582603030000000000, 840998853324115664088420098255182867602843310728);
        _reserveERC20PoolHandler.removeQuoteToken(2580054854117444202133186, 3, 1885976439479270141074119744163442391561113698071923440810698322709539, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.bucketTake(96085151998096, 5845075940198927177680538279496604459032449306087006808901507782891, true, 0, 21522202620166094191862172737223123435968299034261665131133830075);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639932, 150179944416354305931107238750987364354, true, 23361419, 1);

        invariant_reserves();
    }
}

contract RegressionTestReservesWith18QuotePrecision4CollateralPrecisionERC20Pool is ReserveERC20PoolInvariants { 

    function setUp() public override { 
        vm.setEnv("QUOTE_PRECISION", "18");
        vm.setEnv("COLLATERAL_PRECISION", "4");
        super.setUp();
    }

    /**
        Test was failing due to precision lost when calculating quote token amount / repaid debt in _calculateTakeFlowsAndBondChange function.
        Fixed by using Math.mulDiv to preserve precision.
     */
    function test_regression_rate_token_precision_failure_2() external {
        _reserveERC20PoolHandler.pullCollateral(115792089237316195423570985008687907853269984665640564039457584007913129639934, 89552631, 27353130995490170987078007);
        _reserveERC20PoolHandler.takeAuction(1000006698792936000000000000000, 1013696853399, 11864972053525826488457833767, 20272629953825623093168169460);
        _reserveERC20PoolHandler.bucketTake(101217938655794611879794153, 115792089237316195423570985008687907853269984665640564039457584007913129639935, true, 115792089237316195423570985008687907853269984665640564039457584007913129639933, 109434987841691942673859961998);
        _reserveERC20PoolHandler.takeAuction(2, 1, 3, 115792089237316195423570985008687907853269984665640564039457584007913129639933);
        _reserveERC20PoolHandler.repayDebt(709587692312031012755297910153597281037249007558669044012478487199113024, 324034365691376028489096823787371897298145, 691167229021501979791794056627);
        _reserveERC20PoolHandler.drawDebt(8819683027554036158806221339871426233668492926100027683713695687747, 2, 611155566926195158593401676);
        _reserveERC20PoolHandler.removeQuoteToken(10831, 2999999999999999999999999999999999999998188685, 16413, 1630905596080266311331453901);
        _reserveERC20PoolHandler.drawDebt(19656673249166279044881856997468, 17698, 15782530613322326845);
        _reserveERC20PoolHandler.bucketTake(115792089237316195423570985008687907853269984665640564039457584007913129639935, 3359951965909399193842356284157491036179701263876178043669343533768515993, true, 199361393407780895490, 115792089237316195423570985008687907853269984665640564039457584007913129639935);

        invariant_exchange_rate();
    }

}
